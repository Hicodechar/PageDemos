
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <title>[09/12] sparc: move exports to definitions - Patchwork</title>
  <link rel="stylesheet" type="text/css" href="/static/css/style.css"/>
  <script type="text/javascript" src="/static/js/common.js"></script>
  <script type="text/javascript" src="/static/js/jquery-1.10.1.min.js"></script>

 </head>
 <body>
  <div id="title">
  <h1 style="float: left;">
     <a
      href="/">Patchwork</a>
    [09/12] sparc: move exports to definitions</h1>
  <div id="auth">

     <a href="/user/login/">login</a>
     <br/>
     <a href="/register/">register</a>
     <br/>
     <a href="/mail/">mail settings</a>

   </div>
   <div style="clear: both;"></div>
  </div>
  <div id="nav">
   <div id="navleft">
   
    <strong>Project</strong>: LKML
     :
     <a href="/project/LKML/list/"
      >patches</a>
     :
     <a href="/project/LKML/"
      >project info</a>
    
     :
     <a href="/"
     >other projects</a>
     
    
   </div>
   <div id="navright">
    <a href="/help/about/">about</a>
   </div>
   <div style="clear: both"></div>
  </div>

  <div id="content">

<script language="JavaScript" type="text/javascript">
function toggle_headers(link_id, headers_id)
{
    var link = document.getElementById(link_id)
    var headers = document.getElementById(headers_id)

    var hidden = headers.style['display'] == 'none';

    if (hidden) {
        link.innerHTML = 'hide';
        headers.style['display'] = 'block';
    } else {
        link.innerHTML = 'show';
        headers.style['display'] = 'none';
    }

}
</script>

<table class="patchmeta">
 <tr>
  <th>Submitter</th>
  <td><a href="/project/LKML/list/?submitter=159">Al Viro</a></td>
 </tr>
 <tr>
  <th>Date</th>
  <td>Jan. 29, 2016, 7:18 p.m.</td>
 </tr>
 <tr>
  <th>Message ID</th>
  <td>&lt;1454095114-4128-9-git-send-email-viro@ZenIV.linux.org.uk&gt;</td>
 </tr>
 <tr>
  <th>Download</th>
  <td>
   <a href="/patch/8166711/mbox/"
   >mbox</a>
|
   <a href="/patch/8166711/raw/"
   >patch</a>

   </td>
 </tr>
 <tr>
  <th>Permalink</th>
  <td><a href="/patch/8166711/">/patch/8166711/</a>
 </tr>
  <tr>
   <th>State</th>
   <td>New</td>
  </tr>


 <tr>
  <th>Headers</th>
  <td><a id="togglepatchheaders"
   href="javascript:toggle_headers('togglepatchheaders', 'patchheaders')"
   >show</a>
   <div id="patchheaders" class="patchheaders" style="display:none;">
    <pre>Return-Path: &lt;linux-kernel-owner@kernel.org&gt;
X-Original-To: patchwork-LKML@patchwork.kernel.org
Delivered-To: patchwork-parsemail@patchwork2.web.kernel.org
Received: from mail.kernel.org (mail.kernel.org [198.145.29.136])
	by patchwork2.web.kernel.org (Postfix) with ESMTP id 77B78BEEE5
	for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Fri, 29 Jan 2016 19:20:20 +0000 (UTC)
Received: from mail.kernel.org (localhost [127.0.0.1])
	by mail.kernel.org (Postfix) with ESMTP id 2871420340
	for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Fri, 29 Jan 2016 19:20:18 +0000 (UTC)
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.kernel.org (Postfix) with ESMTP id 8F22720253
	for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Fri, 29 Jan 2016 19:20:15 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1756841AbcA2TTh (ORCPT
	&lt;rfc822;patchwork-LKML@patchwork.kernel.org&gt;);
	Fri, 29 Jan 2016 14:19:37 -0500
Received: from zeniv.linux.org.uk ([195.92.253.2]:49618 &quot;EHLO
	ZenIV.linux.org.uk&quot; rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1756682AbcA2TSh (ORCPT
	&lt;rfc822;linux-kernel@vger.kernel.org&gt;);
	Fri, 29 Jan 2016 14:18:37 -0500
Received: from viro by ZenIV.linux.org.uk with local (Exim 4.76 #1 (Red Hat
	Linux)) id 1aPEZ2-00015P-6K; Fri, 29 Jan 2016 19:18:36 +0000
From: Al Viro &lt;viro@ZenIV.linux.org.uk&gt;
To: linux-arch@vger.kernel.org
Cc: linux-kbuild@vger.kernel.org, linux-kernel@vger.kernel.org
Subject: [PATCH 09/12] sparc: move exports to definitions
Date: Fri, 29 Jan 2016 19:18:31 +0000
Message-Id: &lt;1454095114-4128-9-git-send-email-viro@ZenIV.linux.org.uk&gt;
X-Mailer: git-send-email 1.7.7.6
In-Reply-To: &lt;20160129191744.GB17997@ZenIV.linux.org.uk&gt;
References: &lt;20160129191744.GB17997@ZenIV.linux.org.uk&gt;
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: &lt;linux-kernel.vger.kernel.org&gt;
X-Mailing-List: linux-kernel@vger.kernel.org
X-Spam-Status: No, score=-6.9 required=5.0 tests=BAYES_00, RCVD_IN_DNSWL_HI, 
	RP_MATCHES_RCVD,
	UNPARSEABLE_RELAY autolearn=unavailable version=3.3.1
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on mail.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP
</pre>
   </div>
  </td>
 </tr>
</table>

<div class="patchforms">





 <div style="clear: both;">
 </div>
</div>



<h2>Comments</h2>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=159">Al Viro</a> - Jan. 29, 2016, 7:18 p.m.</div>
<pre class="content">
<span class="from">From: Al Viro &lt;viro@zeniv.linux.org.uk&gt;</span>
<span class="signed-off-by">
Signed-off-by: Al Viro &lt;viro@zeniv.linux.org.uk&gt;</span>
---
 arch/sparc/include/asm/Kbuild      |   1 +
 arch/sparc/kernel/Makefile         |   2 +-
 arch/sparc/kernel/entry.S          |   3 +
 arch/sparc/kernel/head_32.S        |   3 +
 arch/sparc/kernel/head_64.S        |   7 +-
 arch/sparc/kernel/helpers.S        |   2 +
 arch/sparc/kernel/hvcalls.S        |   4 +
 arch/sparc/kernel/sparc_ksyms.c    |  12 +++
 arch/sparc/kernel/sparc_ksyms_32.c |  31 -------
 arch/sparc/kernel/sparc_ksyms_64.c |  52 ------------
 arch/sparc/lib/Makefile            |   1 -
 arch/sparc/lib/U1memcpy.S          |   2 +
 arch/sparc/lib/VISsave.S           |   2 +
 arch/sparc/lib/ashldi3.S           |   2 +
 arch/sparc/lib/ashrdi3.S           |   2 +
 arch/sparc/lib/atomic_64.S         |  10 ++-
 arch/sparc/lib/bitops.S            |   7 ++
 arch/sparc/lib/blockops.S          |   3 +
 arch/sparc/lib/bzero.S             |   4 +
 arch/sparc/lib/checksum_32.S       |   3 +
 arch/sparc/lib/checksum_64.S       |   2 +
 arch/sparc/lib/clear_page.S        |   3 +
 arch/sparc/lib/copy_in_user.S      |   2 +
 arch/sparc/lib/copy_page.S         |   2 +
 arch/sparc/lib/copy_user.S         |   2 +
 arch/sparc/lib/csum_copy.S         |   3 +
 arch/sparc/lib/divdi3.S            |   2 +
 arch/sparc/lib/ffs.S               |   3 +
 arch/sparc/lib/hweight.S           |   5 ++
 arch/sparc/lib/ipcsum.S            |   2 +
 arch/sparc/lib/ksyms.c             | 165 -------------------------------------
 arch/sparc/lib/locks.S             |   5 ++
 arch/sparc/lib/lshrdi3.S           |   2 +
 arch/sparc/lib/mcount.S            |   2 +
 arch/sparc/lib/memcmp.S            |   2 +
 arch/sparc/lib/memcpy.S            |   4 +
 arch/sparc/lib/memmove.S           |   2 +
 arch/sparc/lib/memscan_32.S        |   4 +
 arch/sparc/lib/memscan_64.S        |   4 +
 arch/sparc/lib/memset.S            |   3 +
 arch/sparc/lib/muldi3.S            |   2 +
 arch/sparc/lib/strlen.S            |   2 +
 arch/sparc/lib/strncmp_32.S        |   2 +
 arch/sparc/lib/strncmp_64.S        |   2 +
 arch/sparc/lib/xor.S               |   9 ++
 45 files changed, 136 insertions(+), 253 deletions(-)
 create mode 100644 arch/sparc/kernel/sparc_ksyms.c
 delete mode 100644 arch/sparc/kernel/sparc_ksyms_32.c
 delete mode 100644 arch/sparc/kernel/sparc_ksyms_64.c
 delete mode 100644 arch/sparc/lib/ksyms.c
</pre>
</div>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=129">David Miller</a> - Jan. 30, 2016, 7:08 a.m.</div>
<pre class="content">
<span class="from">From: Al Viro &lt;viro@ZenIV.linux.org.uk&gt;</span>
Date: Fri, 29 Jan 2016 19:18:31 +0000
<span class="quote">
&gt; From: Al Viro &lt;viro@zeniv.linux.org.uk&gt;</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; Signed-off-by: Al Viro &lt;viro@zeniv.linux.org.uk&gt;</span>
<span class="acked-by">
Acked-by: David S. Miller &lt;davem@davemloft.net&gt;</span>
</pre>
</div>



<h2>Patch</h2>
<div class="patch">
<pre class="content">
<span class="p_header">diff --git a/arch/sparc/include/asm/Kbuild b/arch/sparc/include/asm/Kbuild</span>
<span class="p_header">index e9286188..17aa6b5 100644</span>
<span class="p_header">--- a/arch/sparc/include/asm/Kbuild</span>
<span class="p_header">+++ b/arch/sparc/include/asm/Kbuild</span>
<span class="p_chunk">@@ -6,6 +6,7 @@</span> <span class="p_context"> generic-y += cputime.h</span>
 generic-y += div64.h
 generic-y += emergency-restart.h
 generic-y += exec.h
<span class="p_add">+generic-y += export.h</span>
 generic-y += irq_regs.h
 generic-y += irq_work.h
 generic-y += linkage.h
<span class="p_header">diff --git a/arch/sparc/kernel/Makefile b/arch/sparc/kernel/Makefile</span>
<span class="p_header">index 7cf9c6e..2430127 100644</span>
<span class="p_header">--- a/arch/sparc/kernel/Makefile</span>
<span class="p_header">+++ b/arch/sparc/kernel/Makefile</span>
<span class="p_chunk">@@ -85,7 +85,7 @@</span> <span class="p_context"> obj-y                     += auxio_$(BITS).o</span>
 obj-$(CONFIG_SUN_PM)      += apc.o pmc.o
 
 obj-$(CONFIG_MODULES)     += module.o
<span class="p_del">-obj-$(CONFIG_MODULES)     += sparc_ksyms_$(BITS).o</span>
<span class="p_add">+obj-$(CONFIG_MODULES)     += sparc_ksyms.o</span>
 obj-$(CONFIG_SPARC_LED)   += led.o
 obj-$(CONFIG_KGDB)        += kgdb_$(BITS).o
 
<span class="p_header">diff --git a/arch/sparc/kernel/entry.S b/arch/sparc/kernel/entry.S</span>
<span class="p_header">index 33c02b1..c201b2b 100644</span>
<span class="p_header">--- a/arch/sparc/kernel/entry.S</span>
<span class="p_header">+++ b/arch/sparc/kernel/entry.S</span>
<span class="p_chunk">@@ -29,6 +29,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/unistd.h&gt;
 
 #include &lt;asm/asmmacro.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 #define curptr      g6
 
<span class="p_chunk">@@ -1190,6 +1191,8 @@</span> <span class="p_context"> delay_continue:</span>
 	
 	ret
 	restore
<span class="p_add">+EXPORT_SYMBOL(__udelay)</span>
<span class="p_add">+EXPORT_SYMBOL(__ndelay)</span>
 
 	/* Handle a software breakpoint */
 	/* We have to inform parent that child has stopped */
<span class="p_header">diff --git a/arch/sparc/kernel/head_32.S b/arch/sparc/kernel/head_32.S</span>
<span class="p_header">index 3d92c0a..7bb317b 100644</span>
<span class="p_header">--- a/arch/sparc/kernel/head_32.S</span>
<span class="p_header">+++ b/arch/sparc/kernel/head_32.S</span>
<span class="p_chunk">@@ -24,6 +24,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/thread_info.h&gt;	/* TI_UWINMASK */
 #include &lt;asm/errno.h&gt;
 #include &lt;asm/pgtsrmmu.h&gt;	/* SRMMU_PGDIR_SHIFT */
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	.data
 /* The following are used with the prom_vector node-ops to figure out
<span class="p_chunk">@@ -60,6 +61,7 @@</span> <span class="p_context"> sun4e_notsup:</span>
  */
 	.globl empty_zero_page
 empty_zero_page:	.skip PAGE_SIZE
<span class="p_add">+EXPORT_SYMBOL(empty_zero_page)</span>
 
 	.global root_flags
 	.global ram_flags
<span class="p_chunk">@@ -813,3 +815,4 @@</span> <span class="p_context"> lvl14_save:</span>
 __ret_efault:
         ret
          restore %g0, -EFAULT, %o0
<span class="p_add">+EXPORT_SYMBOL(__ret_efault)</span>
<span class="p_header">diff --git a/arch/sparc/kernel/head_64.S b/arch/sparc/kernel/head_64.S</span>
<span class="p_header">index f2d30ca..aae4ae0 100644</span>
<span class="p_header">--- a/arch/sparc/kernel/head_64.S</span>
<span class="p_header">+++ b/arch/sparc/kernel/head_64.S</span>
<span class="p_chunk">@@ -32,7 +32,8 @@</span> <span class="p_context"></span>
 #include &lt;asm/estate.h&gt;
 #include &lt;asm/sfafsr.h&gt;
 #include &lt;asm/unistd.h&gt;
<span class="p_del">-	</span>
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
<span class="p_add">+</span>
 /* This section from from _start to sparc64_boot_end should fit into
  * 0x0000000000404000 to 0x0000000000408000.
  */
<span class="p_chunk">@@ -143,6 +144,7 @@</span> <span class="p_context"> prom_cpu_compatible:</span>
 	.skip	64
 prom_root_node:
 	.word	0
<span class="p_add">+EXPORT_SYMBOL(prom_root_node)</span>
 prom_mmu_ihandle_cache:
 	.word	0
 prom_boot_mapped_pc:
<span class="p_chunk">@@ -158,6 +160,7 @@</span> <span class="p_context"> is_sun4v:</span>
 	.word	0
 sun4v_chip_type:
 	.word	SUN4V_CHIP_INVALID
<span class="p_add">+EXPORT_SYMBOL(sun4v_chip_type)</span>
 1:
 	rd	%pc, %l0
 
<span class="p_chunk">@@ -928,6 +931,7 @@</span> <span class="p_context"> swapper_4m_tsb:</span>
 	.globl	prom_tba, tlb_type
 prom_tba:	.xword	0
 tlb_type:	.word	0	/* Must NOT end up in BSS */
<span class="p_add">+EXPORT_SYMBOL(tlb_type)</span>
 	.section	&quot;.fixup&quot;,#alloc,#execinstr
 
 	.globl	__ret_efault, __retl_efault, __ret_one, __retl_one
<span class="p_chunk">@@ -935,6 +939,7 @@</span> <span class="p_context"> ENTRY(__ret_efault)</span>
 	ret
 	 restore %g0, -EFAULT, %o0
 ENDPROC(__ret_efault)
<span class="p_add">+EXPORT_SYMBOL(__ret_efault)</span>
 
 ENTRY(__retl_efault)
 	retl
<span class="p_header">diff --git a/arch/sparc/kernel/helpers.S b/arch/sparc/kernel/helpers.S</span>
<span class="p_header">index 314dd0c..e4e5b83 100644</span>
<span class="p_header">--- a/arch/sparc/kernel/helpers.S</span>
<span class="p_header">+++ b/arch/sparc/kernel/helpers.S</span>
<span class="p_chunk">@@ -15,6 +15,7 @@</span> <span class="p_context"> __flushw_user:</span>
 2:	retl
 	 nop
 	.size	__flushw_user,.-__flushw_user
<span class="p_add">+EXPORT_SYMBOL(__flushw_user)</span>
 
 	/* Flush %fp and %i7 to the stack for all register
 	 * windows active inside of the cpu.  This allows
<span class="p_chunk">@@ -61,3 +62,4 @@</span> <span class="p_context"> real_hard_smp_processor_id:</span>
 	.size		hard_smp_processor_id,.-hard_smp_processor_id
 #endif
 	.size		real_hard_smp_processor_id,.-real_hard_smp_processor_id
<span class="p_add">+EXPORT_SYMBOL_GPL(real_hard_smp_processor_id)</span>
<span class="p_header">diff --git a/arch/sparc/kernel/hvcalls.S b/arch/sparc/kernel/hvcalls.S</span>
<span class="p_header">index afbaba5..64b1c2f 100644</span>
<span class="p_header">--- a/arch/sparc/kernel/hvcalls.S</span>
<span class="p_header">+++ b/arch/sparc/kernel/hvcalls.S</span>
<span class="p_chunk">@@ -775,6 +775,7 @@</span> <span class="p_context"> ENTRY(sun4v_niagara_getperf)</span>
 	retl
 	 nop
 ENDPROC(sun4v_niagara_getperf)
<span class="p_add">+EXPORT_SYMBOL(sun4v_niagara_getperf)</span>
 
 ENTRY(sun4v_niagara_setperf)
 	mov	HV_FAST_SET_PERFREG, %o5
<span class="p_chunk">@@ -782,6 +783,7 @@</span> <span class="p_context"> ENTRY(sun4v_niagara_setperf)</span>
 	retl
 	 nop
 ENDPROC(sun4v_niagara_setperf)
<span class="p_add">+EXPORT_SYMBOL(sun4v_niagara_setperf)</span>
 
 ENTRY(sun4v_niagara2_getperf)
 	mov	%o0, %o4
<span class="p_chunk">@@ -791,6 +793,7 @@</span> <span class="p_context"> ENTRY(sun4v_niagara2_getperf)</span>
 	retl
 	 nop
 ENDPROC(sun4v_niagara2_getperf)
<span class="p_add">+EXPORT_SYMBOL(sun4v_niagara2_getperf)</span>
 
 ENTRY(sun4v_niagara2_setperf)
 	mov	HV_FAST_N2_SET_PERFREG, %o5
<span class="p_chunk">@@ -798,6 +801,7 @@</span> <span class="p_context"> ENTRY(sun4v_niagara2_setperf)</span>
 	retl
 	 nop
 ENDPROC(sun4v_niagara2_setperf)
<span class="p_add">+EXPORT_SYMBOL(sun4v_niagara2_setperf)</span>
 
 ENTRY(sun4v_reboot_data_set)
 	mov	HV_FAST_REBOOT_DATA_SET, %o5
<span class="p_header">diff --git a/arch/sparc/kernel/sparc_ksyms.c b/arch/sparc/kernel/sparc_ksyms.c</span>
new file mode 100644
<span class="p_header">index 0000000..09aa69e</span>
<span class="p_header">--- /dev/null</span>
<span class="p_header">+++ b/arch/sparc/kernel/sparc_ksyms.c</span>
<span class="p_chunk">@@ -0,0 +1,12 @@</span> <span class="p_context"></span>
<span class="p_add">+/*</span>
<span class="p_add">+ * arch/sparc/kernel/ksyms.c: Sparc specific ksyms support.</span>
<span class="p_add">+ *</span>
<span class="p_add">+ * Copyright (C) 1996 David S. Miller (davem@caip.rutgers.edu)</span>
<span class="p_add">+ * Copyright (C) 1996 Eddie C. Dost (ecd@skynet.be)</span>
<span class="p_add">+ */</span>
<span class="p_add">+</span>
<span class="p_add">+#include &lt;linux/init.h&gt;</span>
<span class="p_add">+#include &lt;linux/export.h&gt;</span>
<span class="p_add">+</span>
<span class="p_add">+/* This is needed only for drivers/sbus/char/openprom.c */</span>
<span class="p_add">+EXPORT_SYMBOL(saved_command_line);</span>
<span class="p_header">diff --git a/arch/sparc/kernel/sparc_ksyms_32.c b/arch/sparc/kernel/sparc_ksyms_32.c</span>
deleted file mode 100644
<span class="p_header">index bf4ccb1..0000000</span>
<span class="p_header">--- a/arch/sparc/kernel/sparc_ksyms_32.c</span>
<span class="p_header">+++ /dev/null</span>
<span class="p_chunk">@@ -1,31 +0,0 @@</span> <span class="p_context"></span>
<span class="p_del">-/*</span>
<span class="p_del">- * arch/sparc/kernel/ksyms.c: Sparc specific ksyms support.</span>
<span class="p_del">- *</span>
<span class="p_del">- * Copyright (C) 1996 David S. Miller (davem@caip.rutgers.edu)</span>
<span class="p_del">- * Copyright (C) 1996 Eddie C. Dost (ecd@skynet.be)</span>
<span class="p_del">- */</span>
<span class="p_del">-</span>
<span class="p_del">-#include &lt;linux/module.h&gt;</span>
<span class="p_del">-</span>
<span class="p_del">-#include &lt;asm/pgtable.h&gt;</span>
<span class="p_del">-#include &lt;asm/uaccess.h&gt;</span>
<span class="p_del">-#include &lt;asm/delay.h&gt;</span>
<span class="p_del">-#include &lt;asm/head.h&gt;</span>
<span class="p_del">-#include &lt;asm/dma.h&gt;</span>
<span class="p_del">-</span>
<span class="p_del">-struct poll {</span>
<span class="p_del">-	int fd;</span>
<span class="p_del">-	short events;</span>
<span class="p_del">-	short revents;</span>
<span class="p_del">-};</span>
<span class="p_del">-</span>
<span class="p_del">-/* from entry.S */</span>
<span class="p_del">-EXPORT_SYMBOL(__udelay);</span>
<span class="p_del">-EXPORT_SYMBOL(__ndelay);</span>
<span class="p_del">-</span>
<span class="p_del">-/* from head_32.S */</span>
<span class="p_del">-EXPORT_SYMBOL(__ret_efault);</span>
<span class="p_del">-EXPORT_SYMBOL(empty_zero_page);</span>
<span class="p_del">-</span>
<span class="p_del">-/* Exporting a symbol from /init/main.c */</span>
<span class="p_del">-EXPORT_SYMBOL(saved_command_line);</span>
<span class="p_header">diff --git a/arch/sparc/kernel/sparc_ksyms_64.c b/arch/sparc/kernel/sparc_ksyms_64.c</span>
deleted file mode 100644
<span class="p_header">index a92d5d2..0000000</span>
<span class="p_header">--- a/arch/sparc/kernel/sparc_ksyms_64.c</span>
<span class="p_header">+++ /dev/null</span>
<span class="p_chunk">@@ -1,52 +0,0 @@</span> <span class="p_context"></span>
<span class="p_del">-/* arch/sparc64/kernel/sparc64_ksyms.c: Sparc64 specific ksyms support.</span>
<span class="p_del">- *</span>
<span class="p_del">- * Copyright (C) 1996, 2007 David S. Miller (davem@davemloft.net)</span>
<span class="p_del">- * Copyright (C) 1996 Eddie C. Dost (ecd@skynet.be)</span>
<span class="p_del">- * Copyright (C) 1999 Jakub Jelinek (jj@ultra.linux.cz)</span>
<span class="p_del">- */</span>
<span class="p_del">-</span>
<span class="p_del">-#include &lt;linux/export.h&gt;</span>
<span class="p_del">-#include &lt;linux/pci.h&gt;</span>
<span class="p_del">-#include &lt;linux/bitops.h&gt;</span>
<span class="p_del">-</span>
<span class="p_del">-#include &lt;asm/cpudata.h&gt;</span>
<span class="p_del">-#include &lt;asm/uaccess.h&gt;</span>
<span class="p_del">-#include &lt;asm/spitfire.h&gt;</span>
<span class="p_del">-#include &lt;asm/oplib.h&gt;</span>
<span class="p_del">-#include &lt;asm/hypervisor.h&gt;</span>
<span class="p_del">-#include &lt;asm/cacheflush.h&gt;</span>
<span class="p_del">-</span>
<span class="p_del">-struct poll {</span>
<span class="p_del">-	int fd;</span>
<span class="p_del">-	short events;</span>
<span class="p_del">-	short revents;</span>
<span class="p_del">-};</span>
<span class="p_del">-</span>
<span class="p_del">-/* from helpers.S */</span>
<span class="p_del">-EXPORT_SYMBOL(__flushw_user);</span>
<span class="p_del">-EXPORT_SYMBOL_GPL(real_hard_smp_processor_id);</span>
<span class="p_del">-</span>
<span class="p_del">-/* from head_64.S */</span>
<span class="p_del">-EXPORT_SYMBOL(__ret_efault);</span>
<span class="p_del">-EXPORT_SYMBOL(tlb_type);</span>
<span class="p_del">-EXPORT_SYMBOL(sun4v_chip_type);</span>
<span class="p_del">-EXPORT_SYMBOL(prom_root_node);</span>
<span class="p_del">-</span>
<span class="p_del">-/* from hvcalls.S */</span>
<span class="p_del">-EXPORT_SYMBOL(sun4v_niagara_getperf);</span>
<span class="p_del">-EXPORT_SYMBOL(sun4v_niagara_setperf);</span>
<span class="p_del">-EXPORT_SYMBOL(sun4v_niagara2_getperf);</span>
<span class="p_del">-EXPORT_SYMBOL(sun4v_niagara2_setperf);</span>
<span class="p_del">-</span>
<span class="p_del">-/* from hweight.S */</span>
<span class="p_del">-EXPORT_SYMBOL(__arch_hweight8);</span>
<span class="p_del">-EXPORT_SYMBOL(__arch_hweight16);</span>
<span class="p_del">-EXPORT_SYMBOL(__arch_hweight32);</span>
<span class="p_del">-EXPORT_SYMBOL(__arch_hweight64);</span>
<span class="p_del">-</span>
<span class="p_del">-/* from ffs_ffz.S */</span>
<span class="p_del">-EXPORT_SYMBOL(ffs);</span>
<span class="p_del">-EXPORT_SYMBOL(__ffs);</span>
<span class="p_del">-</span>
<span class="p_del">-/* Exporting a symbol from /init/main.c */</span>
<span class="p_del">-EXPORT_SYMBOL(saved_command_line);</span>
<span class="p_header">diff --git a/arch/sparc/lib/Makefile b/arch/sparc/lib/Makefile</span>
<span class="p_header">index 3269b02..885f00e 100644</span>
<span class="p_header">--- a/arch/sparc/lib/Makefile</span>
<span class="p_header">+++ b/arch/sparc/lib/Makefile</span>
<span class="p_chunk">@@ -43,5 +43,4 @@</span> <span class="p_context"> lib-$(CONFIG_SPARC64) += mcount.o ipcsum.o xor.o hweight.o ffs.o</span>
 
 obj-$(CONFIG_SPARC64) += iomap.o
 obj-$(CONFIG_SPARC32) += atomic32.o ucmpdi2.o
<span class="p_del">-obj-y                 += ksyms.o</span>
 obj-$(CONFIG_SPARC64) += PeeCeeI.o
<span class="p_header">diff --git a/arch/sparc/lib/U1memcpy.S b/arch/sparc/lib/U1memcpy.S</span>
<span class="p_header">index 3e6209e..97e1b21 100644</span>
<span class="p_header">--- a/arch/sparc/lib/U1memcpy.S</span>
<span class="p_header">+++ b/arch/sparc/lib/U1memcpy.S</span>
<span class="p_chunk">@@ -7,6 +7,7 @@</span> <span class="p_context"></span>
 #ifdef __KERNEL__
 #include &lt;asm/visasm.h&gt;
 #include &lt;asm/asi.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 #define GLOBAL_SPARE	g7
 #else
 #define GLOBAL_SPARE	g5
<span class="p_chunk">@@ -567,3 +568,4 @@</span> <span class="p_context"> FUNC_NAME:		/* %o0=dst, %o1=src, %o2=len */</span>
 	 mov		EX_RETVAL(%o4), %o0
 
 	.size		FUNC_NAME, .-FUNC_NAME
<span class="p_add">+EXPORT_SYMBOL(FUNC_NAME)</span>
<span class="p_header">diff --git a/arch/sparc/lib/VISsave.S b/arch/sparc/lib/VISsave.S</span>
<span class="p_header">index 62c2647b..1c7b6a3 100644</span>
<span class="p_header">--- a/arch/sparc/lib/VISsave.S</span>
<span class="p_header">+++ b/arch/sparc/lib/VISsave.S</span>
<span class="p_chunk">@@ -13,6 +13,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/ptrace.h&gt;
 #include &lt;asm/visasm.h&gt;
 #include &lt;asm/thread_info.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	/* On entry: %o5=current FPRS value, %g7 is callers address */
 	/* May clobber %o5, %g1, %g2, %g3, %g7, %icc, %xcc */
<span class="p_chunk">@@ -79,3 +80,4 @@</span> <span class="p_context"> vis1:	ldub		[%g6 + TI_FPSAVED], %g3</span>
 80:	jmpl		%g7 + %g0, %g0
 	 nop
 ENDPROC(VISenter)
<span class="p_add">+EXPORT_SYMBOL(VISenter)</span>
<span class="p_header">diff --git a/arch/sparc/lib/ashldi3.S b/arch/sparc/lib/ashldi3.S</span>
<span class="p_header">index 86f60de..c8b1cf7 100644</span>
<span class="p_header">--- a/arch/sparc/lib/ashldi3.S</span>
<span class="p_header">+++ b/arch/sparc/lib/ashldi3.S</span>
<span class="p_chunk">@@ -6,6 +6,7 @@</span> <span class="p_context"></span>
  */
 
 #include &lt;linux/linkage.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	.text
 ENTRY(__ashldi3)
<span class="p_chunk">@@ -33,3 +34,4 @@</span> <span class="p_context"> ENTRY(__ashldi3)</span>
 	retl
 	 nop
 ENDPROC(__ashldi3)
<span class="p_add">+EXPORT_SYMBOL(__ashldi3)</span>
<span class="p_header">diff --git a/arch/sparc/lib/ashrdi3.S b/arch/sparc/lib/ashrdi3.S</span>
<span class="p_header">index 6eb8ba2..4310256 100644</span>
<span class="p_header">--- a/arch/sparc/lib/ashrdi3.S</span>
<span class="p_header">+++ b/arch/sparc/lib/ashrdi3.S</span>
<span class="p_chunk">@@ -6,6 +6,7 @@</span> <span class="p_context"></span>
  */
 
 #include &lt;linux/linkage.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	.text
 ENTRY(__ashrdi3)
<span class="p_chunk">@@ -35,3 +36,4 @@</span> <span class="p_context"> ENTRY(__ashrdi3)</span>
 	jmpl	%o7 + 8, %g0
 	 nop
 ENDPROC(__ashrdi3)
<span class="p_add">+EXPORT_SYMBOL(__ashrdi3)</span>
<span class="p_header">diff --git a/arch/sparc/lib/atomic_64.S b/arch/sparc/lib/atomic_64.S</span>
<span class="p_header">index d6b0363..52c927c 100644</span>
<span class="p_header">--- a/arch/sparc/lib/atomic_64.S</span>
<span class="p_header">+++ b/arch/sparc/lib/atomic_64.S</span>
<span class="p_chunk">@@ -6,6 +6,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/linkage.h&gt;
 #include &lt;asm/asi.h&gt;
 #include &lt;asm/backoff.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	.text
 
<span class="p_chunk">@@ -28,6 +29,7 @@</span> <span class="p_context"> ENTRY(atomic_##op) /* %o0 = increment, %o1 = atomic_ptr */		\</span>
 	 nop;								\
 2:	BACKOFF_SPIN(%o2, %o3, 1b);					\
 ENDPROC(atomic_##op);							\
<span class="p_add">+EXPORT_SYMBOL(atomic_##op);						\</span>
 
 #define ATOMIC_OP_RETURN(op)						\
 ENTRY(atomic_##op##_return) /* %o0 = increment, %o1 = atomic_ptr */	\
<span class="p_chunk">@@ -41,7 +43,8 @@</span> <span class="p_context"> ENTRY(atomic_##op##_return) /* %o0 = increment, %o1 = atomic_ptr */	\</span>
 	retl;								\
 	 sra	%g1, 0, %o0;						\
 2:	BACKOFF_SPIN(%o2, %o3, 1b);					\
<span class="p_del">-ENDPROC(atomic_##op##_return);</span>
<span class="p_add">+ENDPROC(atomic_##op##_return);						\</span>
<span class="p_add">+EXPORT_SYMBOL(atomic_##op##_return);					\</span>
 
 #define ATOMIC_OPS(op) ATOMIC_OP(op) ATOMIC_OP_RETURN(op)
 
<span class="p_chunk">@@ -68,6 +71,7 @@</span> <span class="p_context"> ENTRY(atomic64_##op) /* %o0 = increment, %o1 = atomic_ptr */		\</span>
 	 nop;								\
 2:	BACKOFF_SPIN(%o2, %o3, 1b);					\
 ENDPROC(atomic64_##op);							\
<span class="p_add">+EXPORT_SYMBOL(atomic64_##op);						\</span>
 
 #define ATOMIC64_OP_RETURN(op)						\
 ENTRY(atomic64_##op##_return) /* %o0 = increment, %o1 = atomic_ptr */	\
<span class="p_chunk">@@ -81,7 +85,8 @@</span> <span class="p_context"> ENTRY(atomic64_##op##_return) /* %o0 = increment, %o1 = atomic_ptr */	\</span>
 	retl;								\
 	 op	%g1, %o0, %o0;						\
 2:	BACKOFF_SPIN(%o2, %o3, 1b);					\
<span class="p_del">-ENDPROC(atomic64_##op##_return);</span>
<span class="p_add">+ENDPROC(atomic64_##op##_return);					\</span>
<span class="p_add">+EXPORT_SYMBOL(atomic64_##op##_return);</span>
 
 #define ATOMIC64_OPS(op) ATOMIC64_OP(op) ATOMIC64_OP_RETURN(op)
 
<span class="p_chunk">@@ -108,3 +113,4 @@</span> <span class="p_context"> ENTRY(atomic64_dec_if_positive) /* %o0 = atomic_ptr */</span>
 	 sub	%g1, 1, %o0
 2:	BACKOFF_SPIN(%o2, %o3, 1b)
 ENDPROC(atomic64_dec_if_positive)
<span class="p_add">+EXPORT_SYMBOL(atomic64_dec_if_positive)</span>
<span class="p_header">diff --git a/arch/sparc/lib/bitops.S b/arch/sparc/lib/bitops.S</span>
<span class="p_header">index 36f72cc..7031bf1 100644</span>
<span class="p_header">--- a/arch/sparc/lib/bitops.S</span>
<span class="p_header">+++ b/arch/sparc/lib/bitops.S</span>
<span class="p_chunk">@@ -6,6 +6,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/linkage.h&gt;
 #include &lt;asm/asi.h&gt;
 #include &lt;asm/backoff.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	.text
 
<span class="p_chunk">@@ -29,6 +30,7 @@</span> <span class="p_context"> ENTRY(test_and_set_bit)	/* %o0=nr, %o1=addr */</span>
 	 nop
 2:	BACKOFF_SPIN(%o3, %o4, 1b)
 ENDPROC(test_and_set_bit)
<span class="p_add">+EXPORT_SYMBOL(test_and_set_bit)</span>
 
 ENTRY(test_and_clear_bit) /* %o0=nr, %o1=addr */
 	BACKOFF_SETUP(%o3)
<span class="p_chunk">@@ -50,6 +52,7 @@</span> <span class="p_context"> ENTRY(test_and_clear_bit) /* %o0=nr, %o1=addr */</span>
 	 nop
 2:	BACKOFF_SPIN(%o3, %o4, 1b)
 ENDPROC(test_and_clear_bit)
<span class="p_add">+EXPORT_SYMBOL(test_and_clear_bit)</span>
 
 ENTRY(test_and_change_bit) /* %o0=nr, %o1=addr */
 	BACKOFF_SETUP(%o3)
<span class="p_chunk">@@ -71,6 +74,7 @@</span> <span class="p_context"> ENTRY(test_and_change_bit) /* %o0=nr, %o1=addr */</span>
 	 nop
 2:	BACKOFF_SPIN(%o3, %o4, 1b)
 ENDPROC(test_and_change_bit)
<span class="p_add">+EXPORT_SYMBOL(test_and_change_bit)</span>
 
 ENTRY(set_bit) /* %o0=nr, %o1=addr */
 	BACKOFF_SETUP(%o3)
<span class="p_chunk">@@ -90,6 +94,7 @@</span> <span class="p_context"> ENTRY(set_bit) /* %o0=nr, %o1=addr */</span>
 	 nop
 2:	BACKOFF_SPIN(%o3, %o4, 1b)
 ENDPROC(set_bit)
<span class="p_add">+EXPORT_SYMBOL(set_bit)</span>
 
 ENTRY(clear_bit) /* %o0=nr, %o1=addr */
 	BACKOFF_SETUP(%o3)
<span class="p_chunk">@@ -109,6 +114,7 @@</span> <span class="p_context"> ENTRY(clear_bit) /* %o0=nr, %o1=addr */</span>
 	 nop
 2:	BACKOFF_SPIN(%o3, %o4, 1b)
 ENDPROC(clear_bit)
<span class="p_add">+EXPORT_SYMBOL(clear_bit)</span>
 
 ENTRY(change_bit) /* %o0=nr, %o1=addr */
 	BACKOFF_SETUP(%o3)
<span class="p_chunk">@@ -128,3 +134,4 @@</span> <span class="p_context"> ENTRY(change_bit) /* %o0=nr, %o1=addr */</span>
 	 nop
 2:	BACKOFF_SPIN(%o3, %o4, 1b)
 ENDPROC(change_bit)
<span class="p_add">+EXPORT_SYMBOL(change_bit)</span>
<span class="p_header">diff --git a/arch/sparc/lib/blockops.S b/arch/sparc/lib/blockops.S</span>
<span class="p_header">index 3c77101..1f2692d5 100644</span>
<span class="p_header">--- a/arch/sparc/lib/blockops.S</span>
<span class="p_header">+++ b/arch/sparc/lib/blockops.S</span>
<span class="p_chunk">@@ -6,6 +6,7 @@</span> <span class="p_context"></span>
 
 #include &lt;linux/linkage.h&gt;
 #include &lt;asm/page.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	/* Zero out 64 bytes of memory at (buf + offset).
 	 * Assumes %g1 contains zero.
<span class="p_chunk">@@ -64,6 +65,7 @@</span> <span class="p_context"> ENTRY(bzero_1page)</span>
 	retl
 	 nop
 ENDPROC(bzero_1page)
<span class="p_add">+EXPORT_SYMBOL(bzero_1page)</span>
 
 ENTRY(__copy_1page)
 /* NOTE: If you change the number of insns of this routine, please check
<span class="p_chunk">@@ -87,3 +89,4 @@</span> <span class="p_context"> ENTRY(__copy_1page)</span>
 	retl
 	 nop
 ENDPROC(__copy_1page)
<span class="p_add">+EXPORT_SYMBOL(__copy_1page)</span>
<span class="p_header">diff --git a/arch/sparc/lib/bzero.S b/arch/sparc/lib/bzero.S</span>
<span class="p_header">index 8c05811..3bb1914 100644</span>
<span class="p_header">--- a/arch/sparc/lib/bzero.S</span>
<span class="p_header">+++ b/arch/sparc/lib/bzero.S</span>
<span class="p_chunk">@@ -5,6 +5,7 @@</span> <span class="p_context"></span>
  */
 
 #include &lt;linux/linkage.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	.text
 
<span class="p_chunk">@@ -78,6 +79,8 @@</span> <span class="p_context"> __bzero_done:</span>
 	 mov		%o3, %o0
 ENDPROC(__bzero)
 ENDPROC(memset)
<span class="p_add">+EXPORT_SYMBOL(__bzero)</span>
<span class="p_add">+EXPORT_SYMBOL(memset)</span>
 
 #define EX_ST(x,y)		\
 98:	x,y;			\
<span class="p_chunk">@@ -143,3 +146,4 @@</span> <span class="p_context"> __clear_user_done:</span>
 	retl
 	 clr		%o0
 ENDPROC(__clear_user)
<span class="p_add">+EXPORT_SYMBOL(__clear_user)</span>
<span class="p_header">diff --git a/arch/sparc/lib/checksum_32.S b/arch/sparc/lib/checksum_32.S</span>
<span class="p_header">index 0084c33..c9d8b62 100644</span>
<span class="p_header">--- a/arch/sparc/lib/checksum_32.S</span>
<span class="p_header">+++ b/arch/sparc/lib/checksum_32.S</span>
<span class="p_chunk">@@ -14,6 +14,7 @@</span> <span class="p_context"></span>
  */
 
 #include &lt;asm/errno.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 #define CSUM_BIGCHUNK(buf, offset, sum, t0, t1, t2, t3, t4, t5)	\
 	ldd	[buf + offset + 0x00], t0;			\
<span class="p_chunk">@@ -104,6 +105,7 @@</span> <span class="p_context"> csum_partial_fix_alignment:</span>
 	 * buffer of size 0x20.  Follow the code path for that case.
 	 */
 	.globl	csum_partial
<span class="p_add">+	EXPORT_SYMBOL(csum_partial)</span>
 csum_partial:			/* %o0=buf, %o1=len, %o2=sum */
 	andcc	%o0, 0x7, %g0				! alignment problems?
 	bne	csum_partial_fix_alignment		! yep, handle it
<span class="p_chunk">@@ -335,6 +337,7 @@</span> <span class="p_context"> cc_dword_align:</span>
 	 */
 	.align	8
 	.globl	__csum_partial_copy_sparc_generic
<span class="p_add">+	EXPORT_SYMBOL(__csum_partial_copy_sparc_generic)</span>
 __csum_partial_copy_sparc_generic:
 					/* %o0=src, %o1=dest, %g1=len, %g7=sum */
 	xor	%o0, %o1, %o4		! get changing bits
<span class="p_header">diff --git a/arch/sparc/lib/checksum_64.S b/arch/sparc/lib/checksum_64.S</span>
<span class="p_header">index 1d230f6..f673217 100644</span>
<span class="p_header">--- a/arch/sparc/lib/checksum_64.S</span>
<span class="p_header">+++ b/arch/sparc/lib/checksum_64.S</span>
<span class="p_chunk">@@ -13,6 +13,7 @@</span> <span class="p_context"></span>
  *	BSD4.4 portable checksum routine
  */
 
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 	.text
 
 csum_partial_fix_alignment:
<span class="p_chunk">@@ -37,6 +38,7 @@</span> <span class="p_context"> csum_partial_fix_alignment:</span>
 
 	.align		32
 	.globl		csum_partial
<span class="p_add">+	EXPORT_SYMBOL(csum_partial)</span>
 csum_partial:		/* %o0=buff, %o1=len, %o2=sum */
 	prefetch	[%o0 + 0x000], #n_reads
 	clr		%o4
<span class="p_header">diff --git a/arch/sparc/lib/clear_page.S b/arch/sparc/lib/clear_page.S</span>
<span class="p_header">index 46272df..f30d6b7 100644</span>
<span class="p_header">--- a/arch/sparc/lib/clear_page.S</span>
<span class="p_header">+++ b/arch/sparc/lib/clear_page.S</span>
<span class="p_chunk">@@ -10,6 +10,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/pgtable.h&gt;
 #include &lt;asm/spitfire.h&gt;
 #include &lt;asm/head.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	/* What we used to do was lock a TLB entry into a specific
 	 * TLB slot, clear the page with interrupts disabled, then
<span class="p_chunk">@@ -26,6 +27,7 @@</span> <span class="p_context"></span>
 	.text
 
 	.globl		_clear_page
<span class="p_add">+	EXPORT_SYMBOL(_clear_page)</span>
 _clear_page:		/* %o0=dest */
 	ba,pt		%xcc, clear_page_common
 	 clr		%o4
<span class="p_chunk">@@ -35,6 +37,7 @@</span> <span class="p_context"> _clear_page:		/* %o0=dest */</span>
 	 */
 	.align		32
 	.globl		clear_user_page
<span class="p_add">+	EXPORT_SYMBOL(clear_user_page)</span>
 clear_user_page:	/* %o0=dest, %o1=vaddr */
 	lduw		[%g6 + TI_PRE_COUNT], %o2
 	sethi		%hi(PAGE_OFFSET), %g2
<span class="p_header">diff --git a/arch/sparc/lib/copy_in_user.S b/arch/sparc/lib/copy_in_user.S</span>
<span class="p_header">index 302c0e6..482de09 100644</span>
<span class="p_header">--- a/arch/sparc/lib/copy_in_user.S</span>
<span class="p_header">+++ b/arch/sparc/lib/copy_in_user.S</span>
<span class="p_chunk">@@ -5,6 +5,7 @@</span> <span class="p_context"></span>
 
 #include &lt;linux/linkage.h&gt;
 #include &lt;asm/asi.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 #define XCC xcc
 
<span class="p_chunk">@@ -90,3 +91,4 @@</span> <span class="p_context"> ENTRY(___copy_in_user)	/* %o0=dst, %o1=src, %o2=len */</span>
 	retl
 	 clr		%o0
 ENDPROC(___copy_in_user)
<span class="p_add">+EXPORT_SYMBOL(___copy_in_user)</span>
<span class="p_header">diff --git a/arch/sparc/lib/copy_page.S b/arch/sparc/lib/copy_page.S</span>
<span class="p_header">index dd16c61..7197b72 100644</span>
<span class="p_header">--- a/arch/sparc/lib/copy_page.S</span>
<span class="p_header">+++ b/arch/sparc/lib/copy_page.S</span>
<span class="p_chunk">@@ -10,6 +10,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/pgtable.h&gt;
 #include &lt;asm/spitfire.h&gt;
 #include &lt;asm/head.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	/* What we used to do was lock a TLB entry into a specific
 	 * TLB slot, clear the page with interrupts disabled, then
<span class="p_chunk">@@ -44,6 +45,7 @@</span> <span class="p_context"></span>
 	.align		32
 	.globl		copy_user_page
 	.type		copy_user_page,#function
<span class="p_add">+	EXPORT_SYMBOL(copy_user_page)</span>
 copy_user_page:		/* %o0=dest, %o1=src, %o2=vaddr */
 	lduw		[%g6 + TI_PRE_COUNT], %o4
 	sethi		%hi(PAGE_OFFSET), %g2
<span class="p_header">diff --git a/arch/sparc/lib/copy_user.S b/arch/sparc/lib/copy_user.S</span>
<span class="p_header">index ef095b6..cea644d 100644</span>
<span class="p_header">--- a/arch/sparc/lib/copy_user.S</span>
<span class="p_header">+++ b/arch/sparc/lib/copy_user.S</span>
<span class="p_chunk">@@ -15,6 +15,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/asmmacro.h&gt;
 #include &lt;asm/page.h&gt;
 #include &lt;asm/thread_info.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 /* Work around cpp -rob */
 #define ALLOC #alloc
<span class="p_chunk">@@ -119,6 +120,7 @@</span> <span class="p_context"></span>
 __copy_user_begin:
 
 	.globl	__copy_user
<span class="p_add">+	EXPORT_SYMBOL(__copy_user)</span>
 dword_align:
 	andcc	%o1, 1, %g0
 	be	4f
<span class="p_header">diff --git a/arch/sparc/lib/csum_copy.S b/arch/sparc/lib/csum_copy.S</span>
<span class="p_header">index e566c77..0ecbafc 100644</span>
<span class="p_header">--- a/arch/sparc/lib/csum_copy.S</span>
<span class="p_header">+++ b/arch/sparc/lib/csum_copy.S</span>
<span class="p_chunk">@@ -3,6 +3,8 @@</span> <span class="p_context"></span>
  * Copyright (C) 2005 David S. Miller &lt;davem@davemloft.net&gt;
  */
 
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
<span class="p_add">+</span>
 #ifdef __KERNEL__
 #define GLOBAL_SPARE	%g7
 #else
<span class="p_chunk">@@ -63,6 +65,7 @@</span> <span class="p_context"></span>
 	 add		%o5, %o4, %o4
 
 	.globl		FUNC_NAME
<span class="p_add">+	EXPORT_SYMBOL(FUNC_NAME)</span>
 FUNC_NAME:		/* %o0=src, %o1=dst, %o2=len, %o3=sum */
 	LOAD(prefetch, %o0 + 0x000, #n_reads)
 	xor		%o0, %o1, %g1
<span class="p_header">diff --git a/arch/sparc/lib/divdi3.S b/arch/sparc/lib/divdi3.S</span>
<span class="p_header">index 9614b48..a2b5a97 100644</span>
<span class="p_header">--- a/arch/sparc/lib/divdi3.S</span>
<span class="p_header">+++ b/arch/sparc/lib/divdi3.S</span>
<span class="p_chunk">@@ -17,6 +17,7 @@</span> <span class="p_context"> along with GNU CC; see the file COPYING.  If not, write to</span>
 the Free Software Foundation, 59 Temple Place - Suite 330,
 Boston, MA 02111-1307, USA.  */
 
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 	.text
 	.align 4
 	.globl __divdi3
<span class="p_chunk">@@ -279,3 +280,4 @@</span> <span class="p_context"> __divdi3:</span>
 .LL81:
 	ret
 	restore
<span class="p_add">+EXPORT_SYMBOL(__divdi3)</span>
<span class="p_header">diff --git a/arch/sparc/lib/ffs.S b/arch/sparc/lib/ffs.S</span>
<span class="p_header">index b39389f..23aab14 100644</span>
<span class="p_header">--- a/arch/sparc/lib/ffs.S</span>
<span class="p_header">+++ b/arch/sparc/lib/ffs.S</span>
<span class="p_chunk">@@ -1,4 +1,5 @@</span> <span class="p_context"></span>
 #include &lt;linux/linkage.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	.register	%g2,#scratch
 
<span class="p_chunk">@@ -65,6 +66,8 @@</span> <span class="p_context"> ENTRY(__ffs)</span>
 	 add	%o2, %g1, %o0
 ENDPROC(ffs)
 ENDPROC(__ffs)
<span class="p_add">+EXPORT_SYMBOL(__ffs)</span>
<span class="p_add">+EXPORT_SYMBOL(ffs)</span>
 
 	.section	.popc_6insn_patch, &quot;ax&quot;
 	.word		ffs
<span class="p_header">diff --git a/arch/sparc/lib/hweight.S b/arch/sparc/lib/hweight.S</span>
<span class="p_header">index 95414e0..f9985f1 100644</span>
<span class="p_header">--- a/arch/sparc/lib/hweight.S</span>
<span class="p_header">+++ b/arch/sparc/lib/hweight.S</span>
<span class="p_chunk">@@ -1,4 +1,5 @@</span> <span class="p_context"></span>
 #include &lt;linux/linkage.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	.text
 	.align	32
<span class="p_chunk">@@ -7,6 +8,7 @@</span> <span class="p_context"> ENTRY(__arch_hweight8)</span>
 	 nop
 	nop
 ENDPROC(__arch_hweight8)
<span class="p_add">+EXPORT_SYMBOL(__arch_hweight8)</span>
 	.section	.popc_3insn_patch, &quot;ax&quot;
 	.word		__arch_hweight8
 	sllx		%o0, 64-8, %g1
<span class="p_chunk">@@ -19,6 +21,7 @@</span> <span class="p_context"> ENTRY(__arch_hweight16)</span>
 	 nop
 	nop
 ENDPROC(__arch_hweight16)
<span class="p_add">+EXPORT_SYMBOL(__arch_hweight16)</span>
 	.section	.popc_3insn_patch, &quot;ax&quot;
 	.word		__arch_hweight16
 	sllx		%o0, 64-16, %g1
<span class="p_chunk">@@ -31,6 +34,7 @@</span> <span class="p_context"> ENTRY(__arch_hweight32)</span>
 	 nop
 	nop
 ENDPROC(__arch_hweight32)
<span class="p_add">+EXPORT_SYMBOL(__arch_hweight32)</span>
 	.section	.popc_3insn_patch, &quot;ax&quot;
 	.word		__arch_hweight32
 	sllx		%o0, 64-32, %g1
<span class="p_chunk">@@ -43,6 +47,7 @@</span> <span class="p_context"> ENTRY(__arch_hweight64)</span>
 	 nop
 	nop
 ENDPROC(__arch_hweight64)
<span class="p_add">+EXPORT_SYMBOL(__arch_hweight64)</span>
 	.section	.popc_3insn_patch, &quot;ax&quot;
 	.word		__arch_hweight64
 	retl
<span class="p_header">diff --git a/arch/sparc/lib/ipcsum.S b/arch/sparc/lib/ipcsum.S</span>
<span class="p_header">index 4742d59..5d61648 100644</span>
<span class="p_header">--- a/arch/sparc/lib/ipcsum.S</span>
<span class="p_header">+++ b/arch/sparc/lib/ipcsum.S</span>
<span class="p_chunk">@@ -1,4 +1,5 @@</span> <span class="p_context"></span>
 #include &lt;linux/linkage.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	.text
 ENTRY(ip_fast_csum) /* %o0 = iph, %o1 = ihl */
<span class="p_chunk">@@ -31,3 +32,4 @@</span> <span class="p_context"> ENTRY(ip_fast_csum) /* %o0 = iph, %o1 = ihl */</span>
 	retl
 	 and	%o2, %o1, %o0
 ENDPROC(ip_fast_csum)
<span class="p_add">+EXPORT_SYMBOL(ip_fast_csum)</span>
<span class="p_header">diff --git a/arch/sparc/lib/ksyms.c b/arch/sparc/lib/ksyms.c</span>
deleted file mode 100644
<span class="p_header">index 8eb454c..0000000</span>
<span class="p_header">--- a/arch/sparc/lib/ksyms.c</span>
<span class="p_header">+++ /dev/null</span>
<span class="p_chunk">@@ -1,165 +0,0 @@</span> <span class="p_context"></span>
<span class="p_del">-/*</span>
<span class="p_del">- * Export of symbols defined in assembler</span>
<span class="p_del">- */</span>
<span class="p_del">-</span>
<span class="p_del">-/* Tell string.h we don&#39;t want memcpy etc. as cpp defines */</span>
<span class="p_del">-#define EXPORT_SYMTAB_STROPS</span>
<span class="p_del">-</span>
<span class="p_del">-#include &lt;linux/module.h&gt;</span>
<span class="p_del">-#include &lt;linux/string.h&gt;</span>
<span class="p_del">-#include &lt;linux/types.h&gt;</span>
<span class="p_del">-</span>
<span class="p_del">-#include &lt;asm/checksum.h&gt;</span>
<span class="p_del">-#include &lt;asm/uaccess.h&gt;</span>
<span class="p_del">-#include &lt;asm/ftrace.h&gt;</span>
<span class="p_del">-</span>
<span class="p_del">-/* string functions */</span>
<span class="p_del">-EXPORT_SYMBOL(strlen);</span>
<span class="p_del">-EXPORT_SYMBOL(strncmp);</span>
<span class="p_del">-</span>
<span class="p_del">-/* mem* functions */</span>
<span class="p_del">-extern void *__memscan_zero(void *, size_t);</span>
<span class="p_del">-extern void *__memscan_generic(void *, int, size_t);</span>
<span class="p_del">-extern void *__bzero(void *, size_t);</span>
<span class="p_del">-</span>
<span class="p_del">-EXPORT_SYMBOL(memscan);</span>
<span class="p_del">-EXPORT_SYMBOL(__memscan_zero);</span>
<span class="p_del">-EXPORT_SYMBOL(__memscan_generic);</span>
<span class="p_del">-EXPORT_SYMBOL(memcmp);</span>
<span class="p_del">-EXPORT_SYMBOL(memcpy);</span>
<span class="p_del">-EXPORT_SYMBOL(memset);</span>
<span class="p_del">-EXPORT_SYMBOL(memmove);</span>
<span class="p_del">-EXPORT_SYMBOL(__bzero);</span>
<span class="p_del">-</span>
<span class="p_del">-/* Networking helper routines. */</span>
<span class="p_del">-EXPORT_SYMBOL(csum_partial);</span>
<span class="p_del">-</span>
<span class="p_del">-#ifdef CONFIG_MCOUNT</span>
<span class="p_del">-EXPORT_SYMBOL(_mcount);</span>
<span class="p_del">-#endif</span>
<span class="p_del">-</span>
<span class="p_del">-/*</span>
<span class="p_del">- * sparc</span>
<span class="p_del">- */</span>
<span class="p_del">-#ifdef CONFIG_SPARC32</span>
<span class="p_del">-extern int __ashrdi3(int, int);</span>
<span class="p_del">-extern int __ashldi3(int, int);</span>
<span class="p_del">-extern int __lshrdi3(int, int);</span>
<span class="p_del">-extern int __muldi3(int, int);</span>
<span class="p_del">-extern int __divdi3(int, int);</span>
<span class="p_del">-</span>
<span class="p_del">-extern void (*__copy_1page)(void *, const void *);</span>
<span class="p_del">-extern void (*bzero_1page)(void *);</span>
<span class="p_del">-</span>
<span class="p_del">-extern void ___rw_read_enter(void);</span>
<span class="p_del">-extern void ___rw_read_try(void);</span>
<span class="p_del">-extern void ___rw_read_exit(void);</span>
<span class="p_del">-extern void ___rw_write_enter(void);</span>
<span class="p_del">-</span>
<span class="p_del">-/* Networking helper routines. */</span>
<span class="p_del">-EXPORT_SYMBOL(__csum_partial_copy_sparc_generic);</span>
<span class="p_del">-</span>
<span class="p_del">-/* Special internal versions of library functions. */</span>
<span class="p_del">-EXPORT_SYMBOL(__copy_1page);</span>
<span class="p_del">-EXPORT_SYMBOL(__memmove);</span>
<span class="p_del">-EXPORT_SYMBOL(bzero_1page);</span>
<span class="p_del">-</span>
<span class="p_del">-/* Moving data to/from/in userspace. */</span>
<span class="p_del">-EXPORT_SYMBOL(__copy_user);</span>
<span class="p_del">-</span>
<span class="p_del">-/* Used by asm/spinlock.h */</span>
<span class="p_del">-#ifdef CONFIG_SMP</span>
<span class="p_del">-EXPORT_SYMBOL(___rw_read_enter);</span>
<span class="p_del">-EXPORT_SYMBOL(___rw_read_try);</span>
<span class="p_del">-EXPORT_SYMBOL(___rw_read_exit);</span>
<span class="p_del">-EXPORT_SYMBOL(___rw_write_enter);</span>
<span class="p_del">-#endif</span>
<span class="p_del">-</span>
<span class="p_del">-EXPORT_SYMBOL(__ashrdi3);</span>
<span class="p_del">-EXPORT_SYMBOL(__ashldi3);</span>
<span class="p_del">-EXPORT_SYMBOL(__lshrdi3);</span>
<span class="p_del">-EXPORT_SYMBOL(__muldi3);</span>
<span class="p_del">-EXPORT_SYMBOL(__divdi3);</span>
<span class="p_del">-#endif</span>
<span class="p_del">-</span>
<span class="p_del">-/*</span>
<span class="p_del">- * sparc64</span>
<span class="p_del">- */</span>
<span class="p_del">-#ifdef CONFIG_SPARC64</span>
<span class="p_del">-/* Networking helper routines. */</span>
<span class="p_del">-EXPORT_SYMBOL(csum_partial_copy_nocheck);</span>
<span class="p_del">-EXPORT_SYMBOL(__csum_partial_copy_from_user);</span>
<span class="p_del">-EXPORT_SYMBOL(__csum_partial_copy_to_user);</span>
<span class="p_del">-EXPORT_SYMBOL(ip_fast_csum);</span>
<span class="p_del">-</span>
<span class="p_del">-/* Moving data to/from/in userspace. */</span>
<span class="p_del">-EXPORT_SYMBOL(___copy_to_user);</span>
<span class="p_del">-EXPORT_SYMBOL(___copy_from_user);</span>
<span class="p_del">-EXPORT_SYMBOL(___copy_in_user);</span>
<span class="p_del">-EXPORT_SYMBOL(__clear_user);</span>
<span class="p_del">-</span>
<span class="p_del">-/* Atomic counter implementation. */</span>
<span class="p_del">-#define ATOMIC_OP(op)							\</span>
<span class="p_del">-EXPORT_SYMBOL(atomic_##op);						\</span>
<span class="p_del">-EXPORT_SYMBOL(atomic64_##op);</span>
<span class="p_del">-</span>
<span class="p_del">-#define ATOMIC_OP_RETURN(op)						\</span>
<span class="p_del">-EXPORT_SYMBOL(atomic_##op##_return);					\</span>
<span class="p_del">-EXPORT_SYMBOL(atomic64_##op##_return);</span>
<span class="p_del">-</span>
<span class="p_del">-#define ATOMIC_OPS(op) ATOMIC_OP(op) ATOMIC_OP_RETURN(op)</span>
<span class="p_del">-</span>
<span class="p_del">-ATOMIC_OPS(add)</span>
<span class="p_del">-ATOMIC_OPS(sub)</span>
<span class="p_del">-ATOMIC_OP(and)</span>
<span class="p_del">-ATOMIC_OP(or)</span>
<span class="p_del">-ATOMIC_OP(xor)</span>
<span class="p_del">-</span>
<span class="p_del">-#undef ATOMIC_OPS</span>
<span class="p_del">-#undef ATOMIC_OP_RETURN</span>
<span class="p_del">-#undef ATOMIC_OP</span>
<span class="p_del">-</span>
<span class="p_del">-EXPORT_SYMBOL(atomic64_dec_if_positive);</span>
<span class="p_del">-</span>
<span class="p_del">-/* Atomic bit operations. */</span>
<span class="p_del">-EXPORT_SYMBOL(test_and_set_bit);</span>
<span class="p_del">-EXPORT_SYMBOL(test_and_clear_bit);</span>
<span class="p_del">-EXPORT_SYMBOL(test_and_change_bit);</span>
<span class="p_del">-EXPORT_SYMBOL(set_bit);</span>
<span class="p_del">-EXPORT_SYMBOL(clear_bit);</span>
<span class="p_del">-EXPORT_SYMBOL(change_bit);</span>
<span class="p_del">-</span>
<span class="p_del">-/* Special internal versions of library functions. */</span>
<span class="p_del">-EXPORT_SYMBOL(_clear_page);</span>
<span class="p_del">-EXPORT_SYMBOL(clear_user_page);</span>
<span class="p_del">-EXPORT_SYMBOL(copy_user_page);</span>
<span class="p_del">-</span>
<span class="p_del">-/* RAID code needs this */</span>
<span class="p_del">-void VISenter(void);</span>
<span class="p_del">-EXPORT_SYMBOL(VISenter);</span>
<span class="p_del">-</span>
<span class="p_del">-extern void xor_vis_2(unsigned long, unsigned long *, unsigned long *);</span>
<span class="p_del">-extern void xor_vis_3(unsigned long, unsigned long *, unsigned long *,</span>
<span class="p_del">-		unsigned long *);</span>
<span class="p_del">-extern void xor_vis_4(unsigned long, unsigned long *, unsigned long *,</span>
<span class="p_del">-		unsigned long *, unsigned long *);</span>
<span class="p_del">-extern void xor_vis_5(unsigned long, unsigned long *, unsigned long *,</span>
<span class="p_del">-		unsigned long *, unsigned long *, unsigned long *);</span>
<span class="p_del">-EXPORT_SYMBOL(xor_vis_2);</span>
<span class="p_del">-EXPORT_SYMBOL(xor_vis_3);</span>
<span class="p_del">-EXPORT_SYMBOL(xor_vis_4);</span>
<span class="p_del">-EXPORT_SYMBOL(xor_vis_5);</span>
<span class="p_del">-</span>
<span class="p_del">-extern void xor_niagara_2(unsigned long, unsigned long *, unsigned long *);</span>
<span class="p_del">-extern void xor_niagara_3(unsigned long, unsigned long *, unsigned long *,</span>
<span class="p_del">-		unsigned long *);</span>
<span class="p_del">-extern void xor_niagara_4(unsigned long, unsigned long *, unsigned long *,</span>
<span class="p_del">-		unsigned long *, unsigned long *);</span>
<span class="p_del">-extern void xor_niagara_5(unsigned long, unsigned long *, unsigned long *,</span>
<span class="p_del">-		unsigned long *, unsigned long *, unsigned long *);</span>
<span class="p_del">-</span>
<span class="p_del">-EXPORT_SYMBOL(xor_niagara_2);</span>
<span class="p_del">-EXPORT_SYMBOL(xor_niagara_3);</span>
<span class="p_del">-EXPORT_SYMBOL(xor_niagara_4);</span>
<span class="p_del">-EXPORT_SYMBOL(xor_niagara_5);</span>
<span class="p_del">-#endif</span>
<span class="p_header">diff --git a/arch/sparc/lib/locks.S b/arch/sparc/lib/locks.S</span>
<span class="p_header">index 64f53f2..f38c4e5 100644</span>
<span class="p_header">--- a/arch/sparc/lib/locks.S</span>
<span class="p_header">+++ b/arch/sparc/lib/locks.S</span>
<span class="p_chunk">@@ -10,6 +10,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/psr.h&gt;
 #include &lt;asm/smp.h&gt;
 #include &lt;asm/spinlock.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	.text
 	.align	4
<span class="p_chunk">@@ -48,6 +49,7 @@</span> <span class="p_context"> ___rw_write_enter_spin_on_wlock:</span>
 	 ld	[%g1], %g2
 
 	.globl	___rw_read_enter
<span class="p_add">+EXPORT_SYMBOL(___rw_read_enter)</span>
 ___rw_read_enter:
 	orcc	%g2, 0x0, %g0
 	bne,a	___rw_read_enter_spin_on_wlock
<span class="p_chunk">@@ -59,6 +61,7 @@</span> <span class="p_context"> ___rw_read_enter:</span>
 	 mov	%g4, %o7
 
 	.globl	___rw_read_exit
<span class="p_add">+EXPORT_SYMBOL(___rw_read_exit)</span>
 ___rw_read_exit:
 	orcc	%g2, 0x0, %g0
 	bne,a	___rw_read_exit_spin_on_wlock
<span class="p_chunk">@@ -70,6 +73,7 @@</span> <span class="p_context"> ___rw_read_exit:</span>
 	 mov	%g4, %o7
 
 	.globl	___rw_read_try
<span class="p_add">+EXPORT_SYMBOL(___rw_read_try)</span>
 ___rw_read_try:
 	orcc	%g2, 0x0, %g0
 	bne	___rw_read_try_spin_on_wlock
<span class="p_chunk">@@ -81,6 +85,7 @@</span> <span class="p_context"> ___rw_read_try:</span>
 	 mov	%g4, %o7
 
 	.globl	___rw_write_enter
<span class="p_add">+EXPORT_SYMBOL(___rw_write_enter)</span>
 ___rw_write_enter:
 	orcc	%g2, 0x0, %g0
 	bne	___rw_write_enter_spin_on_wlock
<span class="p_header">diff --git a/arch/sparc/lib/lshrdi3.S b/arch/sparc/lib/lshrdi3.S</span>
<span class="p_header">index 60ebc7c..c9b9373 100644</span>
<span class="p_header">--- a/arch/sparc/lib/lshrdi3.S</span>
<span class="p_header">+++ b/arch/sparc/lib/lshrdi3.S</span>
<span class="p_chunk">@@ -1,4 +1,5 @@</span> <span class="p_context"></span>
 #include &lt;linux/linkage.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 ENTRY(__lshrdi3)
 	cmp	%o2, 0
<span class="p_chunk">@@ -25,3 +26,4 @@</span> <span class="p_context"> ENTRY(__lshrdi3)</span>
 	retl 
 	 nop 
 ENDPROC(__lshrdi3)
<span class="p_add">+EXPORT_SYMBOL(__lshrdi3)</span>
<span class="p_header">diff --git a/arch/sparc/lib/mcount.S b/arch/sparc/lib/mcount.S</span>
<span class="p_header">index 0b0ed4d..194f383 100644</span>
<span class="p_header">--- a/arch/sparc/lib/mcount.S</span>
<span class="p_header">+++ b/arch/sparc/lib/mcount.S</span>
<span class="p_chunk">@@ -6,6 +6,7 @@</span> <span class="p_context"></span>
  */
 
 #include &lt;linux/linkage.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 /*
  * This is the main variant and is called by C code.  GCC&#39;s -pg option
<span class="p_chunk">@@ -16,6 +17,7 @@</span> <span class="p_context"></span>
 	.align		32
 	.globl		_mcount
 	.type		_mcount,#function
<span class="p_add">+	EXPORT_SYMBOL(_mcount)</span>
 	.globl		mcount
 	.type		mcount,#function
 _mcount:
<span class="p_header">diff --git a/arch/sparc/lib/memcmp.S b/arch/sparc/lib/memcmp.S</span>
<span class="p_header">index efa106c..cee7f30 100644</span>
<span class="p_header">--- a/arch/sparc/lib/memcmp.S</span>
<span class="p_header">+++ b/arch/sparc/lib/memcmp.S</span>
<span class="p_chunk">@@ -6,6 +6,7 @@</span> <span class="p_context"></span>
 
 #include &lt;linux/linkage.h&gt;
 #include &lt;asm/asm.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	.text
 ENTRY(memcmp)
<span class="p_chunk">@@ -25,3 +26,4 @@</span> <span class="p_context"> ENTRY(memcmp)</span>
 2:	retl
 	 mov	0, %o0
 ENDPROC(memcmp)
<span class="p_add">+EXPORT_SYMBOL(memcmp)</span>
<span class="p_header">diff --git a/arch/sparc/lib/memcpy.S b/arch/sparc/lib/memcpy.S</span>
<span class="p_header">index 4d8c497..1dc8ec5 100644</span>
<span class="p_header">--- a/arch/sparc/lib/memcpy.S</span>
<span class="p_header">+++ b/arch/sparc/lib/memcpy.S</span>
<span class="p_chunk">@@ -7,6 +7,7 @@</span> <span class="p_context"></span>
  * Copyright (C) 1996 Jakub Jelinek (jj@sunsite.mff.cuni.cz)
  */
 
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 #define FUNC(x) 		\
 	.globl	x;		\
 	.type	x,@function;	\
<span class="p_chunk">@@ -143,8 +144,10 @@</span> <span class="p_context"> x:</span>
 #ifdef __KERNEL__
 FUNC(amemmove)
 FUNC(__memmove)
<span class="p_add">+EXPORT_SYMBOL(__memmove)</span>
 #endif
 FUNC(memmove)
<span class="p_add">+EXPORT_SYMBOL(memmove)</span>
 	cmp		%o0, %o1
 	mov		%o0, %g7
 	bleu		9f
<span class="p_chunk">@@ -202,6 +205,7 @@</span> <span class="p_context"> FUNC(memmove)</span>
 	 add		%o0, 2, %o0
 
 FUNC(memcpy)	/* %o0=dst %o1=src %o2=len */
<span class="p_add">+EXPORT_SYMBOL(memcpy)</span>
 
 	sub		%o0, %o1, %o4
 	mov		%o0, %g7
<span class="p_header">diff --git a/arch/sparc/lib/memmove.S b/arch/sparc/lib/memmove.S</span>
<span class="p_header">index 857ad4f..012cdb6 100644</span>
<span class="p_header">--- a/arch/sparc/lib/memmove.S</span>
<span class="p_header">+++ b/arch/sparc/lib/memmove.S</span>
<span class="p_chunk">@@ -5,6 +5,7 @@</span> <span class="p_context"></span>
  */
 
 #include &lt;linux/linkage.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	.text
 ENTRY(memmove) /* o0=dst o1=src o2=len */
<span class="p_chunk">@@ -57,3 +58,4 @@</span> <span class="p_context"> ENTRY(memmove) /* o0=dst o1=src o2=len */</span>
 	 stb		%g7, [%o0 - 0x1]
 	ba,a,pt		%xcc, 99b
 ENDPROC(memmove)
<span class="p_add">+EXPORT_SYMBOL(memmove)</span>
<span class="p_header">diff --git a/arch/sparc/lib/memscan_32.S b/arch/sparc/lib/memscan_32.S</span>
<span class="p_header">index 4ff1657..51ce690 100644</span>
<span class="p_header">--- a/arch/sparc/lib/memscan_32.S</span>
<span class="p_header">+++ b/arch/sparc/lib/memscan_32.S</span>
<span class="p_chunk">@@ -4,6 +4,8 @@</span> <span class="p_context"></span>
  * Copyright (C) 1996 David S. Miller (davem@caip.rutgers.edu)
  */
 
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
<span class="p_add">+</span>
 /* In essence, this is just a fancy strlen. */
 
 #define LO_MAGIC 0x01010101
<span class="p_chunk">@@ -13,6 +15,8 @@</span> <span class="p_context"></span>
 	.align	4
 	.globl	__memscan_zero, __memscan_generic
 	.globl	memscan
<span class="p_add">+EXPORT_SYMBOL(__memscan_zero)</span>
<span class="p_add">+EXPORT_SYMBOL(__memscan_generic)</span>
 __memscan_zero:
 	/* %o0 = addr, %o1 = size */
 	cmp	%o1, 0
<span class="p_header">diff --git a/arch/sparc/lib/memscan_64.S b/arch/sparc/lib/memscan_64.S</span>
<span class="p_header">index 5686dfa..daa96f4 100644</span>
<span class="p_header">--- a/arch/sparc/lib/memscan_64.S</span>
<span class="p_header">+++ b/arch/sparc/lib/memscan_64.S</span>
<span class="p_chunk">@@ -5,6 +5,8 @@</span> <span class="p_context"></span>
  * Copyright (C) 1998 David S. Miller (davem@redhat.com)
  */
 
<span class="p_add">+	#include &lt;asm/export.h&gt;</span>
<span class="p_add">+</span>
 #define HI_MAGIC	0x8080808080808080
 #define LO_MAGIC	0x0101010101010101
 #define ASI_PL		0x88
<span class="p_chunk">@@ -13,6 +15,8 @@</span> <span class="p_context"></span>
 	.align	32
 	.globl		__memscan_zero, __memscan_generic
 	.globl		memscan
<span class="p_add">+	EXPORT_SYMBOL(__memscan_zero)</span>
<span class="p_add">+	EXPORT_SYMBOL(__memscan_generic)</span>
 
 __memscan_zero:
 	/* %o0 = bufp, %o1 = size */
<span class="p_header">diff --git a/arch/sparc/lib/memset.S b/arch/sparc/lib/memset.S</span>
<span class="p_header">index f75e690..bb539b4 100644</span>
<span class="p_header">--- a/arch/sparc/lib/memset.S</span>
<span class="p_header">+++ b/arch/sparc/lib/memset.S</span>
<span class="p_chunk">@@ -9,6 +9,7 @@</span> <span class="p_context"></span>
  */
 
 #include &lt;asm/ptrace.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 /* Work around cpp -rob */
 #define ALLOC #alloc
<span class="p_chunk">@@ -63,6 +64,8 @@</span> <span class="p_context"> __bzero_begin:</span>
 
 	.globl	__bzero
 	.globl	memset
<span class="p_add">+	EXPORT_SYMBOL(__bzero)</span>
<span class="p_add">+	EXPORT_SYMBOL(memset)</span>
 	.globl	__memset_start, __memset_end
 __memset_start:
 memset:
<span class="p_header">diff --git a/arch/sparc/lib/muldi3.S b/arch/sparc/lib/muldi3.S</span>
<span class="p_header">index 9794939..17a0f49 100644</span>
<span class="p_header">--- a/arch/sparc/lib/muldi3.S</span>
<span class="p_header">+++ b/arch/sparc/lib/muldi3.S</span>
<span class="p_chunk">@@ -17,6 +17,7 @@</span> <span class="p_context"> along with GNU CC; see the file COPYING.  If not, write to</span>
 the Free Software Foundation, 59 Temple Place - Suite 330,
 Boston, MA 02111-1307, USA.  */
 
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 	.text
 	.align 4
 	.globl __muldi3
<span class="p_chunk">@@ -74,3 +75,4 @@</span> <span class="p_context"> __muldi3:</span>
 	add  %l2, %l0, %i0
 	ret 
 	restore  %g0, %l3, %o1
<span class="p_add">+EXPORT_SYMBOL(__muldi3)</span>
<span class="p_header">diff --git a/arch/sparc/lib/strlen.S b/arch/sparc/lib/strlen.S</span>
<span class="p_header">index 536f835..ca0e7077e 100644</span>
<span class="p_header">--- a/arch/sparc/lib/strlen.S</span>
<span class="p_header">+++ b/arch/sparc/lib/strlen.S</span>
<span class="p_chunk">@@ -7,6 +7,7 @@</span> <span class="p_context"></span>
 
 #include &lt;linux/linkage.h&gt;
 #include &lt;asm/asm.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 #define LO_MAGIC 0x01010101
 #define HI_MAGIC 0x80808080
<span class="p_chunk">@@ -78,3 +79,4 @@</span> <span class="p_context"> ENTRY(strlen)</span>
 	retl
 	 mov	2, %o0
 ENDPROC(strlen)
<span class="p_add">+EXPORT_SYMBOL(strlen)</span>
<span class="p_header">diff --git a/arch/sparc/lib/strncmp_32.S b/arch/sparc/lib/strncmp_32.S</span>
<span class="p_header">index c0d1b56..e3fe014 100644</span>
<span class="p_header">--- a/arch/sparc/lib/strncmp_32.S</span>
<span class="p_header">+++ b/arch/sparc/lib/strncmp_32.S</span>
<span class="p_chunk">@@ -4,6 +4,7 @@</span> <span class="p_context"></span>
  */
 
 #include &lt;linux/linkage.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	.text
 ENTRY(strncmp)
<span class="p_chunk">@@ -116,3 +117,4 @@</span> <span class="p_context"> ENTRY(strncmp)</span>
 	retl
 	 sub	%o3, %o0, %o0
 ENDPROC(strncmp)
<span class="p_add">+EXPORT_SYMBOL(strncmp)</span>
<span class="p_header">diff --git a/arch/sparc/lib/strncmp_64.S b/arch/sparc/lib/strncmp_64.S</span>
<span class="p_header">index 0656627..efb5f88 100644</span>
<span class="p_header">--- a/arch/sparc/lib/strncmp_64.S</span>
<span class="p_header">+++ b/arch/sparc/lib/strncmp_64.S</span>
<span class="p_chunk">@@ -6,6 +6,7 @@</span> <span class="p_context"></span>
 
 #include &lt;linux/linkage.h&gt;
 #include &lt;asm/asi.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 	.text
 ENTRY(strncmp)
<span class="p_chunk">@@ -28,3 +29,4 @@</span> <span class="p_context"> ENTRY(strncmp)</span>
 	retl
 	 clr	%o0
 ENDPROC(strncmp)
<span class="p_add">+EXPORT_SYMBOL(strncmp)</span>
<span class="p_header">diff --git a/arch/sparc/lib/xor.S b/arch/sparc/lib/xor.S</span>
<span class="p_header">index 2c05641..45a49cb 100644</span>
<span class="p_header">--- a/arch/sparc/lib/xor.S</span>
<span class="p_header">+++ b/arch/sparc/lib/xor.S</span>
<span class="p_chunk">@@ -13,6 +13,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/asi.h&gt;
 #include &lt;asm/dcu.h&gt;
 #include &lt;asm/spitfire.h&gt;
<span class="p_add">+#include &lt;asm/export.h&gt;</span>
 
 /*
  *	Requirements:
<span class="p_chunk">@@ -90,6 +91,7 @@</span> <span class="p_context"> ENTRY(xor_vis_2)</span>
 	retl
 	  wr	%g0, 0, %fprs
 ENDPROC(xor_vis_2)
<span class="p_add">+EXPORT_SYMBOL(xor_vis_2)</span>
 
 ENTRY(xor_vis_3)
 	rd	%fprs, %o5
<span class="p_chunk">@@ -156,6 +158,7 @@</span> <span class="p_context"> ENTRY(xor_vis_3)</span>
 	retl
 	 wr	%g0, 0, %fprs
 ENDPROC(xor_vis_3)
<span class="p_add">+EXPORT_SYMBOL(xor_vis_3)</span>
 
 ENTRY(xor_vis_4)
 	rd	%fprs, %o5
<span class="p_chunk">@@ -241,6 +244,7 @@</span> <span class="p_context"> ENTRY(xor_vis_4)</span>
 	retl
 	 wr	%g0, 0, %fprs
 ENDPROC(xor_vis_4)
<span class="p_add">+EXPORT_SYMBOL(xor_vis_4)</span>
 
 ENTRY(xor_vis_5)
 	save	%sp, -192, %sp
<span class="p_chunk">@@ -347,6 +351,7 @@</span> <span class="p_context"> ENTRY(xor_vis_5)</span>
 	ret
 	 restore
 ENDPROC(xor_vis_5)
<span class="p_add">+EXPORT_SYMBOL(xor_vis_5)</span>
 
 	/* Niagara versions. */
 ENTRY(xor_niagara_2) /* %o0=bytes, %o1=dest, %o2=src */
<span class="p_chunk">@@ -393,6 +398,7 @@</span> <span class="p_context"> ENTRY(xor_niagara_2) /* %o0=bytes, %o1=dest, %o2=src */</span>
 	ret
 	 restore
 ENDPROC(xor_niagara_2)
<span class="p_add">+EXPORT_SYMBOL(xor_niagara_2)</span>
 
 ENTRY(xor_niagara_3) /* %o0=bytes, %o1=dest, %o2=src1, %o3=src2 */
 	save		%sp, -192, %sp
<span class="p_chunk">@@ -454,6 +460,7 @@</span> <span class="p_context"> ENTRY(xor_niagara_3) /* %o0=bytes, %o1=dest, %o2=src1, %o3=src2 */</span>
 	ret
 	 restore
 ENDPROC(xor_niagara_3)
<span class="p_add">+EXPORT_SYMBOL(xor_niagara_3)</span>
 
 ENTRY(xor_niagara_4) /* %o0=bytes, %o1=dest, %o2=src1, %o3=src2, %o4=src3 */
 	save		%sp, -192, %sp
<span class="p_chunk">@@ -536,6 +543,7 @@</span> <span class="p_context"> ENTRY(xor_niagara_4) /* %o0=bytes, %o1=dest, %o2=src1, %o3=src2, %o4=src3 */</span>
 	ret
 	 restore
 ENDPROC(xor_niagara_4)
<span class="p_add">+EXPORT_SYMBOL(xor_niagara_4)</span>
 
 ENTRY(xor_niagara_5) /* %o0=bytes, %o1=dest, %o2=src1, %o3=src2, %o4=src3, %o5=src4 */
 	save		%sp, -192, %sp
<span class="p_chunk">@@ -634,3 +642,4 @@</span> <span class="p_context"> ENTRY(xor_niagara_5) /* %o0=bytes, %o1=dest, %o2=src1, %o3=src2, %o4=src3, %o5=s</span>
 	ret
 	 restore
 ENDPROC(xor_niagara_5)
<span class="p_add">+EXPORT_SYMBOL(xor_niagara_5)</span>

</pre>
</div>




  </div>
  <div id="footer">
   <a href="http://jk.ozlabs.org/projects/patchwork/">patchwork</a>
   patch tracking system
  </div>
 </body>
</html>



