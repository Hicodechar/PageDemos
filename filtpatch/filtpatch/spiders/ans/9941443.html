
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <title>net: bonding: Fix transmit load balancing in balance-alb mode if specified by sysfs - Patchwork</title>
  <link rel="stylesheet" type="text/css" href="/static/css/style.css"/>
  <script type="text/javascript" src="/static/js/common.js"></script>
  <script type="text/javascript" src="/static/js/jquery-1.10.1.min.js"></script>

 </head>
 <body>
  <div id="title">
  <h1 style="float: left;">
     <a
      href="/">Patchwork</a>
    net: bonding: Fix transmit load balancing in balance-alb mode if specified by sysfs</h1>
  <div id="auth">

     <a href="/user/login/">login</a>
     <br/>
     <a href="/register/">register</a>
     <br/>
     <a href="/mail/">mail settings</a>

   </div>
   <div style="clear: both;"></div>
  </div>
  <div id="nav">
   <div id="navleft">
   
    <strong>Project</strong>: LKML
     :
     <a href="/project/LKML/list/"
      >patches</a>
     :
     <a href="/project/LKML/"
      >project info</a>
    
     :
     <a href="/"
     >other projects</a>
     
    
   </div>
   <div id="navright">
    <a href="/help/about/">about</a>
   </div>
   <div style="clear: both"></div>
  </div>

  <div id="content">

<script language="JavaScript" type="text/javascript">
function toggle_headers(link_id, headers_id)
{
    var link = document.getElementById(link_id)
    var headers = document.getElementById(headers_id)

    var hidden = headers.style['display'] == 'none';

    if (hidden) {
        link.innerHTML = 'hide';
        headers.style['display'] = 'block';
    } else {
        link.innerHTML = 'show';
        headers.style['display'] = 'none';
    }

}
</script>

<table class="patchmeta">
 <tr>
  <th>Submitter</th>
  <td><a href="/project/LKML/list/?submitter=143341">Kosuke Tatsukawa</a></td>
 </tr>
 <tr>
  <th>Date</th>
  <td>Sept. 6, 2017, 10:47 p.m.</td>
 </tr>
 <tr>
  <th>Message ID</th>
  <td>&lt;17EC94B0A072C34B8DCF0D30AD16044A02985CB5@BPXM09GP.gisp.nec.co.jp&gt;</td>
 </tr>
 <tr>
  <th>Download</th>
  <td>
   <a href="/patch/9941443/mbox/"
   >mbox</a>
|
   <a href="/patch/9941443/raw/"
   >patch</a>

   </td>
 </tr>
 <tr>
  <th>Permalink</th>
  <td><a href="/patch/9941443/">/patch/9941443/</a>
 </tr>
  <tr>
   <th>State</th>
   <td>New</td>
  </tr>


 <tr>
  <th>Headers</th>
  <td><a id="togglepatchheaders"
   href="javascript:toggle_headers('togglepatchheaders', 'patchheaders')"
   >show</a>
   <div id="patchheaders" class="patchheaders" style="display:none;">
    <pre>Return-Path: &lt;linux-kernel-owner@kernel.org&gt;
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
	[172.30.200.125])
	by pdx-korg-patchwork.web.codeaurora.org (Postfix) with ESMTP id
	E6E1F602CC for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Wed,  6 Sep 2017 22:57:48 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id DAFAD2684F
	for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Wed,  6 Sep 2017 22:57:48 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id CFDBC268AE; Wed,  6 Sep 2017 22:57:48 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-6.9 required=2.0 tests=BAYES_00,RCVD_IN_DNSWL_HI
	autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 9930126861
	for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Wed,  6 Sep 2017 22:57:46 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1754533AbdIFW5j convert rfc822-to-8bit (ORCPT
	&lt;rfc822;patchwork-LKML@patchwork.kernel.org&gt;);
	Wed, 6 Sep 2017 18:57:39 -0400
Received: from tyo161.gate.nec.co.jp ([114.179.232.161]:43309 &quot;EHLO
	tyo161.gate.nec.co.jp&quot; rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1752687AbdIFW52 (ORCPT
	&lt;rfc822;linux-kernel@vger.kernel.org&gt;);
	Wed, 6 Sep 2017 18:57:28 -0400
X-Greylist: delayed 567 seconds by postgrey-1.27 at vger.kernel.org;
	Wed, 06 Sep 2017 18:57:26 EDT
Received: from mailgate02.nec.co.jp ([114.179.233.122])
	by tyo161.gate.nec.co.jp (8.15.1/8.15.1) with ESMTPS id
	v86MmdlE008545
	(version=TLSv1.2 cipher=DHE-RSA-AES256-GCM-SHA384 bits=256 verify=NO);
	Thu, 7 Sep 2017 07:48:39 +0900
Received: from mailsv01.nec.co.jp (mailgate-v.nec.co.jp [10.204.236.94])
	by mailgate02.nec.co.jp (8.15.1/8.15.1) with ESMTP id v86MmdqT032167; 
	Thu, 7 Sep 2017 07:48:39 +0900
Received: from mail02.kamome.nec.co.jp (mail02.kamome.nec.co.jp [10.25.43.5])
	by mailsv01.nec.co.jp (8.15.1/8.15.1) with ESMTP id v86Mlck1020557;
	Thu, 7 Sep 2017 07:48:39 +0900
Received: from bpxc99gp.gisp.nec.co.jp ([10.38.151.135] [10.38.151.135]) by
	mail03.kamome.nec.co.jp with ESMTP id BT-MMP-2885886;
	Thu, 7 Sep 2017 07:48:00 +0900
Received: from BPXM09GP.gisp.nec.co.jp ([10.38.151.201]) by
	BPXC07GP.gisp.nec.co.jp ([10.38.151.135]) with mapi id 14.03.0319.002;
	Thu, 7 Sep 2017 07:47:59 +0900
From: Kosuke Tatsukawa &lt;tatsu@ab.jp.nec.com&gt;
To: Jay Vosburgh &lt;j.vosburgh@gmail.com&gt;,
	Veaceslav Falico &lt;vfalico@gmail.com&gt;,
	Andy Gospodarek &lt;andy@greyhouse.net&gt;
CC: &quot;netdev@vger.kernel.org&quot; &lt;netdev@vger.kernel.org&gt;,
	&quot;linux-kernel@vger.kernel.org&quot; &lt;linux-kernel@vger.kernel.org&gt;,
	Reinis Rozitis &lt;r@roze.lv&gt;
Subject: [PATCH] net: bonding: Fix transmit load balancing in balance-alb
	mode if specified by sysfs
Thread-Topic: [PATCH] net: bonding: Fix transmit load balancing in
	balance-alb mode if specified by sysfs
Thread-Index: AdMnYjAbA4D4jtm8RXC4JQ/cT4z0NA==
Date: Wed, 6 Sep 2017 22:47:59 +0000
Message-ID: &lt;17EC94B0A072C34B8DCF0D30AD16044A02985CB5@BPXM09GP.gisp.nec.co.jp&gt;
Accept-Language: ja-JP, en-US
Content-Language: ja-JP
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [10.34.125.78]
Content-Type: text/plain; charset=&quot;iso-2022-jp&quot;
Content-Transfer-Encoding: 8BIT
MIME-Version: 1.0
X-TM-AS-MML: disable
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: &lt;linux-kernel.vger.kernel.org&gt;
X-Mailing-List: linux-kernel@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP
</pre>
   </div>
  </td>
 </tr>
</table>

<div class="patchforms">





 <div style="clear: both;">
 </div>
</div>



<h2>Comments</h2>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=143341">Kosuke Tatsukawa</a> - Sept. 6, 2017, 10:47 p.m.</div>
<pre class="content">
Commit cbf5ecb30560 (&quot;net: bonding: Fix transmit load balancing in
balance-alb mode&quot;) tried to fix transmit dynamic load balancing in
balance-alb mode, which wasn&#39;t working after commit 8b426dc54cf4
(&quot;bonding: remove hardcoded value&quot;).

It turned out that my previous patch only fixed the case when
balance-alb was specified as bonding module parameter, and not when
balance-alb mode was set using /sys/class/net/*/bonding/mode (the most
common usage).  In the latter case, tlb_dynamic_lb was set up according
to the default mode of the bonding interface, which happens to be
balance-rr.

This additional patch addresses this issue by setting up tlb_dynamic_lb
to 1 if &quot;mode&quot; is set to balance-alb through the sysfs interface.

I didn&#39;t add code to change tlb_balance_lb back to the default value for
other modes, because &quot;mode&quot; is usually set up only once during
initialization, and it&#39;s not worthwhile to change the static variable
bonding_defaults in bond_main.c to a global variable just for this
purpose.

Commit 8b426dc54cf4 also changes the value of tlb_dynamic_lb for
balance-tlb mode if it is set up using the sysfs interface.  I didn&#39;t
change that behavior, because the value of tlb_balance_lb can be changed
using the sysfs interface for balance-tlb, and I didn&#39;t like changing
the default value back and forth for balance-tlb.

As for balance-alb, /sys/class/net/*/bonding/tlb_balance_lb cannot be
written to.  However, I think balance-alb with tlb_dynamic_lb set to 0
is not an intended usage, so there is little use making it writable at
this moment.

Fixes: 8b426dc54cf4 (&quot;bonding: remove hardcoded value&quot;)
Reported-by: Reinis Rozitis &lt;r@roze.lv&gt;
<span class="signed-off-by">Signed-off-by: Kosuke Tatsukawa &lt;tatsu@ab.jp.nec.com&gt;</span>
Cc: stable@vger.kernel.org  # v4.12+
---
 drivers/net/bonding/bond_options.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)
</pre>
</div>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=134191">Nikolay Aleksandrov</a> - Sept. 7, 2017, 11:09 p.m.</div>
<pre class="content">
On  7.09.2017 01:47, Kosuke Tatsukawa wrote:
<span class="quote">&gt; Commit cbf5ecb30560 (&quot;net: bonding: Fix transmit load balancing in</span>
<span class="quote">&gt; balance-alb mode&quot;) tried to fix transmit dynamic load balancing in</span>
<span class="quote">&gt; balance-alb mode, which wasn&#39;t working after commit 8b426dc54cf4</span>
<span class="quote">&gt; (&quot;bonding: remove hardcoded value&quot;).</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; It turned out that my previous patch only fixed the case when</span>
<span class="quote">&gt; balance-alb was specified as bonding module parameter, and not when</span>
<span class="quote">&gt; balance-alb mode was set using /sys/class/net/*/bonding/mode (the most</span>
<span class="quote">&gt; common usage).  In the latter case, tlb_dynamic_lb was set up according</span>
<span class="quote">&gt; to the default mode of the bonding interface, which happens to be</span>
<span class="quote">&gt; balance-rr.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; This additional patch addresses this issue by setting up tlb_dynamic_lb</span>
<span class="quote">&gt; to 1 if &quot;mode&quot; is set to balance-alb through the sysfs interface.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; I didn&#39;t add code to change tlb_balance_lb back to the default value for</span>
<span class="quote">&gt; other modes, because &quot;mode&quot; is usually set up only once during</span>
<span class="quote">&gt; initialization, and it&#39;s not worthwhile to change the static variable</span>
<span class="quote">&gt; bonding_defaults in bond_main.c to a global variable just for this</span>
<span class="quote">&gt; purpose.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; Commit 8b426dc54cf4 also changes the value of tlb_dynamic_lb for</span>
<span class="quote">&gt; balance-tlb mode if it is set up using the sysfs interface.  I didn&#39;t</span>
<span class="quote">&gt; change that behavior, because the value of tlb_balance_lb can be changed</span>
<span class="quote">&gt; using the sysfs interface for balance-tlb, and I didn&#39;t like changing</span>
<span class="quote">&gt; the default value back and forth for balance-tlb.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; As for balance-alb, /sys/class/net/*/bonding/tlb_balance_lb cannot be</span>
<span class="quote">&gt; written to.  However, I think balance-alb with tlb_dynamic_lb set to 0</span>
<span class="quote">&gt; is not an intended usage, so there is little use making it writable at</span>
<span class="quote">&gt; this moment.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; Fixes: 8b426dc54cf4 (&quot;bonding: remove hardcoded value&quot;)</span>
<span class="quote">&gt; Reported-by: Reinis Rozitis &lt;r@roze.lv&gt;</span>
<span class="quote">&gt; Signed-off-by: Kosuke Tatsukawa &lt;tatsu@ab.jp.nec.com&gt;</span>
<span class="quote">&gt; Cc: stable@vger.kernel.org  # v4.12+</span>
<span class="quote">&gt; ---</span>
<span class="quote">&gt;  drivers/net/bonding/bond_options.c |    3 +++</span>
<span class="quote">&gt;  1 files changed, 3 insertions(+), 0 deletions(-)</span>
<span class="quote">&gt; </span>

I don&#39;t believe this to be the right solution, hardcoding it like this
changes user-visible behaviour. The issue is that if someone configured
it to be 0 in tlb mode, suddenly it will become 1 and will silently
override their config if they switch the mode to alb. Also it robs users
from their choice.

If you think this should be settable in ALB mode, then IMO you should
edit tlb_dynamic_lb option&#39;s unsuppmodes and allow it to be set in ALB.
That would also be consistent with how it&#39;s handled in TLB mode.

Going back and looking at your previous fix I&#39;d argue that it is also
wrong, you should&#39;ve removed the mode check altogether to return the
original behaviour where the dynamic_lb is set to 1 (enabled) by
default and then ALB mode would&#39;ve had it, of course that would&#39;ve left
the case of setting it to 0 in TLB mode and switching to ALB, but that
is a different issue.

Cheers,
 Nik
</pre>
</div>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=16971">Mahesh Bandewar</a> - Sept. 8, 2017, 12:39 a.m.</div>
<pre class="content">
On Thu, Sep 7, 2017 at 4:09 PM, Nikolay Aleksandrov
&lt;nikolay@cumulusnetworks.com&gt; wrote:
<span class="quote">&gt; On  7.09.2017 01:47, Kosuke Tatsukawa wrote:</span>
<span class="quote">&gt;&gt; Commit cbf5ecb30560 (&quot;net: bonding: Fix transmit load balancing in</span>
<span class="quote">&gt;&gt; balance-alb mode&quot;) tried to fix transmit dynamic load balancing in</span>
<span class="quote">&gt;&gt; balance-alb mode, which wasn&#39;t working after commit 8b426dc54cf4</span>
<span class="quote">&gt;&gt; (&quot;bonding: remove hardcoded value&quot;).</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; It turned out that my previous patch only fixed the case when</span>
<span class="quote">&gt;&gt; balance-alb was specified as bonding module parameter, and not when</span>
<span class="quote">&gt;&gt; balance-alb mode was set using /sys/class/net/*/bonding/mode (the most</span>
<span class="quote">&gt;&gt; common usage).  In the latter case, tlb_dynamic_lb was set up according</span>
<span class="quote">&gt;&gt; to the default mode of the bonding interface, which happens to be</span>
<span class="quote">&gt;&gt; balance-rr.</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; This additional patch addresses this issue by setting up tlb_dynamic_lb</span>
<span class="quote">&gt;&gt; to 1 if &quot;mode&quot; is set to balance-alb through the sysfs interface.</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; I didn&#39;t add code to change tlb_balance_lb back to the default value for</span>
<span class="quote">&gt;&gt; other modes, because &quot;mode&quot; is usually set up only once during</span>
<span class="quote">&gt;&gt; initialization, and it&#39;s not worthwhile to change the static variable</span>
<span class="quote">&gt;&gt; bonding_defaults in bond_main.c to a global variable just for this</span>
<span class="quote">&gt;&gt; purpose.</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; Commit 8b426dc54cf4 also changes the value of tlb_dynamic_lb for</span>
<span class="quote">&gt;&gt; balance-tlb mode if it is set up using the sysfs interface.  I didn&#39;t</span>
<span class="quote">&gt;&gt; change that behavior, because the value of tlb_balance_lb can be changed</span>
<span class="quote">&gt;&gt; using the sysfs interface for balance-tlb, and I didn&#39;t like changing</span>
<span class="quote">&gt;&gt; the default value back and forth for balance-tlb.</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; As for balance-alb, /sys/class/net/*/bonding/tlb_balance_lb cannot be</span>
<span class="quote">&gt;&gt; written to.  However, I think balance-alb with tlb_dynamic_lb set to 0</span>
<span class="quote">&gt;&gt; is not an intended usage, so there is little use making it writable at</span>
<span class="quote">&gt;&gt; this moment.</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; Fixes: 8b426dc54cf4 (&quot;bonding: remove hardcoded value&quot;)</span>

This is wrong! I think you are confusing various things here. ALB is
different mode from TLB and TLB-dynamic-lb is *only* a special case of
TLB. Your earlier patch is also wrong for the same reasons. However,
since the default value of tlb_dynamic_lb is set to 0  it&#39;s not
causing issues for ALB mode otherwise it would break ALB mode.
tlb_dynamic_lb has absolutely nothing to do with ALB mode. Please
revert the earlier change (cbf5ecb30560).

It&#39;s not clear to me what you saw as broken, so can&#39;t really suggest
what really need to be done.
</pre>
</div>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=16971">Mahesh Bandewar</a> - Sept. 8, 2017, 12:47 a.m.</div>
<pre class="content">
On Thu, Sep 7, 2017 at 5:39 PM, Mahesh Bandewar (महेश बंडेवार)
&lt;maheshb@google.com&gt; wrote:
<span class="quote">&gt; On Thu, Sep 7, 2017 at 4:09 PM, Nikolay Aleksandrov</span>
<span class="quote">&gt; &lt;nikolay@cumulusnetworks.com&gt; wrote:</span>
<span class="quote">&gt;&gt; On  7.09.2017 01:47, Kosuke Tatsukawa wrote:</span>
<span class="quote">&gt;&gt;&gt; Commit cbf5ecb30560 (&quot;net: bonding: Fix transmit load balancing in</span>
<span class="quote">&gt;&gt;&gt; balance-alb mode&quot;) tried to fix transmit dynamic load balancing in</span>
<span class="quote">&gt;&gt;&gt; balance-alb mode, which wasn&#39;t working after commit 8b426dc54cf4</span>
<span class="quote">&gt;&gt;&gt; (&quot;bonding: remove hardcoded value&quot;).</span>
<span class="quote">&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt; It turned out that my previous patch only fixed the case when</span>
<span class="quote">&gt;&gt;&gt; balance-alb was specified as bonding module parameter, and not when</span>
<span class="quote">&gt;&gt;&gt; balance-alb mode was set using /sys/class/net/*/bonding/mode (the most</span>
<span class="quote">&gt;&gt;&gt; common usage).  In the latter case, tlb_dynamic_lb was set up according</span>
<span class="quote">&gt;&gt;&gt; to the default mode of the bonding interface, which happens to be</span>
<span class="quote">&gt;&gt;&gt; balance-rr.</span>
<span class="quote">&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt; This additional patch addresses this issue by setting up tlb_dynamic_lb</span>
<span class="quote">&gt;&gt;&gt; to 1 if &quot;mode&quot; is set to balance-alb through the sysfs interface.</span>
<span class="quote">&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt; I didn&#39;t add code to change tlb_balance_lb back to the default value for</span>
<span class="quote">&gt;&gt;&gt; other modes, because &quot;mode&quot; is usually set up only once during</span>
<span class="quote">&gt;&gt;&gt; initialization, and it&#39;s not worthwhile to change the static variable</span>
<span class="quote">&gt;&gt;&gt; bonding_defaults in bond_main.c to a global variable just for this</span>
<span class="quote">&gt;&gt;&gt; purpose.</span>
<span class="quote">&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt; Commit 8b426dc54cf4 also changes the value of tlb_dynamic_lb for</span>
<span class="quote">&gt;&gt;&gt; balance-tlb mode if it is set up using the sysfs interface.  I didn&#39;t</span>
<span class="quote">&gt;&gt;&gt; change that behavior, because the value of tlb_balance_lb can be changed</span>
<span class="quote">&gt;&gt;&gt; using the sysfs interface for balance-tlb, and I didn&#39;t like changing</span>
<span class="quote">&gt;&gt;&gt; the default value back and forth for balance-tlb.</span>
<span class="quote">&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt; As for balance-alb, /sys/class/net/*/bonding/tlb_balance_lb cannot be</span>
<span class="quote">&gt;&gt;&gt; written to.  However, I think balance-alb with tlb_dynamic_lb set to 0</span>
<span class="quote">&gt;&gt;&gt; is not an intended usage, so there is little use making it writable at</span>
<span class="quote">&gt;&gt;&gt; this moment.</span>
<span class="quote">&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt; Fixes: 8b426dc54cf4 (&quot;bonding: remove hardcoded value&quot;)</span>
<span class="quote">&gt;</span>
<span class="quote">&gt; This is wrong! I think you are confusing various things here. ALB is</span>
<span class="quote">&gt; different mode from TLB and TLB-dynamic-lb is *only* a special case of</span>
<span class="quote">&gt; TLB. Your earlier patch is also wrong for the same reasons. However,</span>
<span class="quote">&gt; since the default value of tlb_dynamic_lb is set to 0  it&#39;s not</span>
<span class="quote">&gt; causing issues for ALB mode otherwise it would break ALB mode.</span>
I take this back. The default value is 1 so ALB is broken because of
the referenced change.
<span class="quote">
&gt; tlb_dynamic_lb has absolutely nothing to do with ALB mode. Please</span>
<span class="quote">&gt; revert the earlier change (cbf5ecb30560).</span>
<span class="quote">&gt;</span>
<span class="quote">&gt; It&#39;s not clear to me what you saw as broken, so can&#39;t really suggest</span>
<span class="quote">&gt; what really need to be done.</span>
</pre>
</div>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=16971">Mahesh Bandewar</a> - Sept. 8, 2017, 1:54 a.m.</div>
<pre class="content">
On Thu, Sep 7, 2017 at 5:47 PM, Mahesh Bandewar (महेश बंडेवार)
&lt;maheshb@google.com&gt; wrote:
<span class="quote">&gt; On Thu, Sep 7, 2017 at 5:39 PM, Mahesh Bandewar (महेश बंडेवार)</span>
<span class="quote">&gt; &lt;maheshb@google.com&gt; wrote:</span>
<span class="quote">&gt;&gt; On Thu, Sep 7, 2017 at 4:09 PM, Nikolay Aleksandrov</span>
<span class="quote">&gt;&gt; &lt;nikolay@cumulusnetworks.com&gt; wrote:</span>
<span class="quote">&gt;&gt;&gt; On  7.09.2017 01:47, Kosuke Tatsukawa wrote:</span>
<span class="quote">&gt;&gt;&gt;&gt; Commit cbf5ecb30560 (&quot;net: bonding: Fix transmit load balancing in</span>
<span class="quote">&gt;&gt;&gt;&gt; balance-alb mode&quot;) tried to fix transmit dynamic load balancing in</span>
<span class="quote">&gt;&gt;&gt;&gt; balance-alb mode, which wasn&#39;t working after commit 8b426dc54cf4</span>
<span class="quote">&gt;&gt;&gt;&gt; (&quot;bonding: remove hardcoded value&quot;).</span>
<span class="quote">&gt;&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt;&gt; It turned out that my previous patch only fixed the case when</span>
<span class="quote">&gt;&gt;&gt;&gt; balance-alb was specified as bonding module parameter, and not when</span>
<span class="quote">&gt;&gt;&gt;&gt; balance-alb mode was set using /sys/class/net/*/bonding/mode (the most</span>
<span class="quote">&gt;&gt;&gt;&gt; common usage).  In the latter case, tlb_dynamic_lb was set up according</span>
<span class="quote">&gt;&gt;&gt;&gt; to the default mode of the bonding interface, which happens to be</span>
<span class="quote">&gt;&gt;&gt;&gt; balance-rr.</span>
<span class="quote">&gt;&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt;&gt; This additional patch addresses this issue by setting up tlb_dynamic_lb</span>
<span class="quote">&gt;&gt;&gt;&gt; to 1 if &quot;mode&quot; is set to balance-alb through the sysfs interface.</span>
<span class="quote">&gt;&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt;&gt; I didn&#39;t add code to change tlb_balance_lb back to the default value for</span>
<span class="quote">&gt;&gt;&gt;&gt; other modes, because &quot;mode&quot; is usually set up only once during</span>
<span class="quote">&gt;&gt;&gt;&gt; initialization, and it&#39;s not worthwhile to change the static variable</span>
<span class="quote">&gt;&gt;&gt;&gt; bonding_defaults in bond_main.c to a global variable just for this</span>
<span class="quote">&gt;&gt;&gt;&gt; purpose.</span>
<span class="quote">&gt;&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt;&gt; Commit 8b426dc54cf4 also changes the value of tlb_dynamic_lb for</span>
<span class="quote">&gt;&gt;&gt;&gt; balance-tlb mode if it is set up using the sysfs interface.  I didn&#39;t</span>
<span class="quote">&gt;&gt;&gt;&gt; change that behavior, because the value of tlb_balance_lb can be changed</span>
<span class="quote">&gt;&gt;&gt;&gt; using the sysfs interface for balance-tlb, and I didn&#39;t like changing</span>
<span class="quote">&gt;&gt;&gt;&gt; the default value back and forth for balance-tlb.</span>
<span class="quote">&gt;&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt;&gt; As for balance-alb, /sys/class/net/*/bonding/tlb_balance_lb cannot be</span>
<span class="quote">&gt;&gt;&gt;&gt; written to.  However, I think balance-alb with tlb_dynamic_lb set to 0</span>
<span class="quote">&gt;&gt;&gt;&gt; is not an intended usage, so there is little use making it writable at</span>
<span class="quote">&gt;&gt;&gt;&gt; this moment.</span>
<span class="quote">&gt;&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt;&gt; Fixes: 8b426dc54cf4 (&quot;bonding: remove hardcoded value&quot;)</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; This is wrong! I think you are confusing various things here. ALB is</span>
<span class="quote">&gt;&gt; different mode from TLB and TLB-dynamic-lb is *only* a special case of</span>
<span class="quote">&gt;&gt; TLB. Your earlier patch is also wrong for the same reasons. However,</span>
<span class="quote">&gt;&gt; since the default value of tlb_dynamic_lb is set to 0  it&#39;s not</span>
<span class="quote">&gt;&gt; causing issues for ALB mode otherwise it would break ALB mode.</span>
<span class="quote">&gt; I take this back. The default value is 1 so ALB is broken because of</span>
<span class="quote">&gt; the referenced change.</span>
<span class="quote">&gt;</span>
<span class="quote">&gt;&gt; tlb_dynamic_lb has absolutely nothing to do with ALB mode. Please</span>
<span class="quote">&gt;&gt; revert the earlier change (cbf5ecb30560).</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; It&#39;s not clear to me what you saw as broken, so can&#39;t really suggest</span>
<span class="quote">&gt;&gt; what really need to be done.</span>
Please scratch all I said.
</pre>
</div>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=134191">Nikolay Aleksandrov</a> - Sept. 9, 2017, 11:28 a.m.</div>
<pre class="content">
On 07/09/17 01:47, Kosuke Tatsukawa wrote:
<span class="quote">&gt; Commit cbf5ecb30560 (&quot;net: bonding: Fix transmit load balancing in</span>
<span class="quote">&gt; balance-alb mode&quot;) tried to fix transmit dynamic load balancing in</span>
<span class="quote">&gt; balance-alb mode, which wasn&#39;t working after commit 8b426dc54cf4</span>
<span class="quote">&gt; (&quot;bonding: remove hardcoded value&quot;).</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; It turned out that my previous patch only fixed the case when</span>
<span class="quote">&gt; balance-alb was specified as bonding module parameter, and not when</span>
<span class="quote">&gt; balance-alb mode was set using /sys/class/net/*/bonding/mode (the most</span>
<span class="quote">&gt; common usage).  In the latter case, tlb_dynamic_lb was set up according</span>
<span class="quote">&gt; to the default mode of the bonding interface, which happens to be</span>
<span class="quote">&gt; balance-rr.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; This additional patch addresses this issue by setting up tlb_dynamic_lb</span>
<span class="quote">&gt; to 1 if &quot;mode&quot; is set to balance-alb through the sysfs interface.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; I didn&#39;t add code to change tlb_balance_lb back to the default value for</span>
<span class="quote">&gt; other modes, because &quot;mode&quot; is usually set up only once during</span>
<span class="quote">&gt; initialization, and it&#39;s not worthwhile to change the static variable</span>
<span class="quote">&gt; bonding_defaults in bond_main.c to a global variable just for this</span>
<span class="quote">&gt; purpose.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; Commit 8b426dc54cf4 also changes the value of tlb_dynamic_lb for</span>
<span class="quote">&gt; balance-tlb mode if it is set up using the sysfs interface.  I didn&#39;t</span>
<span class="quote">&gt; change that behavior, because the value of tlb_balance_lb can be changed</span>
<span class="quote">&gt; using the sysfs interface for balance-tlb, and I didn&#39;t like changing</span>
<span class="quote">&gt; the default value back and forth for balance-tlb.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; As for balance-alb, /sys/class/net/*/bonding/tlb_balance_lb cannot be</span>
<span class="quote">&gt; written to.  However, I think balance-alb with tlb_dynamic_lb set to 0</span>
<span class="quote">&gt; is not an intended usage, so there is little use making it writable at</span>
<span class="quote">&gt; this moment.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; Fixes: 8b426dc54cf4 (&quot;bonding: remove hardcoded value&quot;)</span>
<span class="quote">&gt; Reported-by: Reinis Rozitis &lt;r@roze.lv&gt;</span>
<span class="quote">&gt; Signed-off-by: Kosuke Tatsukawa &lt;tatsu@ab.jp.nec.com&gt;</span>
<span class="quote">&gt; Cc: stable@vger.kernel.org  # v4.12+</span>
<span class="quote">&gt; ---</span>
<span class="quote">&gt;  drivers/net/bonding/bond_options.c |    3 +++</span>
<span class="quote">&gt;  1 files changed, 3 insertions(+), 0 deletions(-)</span>
<span class="quote">&gt; </span>

This fix is simpler and more suitable for -net, it fixes the case where
we switch to ALB mode with tlb_dynamic_lb = 0. After it is in I&#39;ll fix the
default tlb_dynamic_lb issue and restore the original behaviour.
<span class="acked-by">
Acked-by: Nikolay Aleksandrov &lt;nikolay@cumulusnetworks.com&gt;</span>
</pre>
</div>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=16971">Mahesh Bandewar</a> - Sept. 11, 2017, 4:07 p.m.</div>
<pre class="content">
On Sat, Sep 9, 2017 at 4:28 AM, Nikolay Aleksandrov
&lt;nikolay@cumulusnetworks.com&gt; wrote:
<span class="quote">&gt; On 07/09/17 01:47, Kosuke Tatsukawa wrote:</span>
<span class="quote">&gt;&gt; Commit cbf5ecb30560 (&quot;net: bonding: Fix transmit load balancing in</span>
<span class="quote">&gt;&gt; balance-alb mode&quot;) tried to fix transmit dynamic load balancing in</span>
<span class="quote">&gt;&gt; balance-alb mode, which wasn&#39;t working after commit 8b426dc54cf4</span>
<span class="quote">&gt;&gt; (&quot;bonding: remove hardcoded value&quot;).</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; It turned out that my previous patch only fixed the case when</span>
<span class="quote">&gt;&gt; balance-alb was specified as bonding module parameter, and not when</span>
<span class="quote">&gt;&gt; balance-alb mode was set using /sys/class/net/*/bonding/mode (the most</span>
<span class="quote">&gt;&gt; common usage).  In the latter case, tlb_dynamic_lb was set up according</span>
<span class="quote">&gt;&gt; to the default mode of the bonding interface, which happens to be</span>
<span class="quote">&gt;&gt; balance-rr.</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; This additional patch addresses this issue by setting up tlb_dynamic_lb</span>
<span class="quote">&gt;&gt; to 1 if &quot;mode&quot; is set to balance-alb through the sysfs interface.</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; I didn&#39;t add code to change tlb_balance_lb back to the default value for</span>
<span class="quote">&gt;&gt; other modes, because &quot;mode&quot; is usually set up only once during</span>
<span class="quote">&gt;&gt; initialization, and it&#39;s not worthwhile to change the static variable</span>
<span class="quote">&gt;&gt; bonding_defaults in bond_main.c to a global variable just for this</span>
<span class="quote">&gt;&gt; purpose.</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; Commit 8b426dc54cf4 also changes the value of tlb_dynamic_lb for</span>
<span class="quote">&gt;&gt; balance-tlb mode if it is set up using the sysfs interface.  I didn&#39;t</span>
<span class="quote">&gt;&gt; change that behavior, because the value of tlb_balance_lb can be changed</span>
<span class="quote">&gt;&gt; using the sysfs interface for balance-tlb, and I didn&#39;t like changing</span>
<span class="quote">&gt;&gt; the default value back and forth for balance-tlb.</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; As for balance-alb, /sys/class/net/*/bonding/tlb_balance_lb cannot be</span>
<span class="quote">&gt;&gt; written to.  However, I think balance-alb with tlb_dynamic_lb set to 0</span>
<span class="quote">&gt;&gt; is not an intended usage, so there is little use making it writable at</span>
<span class="quote">&gt;&gt; this moment.</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; Fixes: 8b426dc54cf4 (&quot;bonding: remove hardcoded value&quot;)</span>
<span class="quote">&gt;&gt; Reported-by: Reinis Rozitis &lt;r@roze.lv&gt;</span>
<span class="quote">&gt;&gt; Signed-off-by: Kosuke Tatsukawa &lt;tatsu@ab.jp.nec.com&gt;</span>
<span class="quote">&gt;&gt; Cc: stable@vger.kernel.org  # v4.12+</span>
<span class="quote">&gt;&gt; ---</span>
<span class="quote">&gt;&gt;  drivers/net/bonding/bond_options.c |    3 +++</span>
<span class="quote">&gt;&gt;  1 files changed, 3 insertions(+), 0 deletions(-)</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;</span>
<span class="quote">&gt; This fix is simpler and more suitable for -net, it fixes the case where</span>
<span class="quote">&gt; we switch to ALB mode with tlb_dynamic_lb = 0. After it is in I&#39;ll fix the</span>
<span class="quote">&gt; default tlb_dynamic_lb issue and restore the original behaviour.</span>
<span class="quote">&gt;</span>
Changing tlb_dyanamic_lb to initialize always is also safe for -net
and can go in before or after this change (no dependency on this
change as such)
<span class="quote">
&gt; Acked-by: Nikolay Aleksandrov &lt;nikolay@cumulusnetworks.com&gt;</span>
<span class="acked-by">Acked-by: Mahesh Bandewar &lt;maheshb@google.com&gt;</span>
<span class="quote">&gt;</span>
<span class="quote">&gt;</span>
</pre>
</div>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=134191">Nikolay Aleksandrov</a> - Sept. 11, 2017, 4:30 p.m.</div>
<pre class="content">
On 11 September 2017 19:07:33 EEST, &quot;Mahesh Bandewar (महेश बंडेवार)&quot; &lt;maheshb@google.com&gt; wrote:
<span class="quote">&gt;On Sat, Sep 9, 2017 at 4:28 AM, Nikolay Aleksandrov</span>
<span class="quote">&gt;&lt;nikolay@cumulusnetworks.com&gt; wrote:</span>
<span class="quote">&gt;&gt; On 07/09/17 01:47, Kosuke Tatsukawa wrote:</span>
<span class="quote">&gt;&gt;&gt; Commit cbf5ecb30560 (&quot;net: bonding: Fix transmit load balancing in</span>
<span class="quote">&gt;&gt;&gt; balance-alb mode&quot;) tried to fix transmit dynamic load balancing in</span>
<span class="quote">&gt;&gt;&gt; balance-alb mode, which wasn&#39;t working after commit 8b426dc54cf4</span>
<span class="quote">&gt;&gt;&gt; (&quot;bonding: remove hardcoded value&quot;).</span>
<span class="quote">&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt; It turned out that my previous patch only fixed the case when</span>
<span class="quote">&gt;&gt;&gt; balance-alb was specified as bonding module parameter, and not when</span>
<span class="quote">&gt;&gt;&gt; balance-alb mode was set using /sys/class/net/*/bonding/mode (the</span>
<span class="quote">&gt;most</span>
<span class="quote">&gt;&gt;&gt; common usage).  In the latter case, tlb_dynamic_lb was set up</span>
<span class="quote">&gt;according</span>
<span class="quote">&gt;&gt;&gt; to the default mode of the bonding interface, which happens to be</span>
<span class="quote">&gt;&gt;&gt; balance-rr.</span>
<span class="quote">&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt; This additional patch addresses this issue by setting up</span>
<span class="quote">&gt;tlb_dynamic_lb</span>
<span class="quote">&gt;&gt;&gt; to 1 if &quot;mode&quot; is set to balance-alb through the sysfs interface.</span>
<span class="quote">&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt; I didn&#39;t add code to change tlb_balance_lb back to the default value</span>
<span class="quote">&gt;for</span>
<span class="quote">&gt;&gt;&gt; other modes, because &quot;mode&quot; is usually set up only once during</span>
<span class="quote">&gt;&gt;&gt; initialization, and it&#39;s not worthwhile to change the static</span>
<span class="quote">&gt;variable</span>
<span class="quote">&gt;&gt;&gt; bonding_defaults in bond_main.c to a global variable just for this</span>
<span class="quote">&gt;&gt;&gt; purpose.</span>
<span class="quote">&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt; Commit 8b426dc54cf4 also changes the value of tlb_dynamic_lb for</span>
<span class="quote">&gt;&gt;&gt; balance-tlb mode if it is set up using the sysfs interface.  I</span>
<span class="quote">&gt;didn&#39;t</span>
<span class="quote">&gt;&gt;&gt; change that behavior, because the value of tlb_balance_lb can be</span>
<span class="quote">&gt;changed</span>
<span class="quote">&gt;&gt;&gt; using the sysfs interface for balance-tlb, and I didn&#39;t like</span>
<span class="quote">&gt;changing</span>
<span class="quote">&gt;&gt;&gt; the default value back and forth for balance-tlb.</span>
<span class="quote">&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt; As for balance-alb, /sys/class/net/*/bonding/tlb_balance_lb cannot</span>
<span class="quote">&gt;be</span>
<span class="quote">&gt;&gt;&gt; written to.  However, I think balance-alb with tlb_dynamic_lb set to</span>
<span class="quote">&gt;0</span>
<span class="quote">&gt;&gt;&gt; is not an intended usage, so there is little use making it writable</span>
<span class="quote">&gt;at</span>
<span class="quote">&gt;&gt;&gt; this moment.</span>
<span class="quote">&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;&gt; Fixes: 8b426dc54cf4 (&quot;bonding: remove hardcoded value&quot;)</span>
<span class="quote">&gt;&gt;&gt; Reported-by: Reinis Rozitis &lt;r@roze.lv&gt;</span>
<span class="quote">&gt;&gt;&gt; Signed-off-by: Kosuke Tatsukawa &lt;tatsu@ab.jp.nec.com&gt;</span>
<span class="quote">&gt;&gt;&gt; Cc: stable@vger.kernel.org  # v4.12+</span>
<span class="quote">&gt;&gt;&gt; ---</span>
<span class="quote">&gt;&gt;&gt;  drivers/net/bonding/bond_options.c |    3 +++</span>
<span class="quote">&gt;&gt;&gt;  1 files changed, 3 insertions(+), 0 deletions(-)</span>
<span class="quote">&gt;&gt;&gt;</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt; This fix is simpler and more suitable for -net, it fixes the case</span>
<span class="quote">&gt;where</span>
<span class="quote">&gt;&gt; we switch to ALB mode with tlb_dynamic_lb = 0. After it is in I&#39;ll</span>
<span class="quote">&gt;fix the</span>
<span class="quote">&gt;&gt; default tlb_dynamic_lb issue and restore the original behaviour.</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;Changing tlb_dyanamic_lb to initialize always is also safe for -net</span>
<span class="quote">&gt;and can go in before or after this change (no dependency on this</span>
<span class="quote">&gt;change as such)</span>

I never said it was unsafe or dependent, it is simply my preference to wait. :-)
If you need it sooner feel free to post it.
<span class="quote">
&gt;</span>
<span class="quote">&gt;&gt; Acked-by: Nikolay Aleksandrov &lt;nikolay@cumulusnetworks.com&gt;</span>
<span class="quote">&gt;Acked-by: Mahesh Bandewar &lt;maheshb@google.com&gt;</span>
<span class="quote">&gt;&gt;</span>
<span class="quote">&gt;&gt;</span>
</pre>
</div>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=129">David Miller</a> - Sept. 11, 2017, 9:26 p.m.</div>
<pre class="content">
<span class="from">From: Kosuke Tatsukawa &lt;tatsu@ab.jp.nec.com&gt;</span>
Date: Wed, 6 Sep 2017 22:47:59 +0000
<span class="quote">
&gt; Commit cbf5ecb30560 (&quot;net: bonding: Fix transmit load balancing in</span>
<span class="quote">&gt; balance-alb mode&quot;) tried to fix transmit dynamic load balancing in</span>
<span class="quote">&gt; balance-alb mode, which wasn&#39;t working after commit 8b426dc54cf4</span>
<span class="quote">&gt; (&quot;bonding: remove hardcoded value&quot;).</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; It turned out that my previous patch only fixed the case when</span>
<span class="quote">&gt; balance-alb was specified as bonding module parameter, and not when</span>
<span class="quote">&gt; balance-alb mode was set using /sys/class/net/*/bonding/mode (the most</span>
<span class="quote">&gt; common usage).  In the latter case, tlb_dynamic_lb was set up according</span>
<span class="quote">&gt; to the default mode of the bonding interface, which happens to be</span>
<span class="quote">&gt; balance-rr.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; This additional patch addresses this issue by setting up tlb_dynamic_lb</span>
<span class="quote">&gt; to 1 if &quot;mode&quot; is set to balance-alb through the sysfs interface.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; I didn&#39;t add code to change tlb_balance_lb back to the default value for</span>
<span class="quote">&gt; other modes, because &quot;mode&quot; is usually set up only once during</span>
<span class="quote">&gt; initialization, and it&#39;s not worthwhile to change the static variable</span>
<span class="quote">&gt; bonding_defaults in bond_main.c to a global variable just for this</span>
<span class="quote">&gt; purpose.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; Commit 8b426dc54cf4 also changes the value of tlb_dynamic_lb for</span>
<span class="quote">&gt; balance-tlb mode if it is set up using the sysfs interface.  I didn&#39;t</span>
<span class="quote">&gt; change that behavior, because the value of tlb_balance_lb can be changed</span>
<span class="quote">&gt; using the sysfs interface for balance-tlb, and I didn&#39;t like changing</span>
<span class="quote">&gt; the default value back and forth for balance-tlb.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; As for balance-alb, /sys/class/net/*/bonding/tlb_balance_lb cannot be</span>
<span class="quote">&gt; written to.  However, I think balance-alb with tlb_dynamic_lb set to 0</span>
<span class="quote">&gt; is not an intended usage, so there is little use making it writable at</span>
<span class="quote">&gt; this moment.</span>
<span class="quote">&gt; </span>
<span class="quote">&gt; Fixes: 8b426dc54cf4 (&quot;bonding: remove hardcoded value&quot;)</span>
<span class="quote">&gt; Reported-by: Reinis Rozitis &lt;r@roze.lv&gt;</span>
<span class="quote">&gt; Signed-off-by: Kosuke Tatsukawa &lt;tatsu@ab.jp.nec.com&gt;</span>
<span class="quote">&gt; Cc: stable@vger.kernel.org  # v4.12+</span>

Applied and queued up for -stable, thanks.
</pre>
</div>



<h2>Patch</h2>
<div class="patch">
<pre class="content">
<span class="p_header">diff --git a/drivers/net/bonding/bond_options.c b/drivers/net/bonding/bond_options.c</span>
<span class="p_header">index a12d603..5931aa2 100644</span>
<span class="p_header">--- a/drivers/net/bonding/bond_options.c</span>
<span class="p_header">+++ b/drivers/net/bonding/bond_options.c</span>
<span class="p_chunk">@@ -754,6 +754,9 @@</span> <span class="p_context"> static int bond_option_mode_set(struct bonding *bond,</span>
 			   bond-&gt;params.miimon);
 	}
 
<span class="p_add">+	if (newval-&gt;value == BOND_MODE_ALB)</span>
<span class="p_add">+		bond-&gt;params.tlb_dynamic_lb = 1;</span>
<span class="p_add">+</span>
 	/* don&#39;t cache arp_validate between modes */
 	bond-&gt;params.arp_validate = BOND_ARP_VALIDATE_NONE;
 	bond-&gt;params.mode = newval-&gt;value;

</pre>
</div>




  </div>
  <div id="footer">
   <a href="http://jk.ozlabs.org/projects/patchwork/">patchwork</a>
   patch tracking system
  </div>
 </body>
</html>



