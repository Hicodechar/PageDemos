
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <title>[tip:x86/asm] x86/cpufeature: Carve out X86_FEATURE_* - Patchwork</title>
  <link rel="stylesheet" type="text/css" href="/static/css/style.css"/>
  <script type="text/javascript" src="/static/js/common.js"></script>
  <script type="text/javascript" src="/static/js/jquery-1.10.1.min.js"></script>

 </head>
 <body>
  <div id="title">
  <h1 style="float: left;">
     <a
      href="/">Patchwork</a>
    [tip:x86/asm] x86/cpufeature: Carve out X86_FEATURE_*</h1>
  <div id="auth">

     <a href="/user/login/">login</a>
     <br/>
     <a href="/register/">register</a>
     <br/>
     <a href="/mail/">mail settings</a>

   </div>
   <div style="clear: both;"></div>
  </div>
  <div id="nav">
   <div id="navleft">
   
    <strong>Project</strong>: LKML
     :
     <a href="/project/LKML/list/"
      >patches</a>
     :
     <a href="/project/LKML/"
      >project info</a>
    
     :
     <a href="/"
     >other projects</a>
     
    
   </div>
   <div id="navright">
    <a href="/help/about/">about</a>
   </div>
   <div style="clear: both"></div>
  </div>

  <div id="content">

<script language="JavaScript" type="text/javascript">
function toggle_headers(link_id, headers_id)
{
    var link = document.getElementById(link_id)
    var headers = document.getElementById(headers_id)

    var hidden = headers.style['display'] == 'none';

    if (hidden) {
        link.innerHTML = 'hide';
        headers.style['display'] = 'block';
    } else {
        link.innerHTML = 'show';
        headers.style['display'] = 'none';
    }

}
</script>

<table class="patchmeta">
 <tr>
  <th>Submitter</th>
  <td><a href="/project/LKML/list/?submitter=60001">tip-bot for Jacob Shin</a></td>
 </tr>
 <tr>
  <th>Date</th>
  <td>Jan. 30, 2016, 1:18 p.m.</td>
 </tr>
 <tr>
  <th>Message ID</th>
  <td>&lt;tip-cd4d09ec6f6c12a2cc3db5b7d8876a325a53545b@git.kernel.org&gt;</td>
 </tr>
 <tr>
  <th>Download</th>
  <td>
   <a href="/patch/8171001/mbox/"
   >mbox</a>
|
   <a href="/patch/8171001/raw/"
   >patch</a>

   </td>
 </tr>
 <tr>
  <th>Permalink</th>
  <td><a href="/patch/8171001/">/patch/8171001/</a>
 </tr>
  <tr>
   <th>State</th>
   <td>New</td>
  </tr>


 <tr>
  <th>Headers</th>
  <td><a id="togglepatchheaders"
   href="javascript:toggle_headers('togglepatchheaders', 'patchheaders')"
   >show</a>
   <div id="patchheaders" class="patchheaders" style="display:none;">
    <pre>Return-Path: &lt;linux-kernel-owner@kernel.org&gt;
X-Original-To: patchwork-LKML@patchwork.kernel.org
Delivered-To: patchwork-parsemail@patchwork2.web.kernel.org
Received: from mail.kernel.org (mail.kernel.org [198.145.29.136])
	by patchwork2.web.kernel.org (Postfix) with ESMTP id B1FD9BEEE5
	for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Sat, 30 Jan 2016 13:20:38 +0000 (UTC)
Received: from mail.kernel.org (localhost [127.0.0.1])
	by mail.kernel.org (Postfix) with ESMTP id 6D27B20396
	for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Sat, 30 Jan 2016 13:20:35 +0000 (UTC)
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.kernel.org (Postfix) with ESMTP id C05C2202EC
	for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Sat, 30 Jan 2016 13:20:31 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S932699AbcA3NUZ (ORCPT
	&lt;rfc822;patchwork-LKML@patchwork.kernel.org&gt;);
	Sat, 30 Jan 2016 08:20:25 -0500
Received: from terminus.zytor.com ([198.137.202.10]:38936 &quot;EHLO
	terminus.zytor.com&quot; rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1756545AbcA3NUP (ORCPT
	&lt;rfc822;linux-kernel@vger.kernel.org&gt;);
	Sat, 30 Jan 2016 08:20:15 -0500
Received: from terminus.zytor.com (localhost [127.0.0.1])
	by terminus.zytor.com (8.14.8/8.14.7) with ESMTP id u0UDIgtN025061;
	Sat, 30 Jan 2016 05:18:47 -0800
Received: (from tipbot@localhost)
	by terminus.zytor.com (8.14.8/8.14.7/Submit) id u0UDIgo6025056;
	Sat, 30 Jan 2016 05:18:42 -0800
Date: Sat, 30 Jan 2016 05:18:42 -0800
X-Authentication-Warning: terminus.zytor.com: tipbot set sender to
	tipbot@zytor.com using -f
From: tip-bot for Borislav Petkov &lt;tipbot@zytor.com&gt;
Message-ID: &lt;tip-cd4d09ec6f6c12a2cc3db5b7d8876a325a53545b@git.kernel.org&gt;
Cc: dvlasenk@redhat.com, brgerst@gmail.com, bp@alien8.de,
	linux-kernel@vger.kernel.org, tglx@linutronix.de,
	peterz@infradead.org, bp@suse.de, luto@amacapital.net,
	hpa@zytor.com, torvalds@linux-foundation.org, mingo@kernel.org
Reply-To: peterz@infradead.org, linux-kernel@vger.kernel.org,
	tglx@linutronix.de, hpa@zytor.com, mingo@kernel.org,
	torvalds@linux-foundation.org, bp@suse.de, luto@amacapital.net,
	bp@alien8.de, brgerst@gmail.com, dvlasenk@redhat.com
In-Reply-To: &lt;1453842730-28463-5-git-send-email-bp@alien8.de&gt;
References: &lt;1453842730-28463-5-git-send-email-bp@alien8.de&gt;
To: linux-tip-commits@vger.kernel.org
Subject: [tip:x86/asm] x86/cpufeature: Carve out X86_FEATURE_*
Git-Commit-ID: cd4d09ec6f6c12a2cc3db5b7d8876a325a53545b
X-Mailer: tip-git-log-daemon
Robot-ID: &lt;tip-bot.git.kernel.org&gt;
Robot-Unsubscribe: Contact &lt;mailto:hpa@kernel.org&gt;
	to get blacklisted from these emails
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
Content-Type: text/plain; charset=UTF-8
Content-Disposition: inline
X-Spam-Status: No, score=-6.9 required=5.0 tests=BAYES_00, RCVD_IN_DNSWL_HI, 
	RP_MATCHES_RCVD,
	UNPARSEABLE_RELAY autolearn=unavailable version=3.3.1
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on mail.kernel.org
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: &lt;linux-kernel.vger.kernel.org&gt;
X-Mailing-List: linux-kernel@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP
</pre>
   </div>
  </td>
 </tr>
</table>

<div class="patchforms">





 <div style="clear: both;">
 </div>
</div>



<h2>Comments</h2>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=60001">tip-bot for Jacob Shin</a> - Jan. 30, 2016, 1:18 p.m.</div>
<pre class="content">
Commit-ID:  cd4d09ec6f6c12a2cc3db5b7d8876a325a53545b
Gitweb:     http://git.kernel.org/tip/cd4d09ec6f6c12a2cc3db5b7d8876a325a53545b
Author:     Borislav Petkov &lt;bp@suse.de&gt;
AuthorDate: Tue, 26 Jan 2016 22:12:04 +0100
Committer:  Ingo Molnar &lt;mingo@kernel.org&gt;
CommitDate: Sat, 30 Jan 2016 11:22:17 +0100

x86/cpufeature: Carve out X86_FEATURE_*

Move them to a separate header and have the following
dependency:

  x86/cpufeatures.h &lt;- x86/processor.h &lt;- x86/cpufeature.h

This makes it easier to use the header in asm code and not
include the whole cpufeature.h and add guards for asm.

Suggested-by: H. Peter Anvin &lt;hpa@zytor.com&gt;
<span class="signed-off-by">Signed-off-by: Borislav Petkov &lt;bp@suse.de&gt;</span>
Cc: Andy Lutomirski &lt;luto@amacapital.net&gt;
Cc: Borislav Petkov &lt;bp@alien8.de&gt;
Cc: Brian Gerst &lt;brgerst@gmail.com&gt;
Cc: Denys Vlasenko &lt;dvlasenk@redhat.com&gt;
Cc: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Cc: Peter Zijlstra &lt;peterz@infradead.org&gt;
Cc: Thomas Gleixner &lt;tglx@linutronix.de&gt;
Link: http://lkml.kernel.org/r/1453842730-28463-5-git-send-email-bp@alien8.de
<span class="signed-off-by">Signed-off-by: Ingo Molnar &lt;mingo@kernel.org&gt;</span>
---
 Documentation/kernel-parameters.txt                |   2 +-
 arch/x86/boot/cpuflags.h                           |   2 +-
 arch/x86/boot/mkcpustr.c                           |   2 +-
 arch/x86/crypto/crc32-pclmul_glue.c                |   2 +-
 arch/x86/crypto/crc32c-intel_glue.c                |   2 +-
 arch/x86/crypto/crct10dif-pclmul_glue.c            |   2 +-
 arch/x86/entry/common.c                            |   1 +
 arch/x86/entry/entry_32.S                          |   2 +-
 arch/x86/entry/vdso/vdso32-setup.c                 |   1 -
 arch/x86/entry/vdso/vdso32/system_call.S           |   2 +-
 arch/x86/entry/vdso/vma.c                          |   1 +
 arch/x86/include/asm/alternative.h                 |   6 -
 arch/x86/include/asm/apic.h                        |   1 -
 arch/x86/include/asm/arch_hweight.h                |   2 +
 arch/x86/include/asm/cmpxchg.h                     |   1 +
 arch/x86/include/asm/cpufeature.h                  | 284 +----------------
 .../include/asm/{cpufeature.h =&gt; cpufeatures.h}    | 336 +--------------------
 arch/x86/include/asm/fpu/internal.h                |   1 +
 arch/x86/include/asm/irq_work.h                    |   2 +-
 arch/x86/include/asm/mwait.h                       |   2 +
 arch/x86/include/asm/processor.h                   |   3 +-
 arch/x86/include/asm/smap.h                        |   2 +-
 arch/x86/include/asm/smp.h                         |   1 -
 arch/x86/include/asm/thread_info.h                 |   2 +-
 arch/x86/include/asm/tlbflush.h                    |   1 +
 arch/x86/include/asm/uaccess_64.h                  |   2 +-
 arch/x86/kernel/cpu/Makefile                       |   2 +-
 arch/x86/kernel/cpu/centaur.c                      |   2 +-
 arch/x86/kernel/cpu/cyrix.c                        |   1 +
 arch/x86/kernel/cpu/intel.c                        |   2 +-
 arch/x86/kernel/cpu/intel_cacheinfo.c              |   2 +-
 arch/x86/kernel/cpu/match.c                        |   2 +-
 arch/x86/kernel/cpu/mkcapflags.sh                  |   6 +-
 arch/x86/kernel/cpu/mtrr/main.c                    |   2 +-
 arch/x86/kernel/cpu/transmeta.c                    |   2 +-
 arch/x86/kernel/e820.c                             |   1 +
 arch/x86/kernel/head_32.S                          |   2 +-
 arch/x86/kernel/hpet.c                             |   1 +
 arch/x86/kernel/msr.c                              |   2 +-
 arch/x86/kernel/verify_cpu.S                       |   2 +-
 arch/x86/lib/clear_page_64.S                       |   2 +-
 arch/x86/lib/copy_page_64.S                        |   2 +-
 arch/x86/lib/copy_user_64.S                        |   2 +-
 arch/x86/lib/memcpy_64.S                           |   2 +-
 arch/x86/lib/memmove_64.S                          |   2 +-
 arch/x86/lib/memset_64.S                           |   2 +-
 arch/x86/mm/setup_nx.c                             |   1 +
 arch/x86/oprofile/op_model_amd.c                   |   1 -
 arch/x86/um/asm/barrier.h                          |   2 +-
 lib/atomic64_test.c                                |   2 +-
 50 files changed, 54 insertions(+), 658 deletions(-)
</pre>
</div>



<h2>Patch</h2>
<div class="patch">
<pre class="content">
<span class="p_header">diff --git a/Documentation/kernel-parameters.txt b/Documentation/kernel-parameters.txt</span>
<span class="p_header">index 87d40a7..c0c6253 100644</span>
<span class="p_header">--- a/Documentation/kernel-parameters.txt</span>
<span class="p_header">+++ b/Documentation/kernel-parameters.txt</span>
<span class="p_chunk">@@ -666,7 +666,7 @@</span> <span class="p_context"> bytes respectively. Such letter suffixes can also be entirely omitted.</span>
 
 	clearcpuid=BITNUM [X86]
 			Disable CPUID feature X for the kernel. See
<span class="p_del">-			arch/x86/include/asm/cpufeature.h for the valid bit</span>
<span class="p_add">+			arch/x86/include/asm/cpufeatures.h for the valid bit</span>
 			numbers. Note the Linux specific bits are not necessarily
 			stable over kernel options, but the vendor specific
 			ones should be.
<span class="p_header">diff --git a/arch/x86/boot/cpuflags.h b/arch/x86/boot/cpuflags.h</span>
<span class="p_header">index ea97697..4cb404f 100644</span>
<span class="p_header">--- a/arch/x86/boot/cpuflags.h</span>
<span class="p_header">+++ b/arch/x86/boot/cpuflags.h</span>
<span class="p_chunk">@@ -1,7 +1,7 @@</span> <span class="p_context"></span>
 #ifndef BOOT_CPUFLAGS_H
 #define BOOT_CPUFLAGS_H
 
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/processor-flags.h&gt;
 
 struct cpu_features {
<span class="p_header">diff --git a/arch/x86/boot/mkcpustr.c b/arch/x86/boot/mkcpustr.c</span>
<span class="p_header">index 637097e..f72498d 100644</span>
<span class="p_header">--- a/arch/x86/boot/mkcpustr.c</span>
<span class="p_header">+++ b/arch/x86/boot/mkcpustr.c</span>
<span class="p_chunk">@@ -17,7 +17,7 @@</span> <span class="p_context"></span>
 
 #include &quot;../include/asm/required-features.h&quot;
 #include &quot;../include/asm/disabled-features.h&quot;
<span class="p_del">-#include &quot;../include/asm/cpufeature.h&quot;</span>
<span class="p_add">+#include &quot;../include/asm/cpufeatures.h&quot;</span>
 #include &quot;../kernel/cpu/capflags.c&quot;
 
 int main(void)
<span class="p_header">diff --git a/arch/x86/crypto/crc32-pclmul_glue.c b/arch/x86/crypto/crc32-pclmul_glue.c</span>
<span class="p_header">index 07d2c6c..27226df 100644</span>
<span class="p_header">--- a/arch/x86/crypto/crc32-pclmul_glue.c</span>
<span class="p_header">+++ b/arch/x86/crypto/crc32-pclmul_glue.c</span>
<span class="p_chunk">@@ -33,7 +33,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/crc32.h&gt;
 #include &lt;crypto/internal/hash.h&gt;
 
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/cpu_device_id.h&gt;
 #include &lt;asm/fpu/api.h&gt;
 
<span class="p_header">diff --git a/arch/x86/crypto/crc32c-intel_glue.c b/arch/x86/crypto/crc32c-intel_glue.c</span>
<span class="p_header">index 0e98716..0857b1a 100644</span>
<span class="p_header">--- a/arch/x86/crypto/crc32c-intel_glue.c</span>
<span class="p_header">+++ b/arch/x86/crypto/crc32c-intel_glue.c</span>
<span class="p_chunk">@@ -30,7 +30,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/kernel.h&gt;
 #include &lt;crypto/internal/hash.h&gt;
 
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/cpu_device_id.h&gt;
 #include &lt;asm/fpu/internal.h&gt;
 
<span class="p_header">diff --git a/arch/x86/crypto/crct10dif-pclmul_glue.c b/arch/x86/crypto/crct10dif-pclmul_glue.c</span>
<span class="p_header">index a3fcfc9..cd4df93 100644</span>
<span class="p_header">--- a/arch/x86/crypto/crct10dif-pclmul_glue.c</span>
<span class="p_header">+++ b/arch/x86/crypto/crct10dif-pclmul_glue.c</span>
<span class="p_chunk">@@ -30,7 +30,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/string.h&gt;
 #include &lt;linux/kernel.h&gt;
 #include &lt;asm/fpu/api.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/cpu_device_id.h&gt;
 
 asmlinkage __u16 crc_t10dif_pcl(__u16 crc, const unsigned char *buf,
<span class="p_header">diff --git a/arch/x86/entry/common.c b/arch/x86/entry/common.c</span>
<span class="p_header">index 75175f9..c6ab2eb 100644</span>
<span class="p_header">--- a/arch/x86/entry/common.c</span>
<span class="p_header">+++ b/arch/x86/entry/common.c</span>
<span class="p_chunk">@@ -26,6 +26,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/traps.h&gt;
 #include &lt;asm/vdso.h&gt;
 #include &lt;asm/uaccess.h&gt;
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 
 #define CREATE_TRACE_POINTS
 #include &lt;trace/events/syscalls.h&gt;
<span class="p_header">diff --git a/arch/x86/entry/entry_32.S b/arch/x86/entry/entry_32.S</span>
<span class="p_header">index 77d8c51..4c52283 100644</span>
<span class="p_header">--- a/arch/x86/entry/entry_32.S</span>
<span class="p_header">+++ b/arch/x86/entry/entry_32.S</span>
<span class="p_chunk">@@ -40,7 +40,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/processor-flags.h&gt;
 #include &lt;asm/ftrace.h&gt;
 #include &lt;asm/irq_vectors.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/alternative-asm.h&gt;
 #include &lt;asm/asm.h&gt;
 #include &lt;asm/smap.h&gt;
<span class="p_header">diff --git a/arch/x86/entry/vdso/vdso32-setup.c b/arch/x86/entry/vdso/vdso32-setup.c</span>
<span class="p_header">index 08a317a..7853b53 100644</span>
<span class="p_header">--- a/arch/x86/entry/vdso/vdso32-setup.c</span>
<span class="p_header">+++ b/arch/x86/entry/vdso/vdso32-setup.c</span>
<span class="p_chunk">@@ -11,7 +11,6 @@</span> <span class="p_context"></span>
 #include &lt;linux/kernel.h&gt;
 #include &lt;linux/mm_types.h&gt;
 
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
 #include &lt;asm/processor.h&gt;
 #include &lt;asm/vdso.h&gt;
 
<span class="p_header">diff --git a/arch/x86/entry/vdso/vdso32/system_call.S b/arch/x86/entry/vdso/vdso32/system_call.S</span>
<span class="p_header">index 3a1d929..0109ac6 100644</span>
<span class="p_header">--- a/arch/x86/entry/vdso/vdso32/system_call.S</span>
<span class="p_header">+++ b/arch/x86/entry/vdso/vdso32/system_call.S</span>
<span class="p_chunk">@@ -3,7 +3,7 @@</span> <span class="p_context"></span>
 */
 
 #include &lt;asm/dwarf2.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/alternative-asm.h&gt;
 
 /*
<span class="p_header">diff --git a/arch/x86/entry/vdso/vma.c b/arch/x86/entry/vdso/vma.c</span>
<span class="p_header">index 7c912fe..429d54d 100644</span>
<span class="p_header">--- a/arch/x86/entry/vdso/vma.c</span>
<span class="p_header">+++ b/arch/x86/entry/vdso/vma.c</span>
<span class="p_chunk">@@ -20,6 +20,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/page.h&gt;
 #include &lt;asm/hpet.h&gt;
 #include &lt;asm/desc.h&gt;
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 
 #if defined(CONFIG_X86_64)
 unsigned int __read_mostly vdso64_enabled = 1;
<span class="p_header">diff --git a/arch/x86/include/asm/alternative.h b/arch/x86/include/asm/alternative.h</span>
<span class="p_header">index 7bfc85b..99afb66 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/alternative.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/alternative.h</span>
<span class="p_chunk">@@ -152,12 +152,6 @@</span> <span class="p_context"> static inline int alternatives_text_reserved(void *start, void *end)</span>
 	&quot;.popsection&quot;
 
 /*
<span class="p_del">- * This must be included *after* the definition of ALTERNATIVE due to</span>
<span class="p_del">- * &lt;asm/arch_hweight.h&gt;</span>
<span class="p_del">- */</span>
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_del">-</span>
<span class="p_del">-/*</span>
  * Alternative instructions for different CPU types or capabilities.
  *
  * This allows to use optimized instructions even on generic binary
<span class="p_header">diff --git a/arch/x86/include/asm/apic.h b/arch/x86/include/asm/apic.h</span>
<span class="p_header">index c80f6b6..0899cfc 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/apic.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/apic.h</span>
<span class="p_chunk">@@ -6,7 +6,6 @@</span> <span class="p_context"></span>
 
 #include &lt;asm/alternative.h&gt;
 #include &lt;asm/cpufeature.h&gt;
<span class="p_del">-#include &lt;asm/processor.h&gt;</span>
 #include &lt;asm/apicdef.h&gt;
 #include &lt;linux/atomic.h&gt;
 #include &lt;asm/fixmap.h&gt;
<span class="p_header">diff --git a/arch/x86/include/asm/arch_hweight.h b/arch/x86/include/asm/arch_hweight.h</span>
<span class="p_header">index 259a7c1..02e799f 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/arch_hweight.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/arch_hweight.h</span>
<span class="p_chunk">@@ -1,6 +1,8 @@</span> <span class="p_context"></span>
 #ifndef _ASM_X86_HWEIGHT_H
 #define _ASM_X86_HWEIGHT_H
 
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
<span class="p_add">+</span>
 #ifdef CONFIG_64BIT
 /* popcnt %edi, %eax -- redundant REX prefix for alignment */
 #define POPCNT32 &quot;.byte 0xf3,0x40,0x0f,0xb8,0xc7&quot;
<span class="p_header">diff --git a/arch/x86/include/asm/cmpxchg.h b/arch/x86/include/asm/cmpxchg.h</span>
<span class="p_header">index ad19841..9733361 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/cmpxchg.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/cmpxchg.h</span>
<span class="p_chunk">@@ -2,6 +2,7 @@</span> <span class="p_context"></span>
 #define ASM_X86_CMPXCHG_H
 
 #include &lt;linux/compiler.h&gt;
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/alternative.h&gt; /* Provides LOCK_PREFIX */
 
 /*
<span class="p_header">diff --git a/arch/x86/include/asm/cpufeature.h b/arch/x86/include/asm/cpufeature.h</span>
<span class="p_header">index bbf166e..3cce9f3 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/cpufeature.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/cpufeature.h</span>
<span class="p_chunk">@@ -1,289 +1,7 @@</span> <span class="p_context"></span>
<span class="p_del">-/*</span>
<span class="p_del">- * Defines x86 CPU feature bits</span>
<span class="p_del">- */</span>
 #ifndef _ASM_X86_CPUFEATURE_H
 #define _ASM_X86_CPUFEATURE_H
 
<span class="p_del">-#ifndef _ASM_X86_REQUIRED_FEATURES_H</span>
<span class="p_del">-#include &lt;asm/required-features.h&gt;</span>
<span class="p_del">-#endif</span>
<span class="p_del">-</span>
<span class="p_del">-#ifndef _ASM_X86_DISABLED_FEATURES_H</span>
<span class="p_del">-#include &lt;asm/disabled-features.h&gt;</span>
<span class="p_del">-#endif</span>
<span class="p_del">-</span>
<span class="p_del">-#define NCAPINTS	16	/* N 32-bit words worth of info */</span>
<span class="p_del">-#define NBUGINTS	1	/* N 32-bit bug flags */</span>
<span class="p_del">-</span>
<span class="p_del">-/*</span>
<span class="p_del">- * Note: If the comment begins with a quoted string, that string is used</span>
<span class="p_del">- * in /proc/cpuinfo instead of the macro name.  If the string is &quot;&quot;,</span>
<span class="p_del">- * this feature bit is not displayed in /proc/cpuinfo at all.</span>
<span class="p_del">- */</span>
<span class="p_del">-</span>
<span class="p_del">-/* Intel-defined CPU features, CPUID level 0x00000001 (edx), word 0 */</span>
<span class="p_del">-#define X86_FEATURE_FPU		( 0*32+ 0) /* Onboard FPU */</span>
<span class="p_del">-#define X86_FEATURE_VME		( 0*32+ 1) /* Virtual Mode Extensions */</span>
<span class="p_del">-#define X86_FEATURE_DE		( 0*32+ 2) /* Debugging Extensions */</span>
<span class="p_del">-#define X86_FEATURE_PSE		( 0*32+ 3) /* Page Size Extensions */</span>
<span class="p_del">-#define X86_FEATURE_TSC		( 0*32+ 4) /* Time Stamp Counter */</span>
<span class="p_del">-#define X86_FEATURE_MSR		( 0*32+ 5) /* Model-Specific Registers */</span>
<span class="p_del">-#define X86_FEATURE_PAE		( 0*32+ 6) /* Physical Address Extensions */</span>
<span class="p_del">-#define X86_FEATURE_MCE		( 0*32+ 7) /* Machine Check Exception */</span>
<span class="p_del">-#define X86_FEATURE_CX8		( 0*32+ 8) /* CMPXCHG8 instruction */</span>
<span class="p_del">-#define X86_FEATURE_APIC	( 0*32+ 9) /* Onboard APIC */</span>
<span class="p_del">-#define X86_FEATURE_SEP		( 0*32+11) /* SYSENTER/SYSEXIT */</span>
<span class="p_del">-#define X86_FEATURE_MTRR	( 0*32+12) /* Memory Type Range Registers */</span>
<span class="p_del">-#define X86_FEATURE_PGE		( 0*32+13) /* Page Global Enable */</span>
<span class="p_del">-#define X86_FEATURE_MCA		( 0*32+14) /* Machine Check Architecture */</span>
<span class="p_del">-#define X86_FEATURE_CMOV	( 0*32+15) /* CMOV instructions */</span>
<span class="p_del">-					  /* (plus FCMOVcc, FCOMI with FPU) */</span>
<span class="p_del">-#define X86_FEATURE_PAT		( 0*32+16) /* Page Attribute Table */</span>
<span class="p_del">-#define X86_FEATURE_PSE36	( 0*32+17) /* 36-bit PSEs */</span>
<span class="p_del">-#define X86_FEATURE_PN		( 0*32+18) /* Processor serial number */</span>
<span class="p_del">-#define X86_FEATURE_CLFLUSH	( 0*32+19) /* CLFLUSH instruction */</span>
<span class="p_del">-#define X86_FEATURE_DS		( 0*32+21) /* &quot;dts&quot; Debug Store */</span>
<span class="p_del">-#define X86_FEATURE_ACPI	( 0*32+22) /* ACPI via MSR */</span>
<span class="p_del">-#define X86_FEATURE_MMX		( 0*32+23) /* Multimedia Extensions */</span>
<span class="p_del">-#define X86_FEATURE_FXSR	( 0*32+24) /* FXSAVE/FXRSTOR, CR4.OSFXSR */</span>
<span class="p_del">-#define X86_FEATURE_XMM		( 0*32+25) /* &quot;sse&quot; */</span>
<span class="p_del">-#define X86_FEATURE_XMM2	( 0*32+26) /* &quot;sse2&quot; */</span>
<span class="p_del">-#define X86_FEATURE_SELFSNOOP	( 0*32+27) /* &quot;ss&quot; CPU self snoop */</span>
<span class="p_del">-#define X86_FEATURE_HT		( 0*32+28) /* Hyper-Threading */</span>
<span class="p_del">-#define X86_FEATURE_ACC		( 0*32+29) /* &quot;tm&quot; Automatic clock control */</span>
<span class="p_del">-#define X86_FEATURE_IA64	( 0*32+30) /* IA-64 processor */</span>
<span class="p_del">-#define X86_FEATURE_PBE		( 0*32+31) /* Pending Break Enable */</span>
<span class="p_del">-</span>
<span class="p_del">-/* AMD-defined CPU features, CPUID level 0x80000001, word 1 */</span>
<span class="p_del">-/* Don&#39;t duplicate feature flags which are redundant with Intel! */</span>
<span class="p_del">-#define X86_FEATURE_SYSCALL	( 1*32+11) /* SYSCALL/SYSRET */</span>
<span class="p_del">-#define X86_FEATURE_MP		( 1*32+19) /* MP Capable. */</span>
<span class="p_del">-#define X86_FEATURE_NX		( 1*32+20) /* Execute Disable */</span>
<span class="p_del">-#define X86_FEATURE_MMXEXT	( 1*32+22) /* AMD MMX extensions */</span>
<span class="p_del">-#define X86_FEATURE_FXSR_OPT	( 1*32+25) /* FXSAVE/FXRSTOR optimizations */</span>
<span class="p_del">-#define X86_FEATURE_GBPAGES	( 1*32+26) /* &quot;pdpe1gb&quot; GB pages */</span>
<span class="p_del">-#define X86_FEATURE_RDTSCP	( 1*32+27) /* RDTSCP */</span>
<span class="p_del">-#define X86_FEATURE_LM		( 1*32+29) /* Long Mode (x86-64) */</span>
<span class="p_del">-#define X86_FEATURE_3DNOWEXT	( 1*32+30) /* AMD 3DNow! extensions */</span>
<span class="p_del">-#define X86_FEATURE_3DNOW	( 1*32+31) /* 3DNow! */</span>
<span class="p_del">-</span>
<span class="p_del">-/* Transmeta-defined CPU features, CPUID level 0x80860001, word 2 */</span>
<span class="p_del">-#define X86_FEATURE_RECOVERY	( 2*32+ 0) /* CPU in recovery mode */</span>
<span class="p_del">-#define X86_FEATURE_LONGRUN	( 2*32+ 1) /* Longrun power control */</span>
<span class="p_del">-#define X86_FEATURE_LRTI	( 2*32+ 3) /* LongRun table interface */</span>
<span class="p_del">-</span>
<span class="p_del">-/* Other features, Linux-defined mapping, word 3 */</span>
<span class="p_del">-/* This range is used for feature bits which conflict or are synthesized */</span>
<span class="p_del">-#define X86_FEATURE_CXMMX	( 3*32+ 0) /* Cyrix MMX extensions */</span>
<span class="p_del">-#define X86_FEATURE_K6_MTRR	( 3*32+ 1) /* AMD K6 nonstandard MTRRs */</span>
<span class="p_del">-#define X86_FEATURE_CYRIX_ARR	( 3*32+ 2) /* Cyrix ARRs (= MTRRs) */</span>
<span class="p_del">-#define X86_FEATURE_CENTAUR_MCR	( 3*32+ 3) /* Centaur MCRs (= MTRRs) */</span>
<span class="p_del">-/* cpu types for specific tunings: */</span>
<span class="p_del">-#define X86_FEATURE_K8		( 3*32+ 4) /* &quot;&quot; Opteron, Athlon64 */</span>
<span class="p_del">-#define X86_FEATURE_K7		( 3*32+ 5) /* &quot;&quot; Athlon */</span>
<span class="p_del">-#define X86_FEATURE_P3		( 3*32+ 6) /* &quot;&quot; P3 */</span>
<span class="p_del">-#define X86_FEATURE_P4		( 3*32+ 7) /* &quot;&quot; P4 */</span>
<span class="p_del">-#define X86_FEATURE_CONSTANT_TSC ( 3*32+ 8) /* TSC ticks at a constant rate */</span>
<span class="p_del">-#define X86_FEATURE_UP		( 3*32+ 9) /* smp kernel running on up */</span>
<span class="p_del">-/* free, was #define X86_FEATURE_FXSAVE_LEAK ( 3*32+10) * &quot;&quot; FXSAVE leaks FOP/FIP/FOP */</span>
<span class="p_del">-#define X86_FEATURE_ARCH_PERFMON ( 3*32+11) /* Intel Architectural PerfMon */</span>
<span class="p_del">-#define X86_FEATURE_PEBS	( 3*32+12) /* Precise-Event Based Sampling */</span>
<span class="p_del">-#define X86_FEATURE_BTS		( 3*32+13) /* Branch Trace Store */</span>
<span class="p_del">-#define X86_FEATURE_SYSCALL32	( 3*32+14) /* &quot;&quot; syscall in ia32 userspace */</span>
<span class="p_del">-#define X86_FEATURE_SYSENTER32	( 3*32+15) /* &quot;&quot; sysenter in ia32 userspace */</span>
<span class="p_del">-#define X86_FEATURE_REP_GOOD	( 3*32+16) /* rep microcode works well */</span>
<span class="p_del">-#define X86_FEATURE_MFENCE_RDTSC ( 3*32+17) /* &quot;&quot; Mfence synchronizes RDTSC */</span>
<span class="p_del">-#define X86_FEATURE_LFENCE_RDTSC ( 3*32+18) /* &quot;&quot; Lfence synchronizes RDTSC */</span>
<span class="p_del">-/* free, was #define X86_FEATURE_11AP	( 3*32+19) * &quot;&quot; Bad local APIC aka 11AP */</span>
<span class="p_del">-#define X86_FEATURE_NOPL	( 3*32+20) /* The NOPL (0F 1F) instructions */</span>
<span class="p_del">-#define X86_FEATURE_ALWAYS	( 3*32+21) /* &quot;&quot; Always-present feature */</span>
<span class="p_del">-#define X86_FEATURE_XTOPOLOGY	( 3*32+22) /* cpu topology enum extensions */</span>
<span class="p_del">-#define X86_FEATURE_TSC_RELIABLE ( 3*32+23) /* TSC is known to be reliable */</span>
<span class="p_del">-#define X86_FEATURE_NONSTOP_TSC	( 3*32+24) /* TSC does not stop in C states */</span>
<span class="p_del">-/* free, was #define X86_FEATURE_CLFLUSH_MONITOR ( 3*32+25) * &quot;&quot; clflush reqd with monitor */</span>
<span class="p_del">-#define X86_FEATURE_EXTD_APICID	( 3*32+26) /* has extended APICID (8 bits) */</span>
<span class="p_del">-#define X86_FEATURE_AMD_DCM     ( 3*32+27) /* multi-node processor */</span>
<span class="p_del">-#define X86_FEATURE_APERFMPERF	( 3*32+28) /* APERFMPERF */</span>
<span class="p_del">-#define X86_FEATURE_EAGER_FPU	( 3*32+29) /* &quot;eagerfpu&quot; Non lazy FPU restore */</span>
<span class="p_del">-#define X86_FEATURE_NONSTOP_TSC_S3 ( 3*32+30) /* TSC doesn&#39;t stop in S3 state */</span>
<span class="p_del">-</span>
<span class="p_del">-/* Intel-defined CPU features, CPUID level 0x00000001 (ecx), word 4 */</span>
<span class="p_del">-#define X86_FEATURE_XMM3	( 4*32+ 0) /* &quot;pni&quot; SSE-3 */</span>
<span class="p_del">-#define X86_FEATURE_PCLMULQDQ	( 4*32+ 1) /* PCLMULQDQ instruction */</span>
<span class="p_del">-#define X86_FEATURE_DTES64	( 4*32+ 2) /* 64-bit Debug Store */</span>
<span class="p_del">-#define X86_FEATURE_MWAIT	( 4*32+ 3) /* &quot;monitor&quot; Monitor/Mwait support */</span>
<span class="p_del">-#define X86_FEATURE_DSCPL	( 4*32+ 4) /* &quot;ds_cpl&quot; CPL Qual. Debug Store */</span>
<span class="p_del">-#define X86_FEATURE_VMX		( 4*32+ 5) /* Hardware virtualization */</span>
<span class="p_del">-#define X86_FEATURE_SMX		( 4*32+ 6) /* Safer mode */</span>
<span class="p_del">-#define X86_FEATURE_EST		( 4*32+ 7) /* Enhanced SpeedStep */</span>
<span class="p_del">-#define X86_FEATURE_TM2		( 4*32+ 8) /* Thermal Monitor 2 */</span>
<span class="p_del">-#define X86_FEATURE_SSSE3	( 4*32+ 9) /* Supplemental SSE-3 */</span>
<span class="p_del">-#define X86_FEATURE_CID		( 4*32+10) /* Context ID */</span>
<span class="p_del">-#define X86_FEATURE_SDBG	( 4*32+11) /* Silicon Debug */</span>
<span class="p_del">-#define X86_FEATURE_FMA		( 4*32+12) /* Fused multiply-add */</span>
<span class="p_del">-#define X86_FEATURE_CX16	( 4*32+13) /* CMPXCHG16B */</span>
<span class="p_del">-#define X86_FEATURE_XTPR	( 4*32+14) /* Send Task Priority Messages */</span>
<span class="p_del">-#define X86_FEATURE_PDCM	( 4*32+15) /* Performance Capabilities */</span>
<span class="p_del">-#define X86_FEATURE_PCID	( 4*32+17) /* Process Context Identifiers */</span>
<span class="p_del">-#define X86_FEATURE_DCA		( 4*32+18) /* Direct Cache Access */</span>
<span class="p_del">-#define X86_FEATURE_XMM4_1	( 4*32+19) /* &quot;sse4_1&quot; SSE-4.1 */</span>
<span class="p_del">-#define X86_FEATURE_XMM4_2	( 4*32+20) /* &quot;sse4_2&quot; SSE-4.2 */</span>
<span class="p_del">-#define X86_FEATURE_X2APIC	( 4*32+21) /* x2APIC */</span>
<span class="p_del">-#define X86_FEATURE_MOVBE	( 4*32+22) /* MOVBE instruction */</span>
<span class="p_del">-#define X86_FEATURE_POPCNT      ( 4*32+23) /* POPCNT instruction */</span>
<span class="p_del">-#define X86_FEATURE_TSC_DEADLINE_TIMER	( 4*32+24) /* Tsc deadline timer */</span>
<span class="p_del">-#define X86_FEATURE_AES		( 4*32+25) /* AES instructions */</span>
<span class="p_del">-#define X86_FEATURE_XSAVE	( 4*32+26) /* XSAVE/XRSTOR/XSETBV/XGETBV */</span>
<span class="p_del">-#define X86_FEATURE_OSXSAVE	( 4*32+27) /* &quot;&quot; XSAVE enabled in the OS */</span>
<span class="p_del">-#define X86_FEATURE_AVX		( 4*32+28) /* Advanced Vector Extensions */</span>
<span class="p_del">-#define X86_FEATURE_F16C	( 4*32+29) /* 16-bit fp conversions */</span>
<span class="p_del">-#define X86_FEATURE_RDRAND	( 4*32+30) /* The RDRAND instruction */</span>
<span class="p_del">-#define X86_FEATURE_HYPERVISOR	( 4*32+31) /* Running on a hypervisor */</span>
<span class="p_del">-</span>
<span class="p_del">-/* VIA/Cyrix/Centaur-defined CPU features, CPUID level 0xC0000001, word 5 */</span>
<span class="p_del">-#define X86_FEATURE_XSTORE	( 5*32+ 2) /* &quot;rng&quot; RNG present (xstore) */</span>
<span class="p_del">-#define X86_FEATURE_XSTORE_EN	( 5*32+ 3) /* &quot;rng_en&quot; RNG enabled */</span>
<span class="p_del">-#define X86_FEATURE_XCRYPT	( 5*32+ 6) /* &quot;ace&quot; on-CPU crypto (xcrypt) */</span>
<span class="p_del">-#define X86_FEATURE_XCRYPT_EN	( 5*32+ 7) /* &quot;ace_en&quot; on-CPU crypto enabled */</span>
<span class="p_del">-#define X86_FEATURE_ACE2	( 5*32+ 8) /* Advanced Cryptography Engine v2 */</span>
<span class="p_del">-#define X86_FEATURE_ACE2_EN	( 5*32+ 9) /* ACE v2 enabled */</span>
<span class="p_del">-#define X86_FEATURE_PHE		( 5*32+10) /* PadLock Hash Engine */</span>
<span class="p_del">-#define X86_FEATURE_PHE_EN	( 5*32+11) /* PHE enabled */</span>
<span class="p_del">-#define X86_FEATURE_PMM		( 5*32+12) /* PadLock Montgomery Multiplier */</span>
<span class="p_del">-#define X86_FEATURE_PMM_EN	( 5*32+13) /* PMM enabled */</span>
<span class="p_del">-</span>
<span class="p_del">-/* More extended AMD flags: CPUID level 0x80000001, ecx, word 6 */</span>
<span class="p_del">-#define X86_FEATURE_LAHF_LM	( 6*32+ 0) /* LAHF/SAHF in long mode */</span>
<span class="p_del">-#define X86_FEATURE_CMP_LEGACY	( 6*32+ 1) /* If yes HyperThreading not valid */</span>
<span class="p_del">-#define X86_FEATURE_SVM		( 6*32+ 2) /* Secure virtual machine */</span>
<span class="p_del">-#define X86_FEATURE_EXTAPIC	( 6*32+ 3) /* Extended APIC space */</span>
<span class="p_del">-#define X86_FEATURE_CR8_LEGACY	( 6*32+ 4) /* CR8 in 32-bit mode */</span>
<span class="p_del">-#define X86_FEATURE_ABM		( 6*32+ 5) /* Advanced bit manipulation */</span>
<span class="p_del">-#define X86_FEATURE_SSE4A	( 6*32+ 6) /* SSE-4A */</span>
<span class="p_del">-#define X86_FEATURE_MISALIGNSSE ( 6*32+ 7) /* Misaligned SSE mode */</span>
<span class="p_del">-#define X86_FEATURE_3DNOWPREFETCH ( 6*32+ 8) /* 3DNow prefetch instructions */</span>
<span class="p_del">-#define X86_FEATURE_OSVW	( 6*32+ 9) /* OS Visible Workaround */</span>
<span class="p_del">-#define X86_FEATURE_IBS		( 6*32+10) /* Instruction Based Sampling */</span>
<span class="p_del">-#define X86_FEATURE_XOP		( 6*32+11) /* extended AVX instructions */</span>
<span class="p_del">-#define X86_FEATURE_SKINIT	( 6*32+12) /* SKINIT/STGI instructions */</span>
<span class="p_del">-#define X86_FEATURE_WDT		( 6*32+13) /* Watchdog timer */</span>
<span class="p_del">-#define X86_FEATURE_LWP		( 6*32+15) /* Light Weight Profiling */</span>
<span class="p_del">-#define X86_FEATURE_FMA4	( 6*32+16) /* 4 operands MAC instructions */</span>
<span class="p_del">-#define X86_FEATURE_TCE		( 6*32+17) /* translation cache extension */</span>
<span class="p_del">-#define X86_FEATURE_NODEID_MSR	( 6*32+19) /* NodeId MSR */</span>
<span class="p_del">-#define X86_FEATURE_TBM		( 6*32+21) /* trailing bit manipulations */</span>
<span class="p_del">-#define X86_FEATURE_TOPOEXT	( 6*32+22) /* topology extensions CPUID leafs */</span>
<span class="p_del">-#define X86_FEATURE_PERFCTR_CORE ( 6*32+23) /* core performance counter extensions */</span>
<span class="p_del">-#define X86_FEATURE_PERFCTR_NB  ( 6*32+24) /* NB performance counter extensions */</span>
<span class="p_del">-#define X86_FEATURE_BPEXT	(6*32+26) /* data breakpoint extension */</span>
<span class="p_del">-#define X86_FEATURE_PERFCTR_L2	( 6*32+28) /* L2 performance counter extensions */</span>
<span class="p_del">-#define X86_FEATURE_MWAITX	( 6*32+29) /* MWAIT extension (MONITORX/MWAITX) */</span>
<span class="p_del">-</span>
<span class="p_del">-/*</span>
<span class="p_del">- * Auxiliary flags: Linux defined - For features scattered in various</span>
<span class="p_del">- * CPUID levels like 0x6, 0xA etc, word 7.</span>
<span class="p_del">- *</span>
<span class="p_del">- * Reuse free bits when adding new feature flags!</span>
<span class="p_del">- */</span>
<span class="p_del">-</span>
<span class="p_del">-#define X86_FEATURE_CPB		( 7*32+ 2) /* AMD Core Performance Boost */</span>
<span class="p_del">-#define X86_FEATURE_EPB		( 7*32+ 3) /* IA32_ENERGY_PERF_BIAS support */</span>
<span class="p_del">-</span>
<span class="p_del">-#define X86_FEATURE_HW_PSTATE	( 7*32+ 8) /* AMD HW-PState */</span>
<span class="p_del">-#define X86_FEATURE_PROC_FEEDBACK ( 7*32+ 9) /* AMD ProcFeedbackInterface */</span>
<span class="p_del">-</span>
<span class="p_del">-#define X86_FEATURE_INTEL_PT	( 7*32+15) /* Intel Processor Trace */</span>
<span class="p_del">-</span>
<span class="p_del">-/* Virtualization flags: Linux defined, word 8 */</span>
<span class="p_del">-#define X86_FEATURE_TPR_SHADOW  ( 8*32+ 0) /* Intel TPR Shadow */</span>
<span class="p_del">-#define X86_FEATURE_VNMI        ( 8*32+ 1) /* Intel Virtual NMI */</span>
<span class="p_del">-#define X86_FEATURE_FLEXPRIORITY ( 8*32+ 2) /* Intel FlexPriority */</span>
<span class="p_del">-#define X86_FEATURE_EPT         ( 8*32+ 3) /* Intel Extended Page Table */</span>
<span class="p_del">-#define X86_FEATURE_VPID        ( 8*32+ 4) /* Intel Virtual Processor ID */</span>
<span class="p_del">-</span>
<span class="p_del">-#define X86_FEATURE_VMMCALL     ( 8*32+15) /* Prefer vmmcall to vmcall */</span>
<span class="p_del">-#define X86_FEATURE_XENPV       ( 8*32+16) /* &quot;&quot; Xen paravirtual guest */</span>
<span class="p_del">-</span>
<span class="p_del">-</span>
<span class="p_del">-/* Intel-defined CPU features, CPUID level 0x00000007:0 (ebx), word 9 */</span>
<span class="p_del">-#define X86_FEATURE_FSGSBASE	( 9*32+ 0) /* {RD/WR}{FS/GS}BASE instructions*/</span>
<span class="p_del">-#define X86_FEATURE_TSC_ADJUST	( 9*32+ 1) /* TSC adjustment MSR 0x3b */</span>
<span class="p_del">-#define X86_FEATURE_BMI1	( 9*32+ 3) /* 1st group bit manipulation extensions */</span>
<span class="p_del">-#define X86_FEATURE_HLE		( 9*32+ 4) /* Hardware Lock Elision */</span>
<span class="p_del">-#define X86_FEATURE_AVX2	( 9*32+ 5) /* AVX2 instructions */</span>
<span class="p_del">-#define X86_FEATURE_SMEP	( 9*32+ 7) /* Supervisor Mode Execution Protection */</span>
<span class="p_del">-#define X86_FEATURE_BMI2	( 9*32+ 8) /* 2nd group bit manipulation extensions */</span>
<span class="p_del">-#define X86_FEATURE_ERMS	( 9*32+ 9) /* Enhanced REP MOVSB/STOSB */</span>
<span class="p_del">-#define X86_FEATURE_INVPCID	( 9*32+10) /* Invalidate Processor Context ID */</span>
<span class="p_del">-#define X86_FEATURE_RTM		( 9*32+11) /* Restricted Transactional Memory */</span>
<span class="p_del">-#define X86_FEATURE_CQM		( 9*32+12) /* Cache QoS Monitoring */</span>
<span class="p_del">-#define X86_FEATURE_MPX		( 9*32+14) /* Memory Protection Extension */</span>
<span class="p_del">-#define X86_FEATURE_AVX512F	( 9*32+16) /* AVX-512 Foundation */</span>
<span class="p_del">-#define X86_FEATURE_RDSEED	( 9*32+18) /* The RDSEED instruction */</span>
<span class="p_del">-#define X86_FEATURE_ADX		( 9*32+19) /* The ADCX and ADOX instructions */</span>
<span class="p_del">-#define X86_FEATURE_SMAP	( 9*32+20) /* Supervisor Mode Access Prevention */</span>
<span class="p_del">-#define X86_FEATURE_PCOMMIT	( 9*32+22) /* PCOMMIT instruction */</span>
<span class="p_del">-#define X86_FEATURE_CLFLUSHOPT	( 9*32+23) /* CLFLUSHOPT instruction */</span>
<span class="p_del">-#define X86_FEATURE_CLWB	( 9*32+24) /* CLWB instruction */</span>
<span class="p_del">-#define X86_FEATURE_AVX512PF	( 9*32+26) /* AVX-512 Prefetch */</span>
<span class="p_del">-#define X86_FEATURE_AVX512ER	( 9*32+27) /* AVX-512 Exponential and Reciprocal */</span>
<span class="p_del">-#define X86_FEATURE_AVX512CD	( 9*32+28) /* AVX-512 Conflict Detection */</span>
<span class="p_del">-#define X86_FEATURE_SHA_NI	( 9*32+29) /* SHA1/SHA256 Instruction Extensions */</span>
<span class="p_del">-</span>
<span class="p_del">-/* Extended state features, CPUID level 0x0000000d:1 (eax), word 10 */</span>
<span class="p_del">-#define X86_FEATURE_XSAVEOPT	(10*32+ 0) /* XSAVEOPT */</span>
<span class="p_del">-#define X86_FEATURE_XSAVEC	(10*32+ 1) /* XSAVEC */</span>
<span class="p_del">-#define X86_FEATURE_XGETBV1	(10*32+ 2) /* XGETBV with ECX = 1 */</span>
<span class="p_del">-#define X86_FEATURE_XSAVES	(10*32+ 3) /* XSAVES/XRSTORS */</span>
<span class="p_del">-</span>
<span class="p_del">-/* Intel-defined CPU QoS Sub-leaf, CPUID level 0x0000000F:0 (edx), word 11 */</span>
<span class="p_del">-#define X86_FEATURE_CQM_LLC	(11*32+ 1) /* LLC QoS if 1 */</span>
<span class="p_del">-</span>
<span class="p_del">-/* Intel-defined CPU QoS Sub-leaf, CPUID level 0x0000000F:1 (edx), word 12 */</span>
<span class="p_del">-#define X86_FEATURE_CQM_OCCUP_LLC (12*32+ 0) /* LLC occupancy monitoring if 1 */</span>
<span class="p_del">-</span>
<span class="p_del">-/* AMD-defined CPU features, CPUID level 0x80000008 (ebx), word 13 */</span>
<span class="p_del">-#define X86_FEATURE_CLZERO	(13*32+0) /* CLZERO instruction */</span>
<span class="p_del">-</span>
<span class="p_del">-/* Thermal and Power Management Leaf, CPUID level 0x00000006 (eax), word 14 */</span>
<span class="p_del">-#define X86_FEATURE_DTHERM	(14*32+ 0) /* Digital Thermal Sensor */</span>
<span class="p_del">-#define X86_FEATURE_IDA		(14*32+ 1) /* Intel Dynamic Acceleration */</span>
<span class="p_del">-#define X86_FEATURE_ARAT	(14*32+ 2) /* Always Running APIC Timer */</span>
<span class="p_del">-#define X86_FEATURE_PLN		(14*32+ 4) /* Intel Power Limit Notification */</span>
<span class="p_del">-#define X86_FEATURE_PTS		(14*32+ 6) /* Intel Package Thermal Status */</span>
<span class="p_del">-#define X86_FEATURE_HWP		(14*32+ 7) /* Intel Hardware P-states */</span>
<span class="p_del">-#define X86_FEATURE_HWP_NOTIFY	(14*32+ 8) /* HWP Notification */</span>
<span class="p_del">-#define X86_FEATURE_HWP_ACT_WINDOW (14*32+ 9) /* HWP Activity Window */</span>
<span class="p_del">-#define X86_FEATURE_HWP_EPP	(14*32+10) /* HWP Energy Perf. Preference */</span>
<span class="p_del">-#define X86_FEATURE_HWP_PKG_REQ (14*32+11) /* HWP Package Level Request */</span>
<span class="p_del">-</span>
<span class="p_del">-/* AMD SVM Feature Identification, CPUID level 0x8000000a (edx), word 15 */</span>
<span class="p_del">-#define X86_FEATURE_NPT		(15*32+ 0) /* Nested Page Table support */</span>
<span class="p_del">-#define X86_FEATURE_LBRV	(15*32+ 1) /* LBR Virtualization support */</span>
<span class="p_del">-#define X86_FEATURE_SVML	(15*32+ 2) /* &quot;svm_lock&quot; SVM locking MSR */</span>
<span class="p_del">-#define X86_FEATURE_NRIPS	(15*32+ 3) /* &quot;nrip_save&quot; SVM next_rip save */</span>
<span class="p_del">-#define X86_FEATURE_TSCRATEMSR  (15*32+ 4) /* &quot;tsc_scale&quot; TSC scaling support */</span>
<span class="p_del">-#define X86_FEATURE_VMCBCLEAN   (15*32+ 5) /* &quot;vmcb_clean&quot; VMCB clean bits support */</span>
<span class="p_del">-#define X86_FEATURE_FLUSHBYASID (15*32+ 6) /* flush-by-ASID support */</span>
<span class="p_del">-#define X86_FEATURE_DECODEASSISTS (15*32+ 7) /* Decode Assists support */</span>
<span class="p_del">-#define X86_FEATURE_PAUSEFILTER (15*32+10) /* filtered pause intercept */</span>
<span class="p_del">-#define X86_FEATURE_PFTHRESHOLD (15*32+12) /* pause filter threshold */</span>
<span class="p_del">-#define X86_FEATURE_AVIC	(15*32+13) /* Virtual Interrupt Controller */</span>
<span class="p_del">-</span>
<span class="p_del">-/*</span>
<span class="p_del">- * BUG word(s)</span>
<span class="p_del">- */</span>
<span class="p_del">-#define X86_BUG(x)		(NCAPINTS*32 + (x))</span>
<span class="p_del">-</span>
<span class="p_del">-#define X86_BUG_F00F		X86_BUG(0) /* Intel F00F */</span>
<span class="p_del">-#define X86_BUG_FDIV		X86_BUG(1) /* FPU FDIV */</span>
<span class="p_del">-#define X86_BUG_COMA		X86_BUG(2) /* Cyrix 6x86 coma */</span>
<span class="p_del">-#define X86_BUG_AMD_TLB_MMATCH	X86_BUG(3) /* &quot;tlb_mmatch&quot; AMD Erratum 383 */</span>
<span class="p_del">-#define X86_BUG_AMD_APIC_C1E	X86_BUG(4) /* &quot;apic_c1e&quot; AMD Erratum 400 */</span>
<span class="p_del">-#define X86_BUG_11AP		X86_BUG(5) /* Bad local APIC aka 11AP */</span>
<span class="p_del">-#define X86_BUG_FXSAVE_LEAK	X86_BUG(6) /* FXSAVE leaks FOP/FIP/FOP */</span>
<span class="p_del">-#define X86_BUG_CLFLUSH_MONITOR	X86_BUG(7) /* AAI65, CLFLUSH required before MONITOR */</span>
<span class="p_del">-#define X86_BUG_SYSRET_SS_ATTRS	X86_BUG(8) /* SYSRET doesn&#39;t fix up SS attrs */</span>
<span class="p_add">+#include &lt;asm/processor.h&gt;</span>
 
 #if defined(__KERNEL__) &amp;&amp; !defined(__ASSEMBLY__)
 
<span class="p_header">diff --git a/arch/x86/include/asm/cpufeature.h b/arch/x86/include/asm/cpufeatures.h</span>
similarity index 59%
copy from arch/x86/include/asm/cpufeature.h
copy to arch/x86/include/asm/cpufeatures.h
<span class="p_header">index bbf166e..0ceb6ad 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/cpufeature.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/cpufeatures.h</span>
<span class="p_chunk">@@ -1,8 +1,5 @@</span> <span class="p_context"></span>
<span class="p_del">-/*</span>
<span class="p_del">- * Defines x86 CPU feature bits</span>
<span class="p_del">- */</span>
<span class="p_del">-#ifndef _ASM_X86_CPUFEATURE_H</span>
<span class="p_del">-#define _ASM_X86_CPUFEATURE_H</span>
<span class="p_add">+#ifndef _ASM_X86_CPUFEATURES_H</span>
<span class="p_add">+#define _ASM_X86_CPUFEATURES_H</span>
 
 #ifndef _ASM_X86_REQUIRED_FEATURES_H
 #include &lt;asm/required-features.h&gt;
<span class="p_chunk">@@ -12,6 +9,9 @@</span> <span class="p_context"></span>
 #include &lt;asm/disabled-features.h&gt;
 #endif
 
<span class="p_add">+/*</span>
<span class="p_add">+ * Defines x86 CPU feature bits</span>
<span class="p_add">+ */</span>
 #define NCAPINTS	16	/* N 32-bit words worth of info */
 #define NBUGINTS	1	/* N 32-bit bug flags */
 
<span class="p_chunk">@@ -285,328 +285,4 @@</span> <span class="p_context"></span>
 #define X86_BUG_CLFLUSH_MONITOR	X86_BUG(7) /* AAI65, CLFLUSH required before MONITOR */
 #define X86_BUG_SYSRET_SS_ATTRS	X86_BUG(8) /* SYSRET doesn&#39;t fix up SS attrs */
 
<span class="p_del">-#if defined(__KERNEL__) &amp;&amp; !defined(__ASSEMBLY__)</span>
<span class="p_del">-</span>
<span class="p_del">-#include &lt;asm/asm.h&gt;</span>
<span class="p_del">-#include &lt;linux/bitops.h&gt;</span>
<span class="p_del">-</span>
<span class="p_del">-enum cpuid_leafs</span>
<span class="p_del">-{</span>
<span class="p_del">-	CPUID_1_EDX		= 0,</span>
<span class="p_del">-	CPUID_8000_0001_EDX,</span>
<span class="p_del">-	CPUID_8086_0001_EDX,</span>
<span class="p_del">-	CPUID_LNX_1,</span>
<span class="p_del">-	CPUID_1_ECX,</span>
<span class="p_del">-	CPUID_C000_0001_EDX,</span>
<span class="p_del">-	CPUID_8000_0001_ECX,</span>
<span class="p_del">-	CPUID_LNX_2,</span>
<span class="p_del">-	CPUID_LNX_3,</span>
<span class="p_del">-	CPUID_7_0_EBX,</span>
<span class="p_del">-	CPUID_D_1_EAX,</span>
<span class="p_del">-	CPUID_F_0_EDX,</span>
<span class="p_del">-	CPUID_F_1_EDX,</span>
<span class="p_del">-	CPUID_8000_0008_EBX,</span>
<span class="p_del">-	CPUID_6_EAX,</span>
<span class="p_del">-	CPUID_8000_000A_EDX,</span>
<span class="p_del">-};</span>
<span class="p_del">-</span>
<span class="p_del">-#ifdef CONFIG_X86_FEATURE_NAMES</span>
<span class="p_del">-extern const char * const x86_cap_flags[NCAPINTS*32];</span>
<span class="p_del">-extern const char * const x86_power_flags[32];</span>
<span class="p_del">-#define X86_CAP_FMT &quot;%s&quot;</span>
<span class="p_del">-#define x86_cap_flag(flag) x86_cap_flags[flag]</span>
<span class="p_del">-#else</span>
<span class="p_del">-#define X86_CAP_FMT &quot;%d:%d&quot;</span>
<span class="p_del">-#define x86_cap_flag(flag) ((flag) &gt;&gt; 5), ((flag) &amp; 31)</span>
<span class="p_del">-#endif</span>
<span class="p_del">-</span>
<span class="p_del">-/*</span>
<span class="p_del">- * In order to save room, we index into this array by doing</span>
<span class="p_del">- * X86_BUG_&lt;name&gt; - NCAPINTS*32.</span>
<span class="p_del">- */</span>
<span class="p_del">-extern const char * const x86_bug_flags[NBUGINTS*32];</span>
<span class="p_del">-</span>
<span class="p_del">-#define test_cpu_cap(c, bit)						\</span>
<span class="p_del">-	 test_bit(bit, (unsigned long *)((c)-&gt;x86_capability))</span>
<span class="p_del">-</span>
<span class="p_del">-#define REQUIRED_MASK_BIT_SET(bit)					\</span>
<span class="p_del">-	 ( (((bit)&gt;&gt;5)==0 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; REQUIRED_MASK0)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==1 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; REQUIRED_MASK1)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==2 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; REQUIRED_MASK2)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==3 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; REQUIRED_MASK3)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==4 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; REQUIRED_MASK4)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==5 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; REQUIRED_MASK5)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==6 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; REQUIRED_MASK6)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==7 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; REQUIRED_MASK7)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==8 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; REQUIRED_MASK8)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==9 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; REQUIRED_MASK9)) )</span>
<span class="p_del">-</span>
<span class="p_del">-#define DISABLED_MASK_BIT_SET(bit)					\</span>
<span class="p_del">-	 ( (((bit)&gt;&gt;5)==0 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; DISABLED_MASK0)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==1 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; DISABLED_MASK1)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==2 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; DISABLED_MASK2)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==3 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; DISABLED_MASK3)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==4 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; DISABLED_MASK4)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==5 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; DISABLED_MASK5)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==6 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; DISABLED_MASK6)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==7 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; DISABLED_MASK7)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==8 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; DISABLED_MASK8)) ||	\</span>
<span class="p_del">-	   (((bit)&gt;&gt;5)==9 &amp;&amp; (1UL&lt;&lt;((bit)&amp;31) &amp; DISABLED_MASK9)) )</span>
<span class="p_del">-</span>
<span class="p_del">-#define cpu_has(c, bit)							\</span>
<span class="p_del">-	(__builtin_constant_p(bit) &amp;&amp; REQUIRED_MASK_BIT_SET(bit) ? 1 :	\</span>
<span class="p_del">-	 test_cpu_cap(c, bit))</span>
<span class="p_del">-</span>
<span class="p_del">-#define this_cpu_has(bit)						\</span>
<span class="p_del">-	(__builtin_constant_p(bit) &amp;&amp; REQUIRED_MASK_BIT_SET(bit) ? 1 : 	\</span>
<span class="p_del">-	 x86_this_cpu_test_bit(bit, (unsigned long *)&amp;cpu_info.x86_capability))</span>
<span class="p_del">-</span>
<span class="p_del">-/*</span>
<span class="p_del">- * This macro is for detection of features which need kernel</span>
<span class="p_del">- * infrastructure to be used.  It may *not* directly test the CPU</span>
<span class="p_del">- * itself.  Use the cpu_has() family if you want true runtime</span>
<span class="p_del">- * testing of CPU features, like in hypervisor code where you are</span>
<span class="p_del">- * supporting a possible guest feature where host support for it</span>
<span class="p_del">- * is not relevant.</span>
<span class="p_del">- */</span>
<span class="p_del">-#define cpu_feature_enabled(bit)	\</span>
<span class="p_del">-	(__builtin_constant_p(bit) &amp;&amp; DISABLED_MASK_BIT_SET(bit) ? 0 :	\</span>
<span class="p_del">-	 cpu_has(&amp;boot_cpu_data, bit))</span>
<span class="p_del">-</span>
<span class="p_del">-#define boot_cpu_has(bit)	cpu_has(&amp;boot_cpu_data, bit)</span>
<span class="p_del">-</span>
<span class="p_del">-#define set_cpu_cap(c, bit)	set_bit(bit, (unsigned long *)((c)-&gt;x86_capability))</span>
<span class="p_del">-#define clear_cpu_cap(c, bit)	clear_bit(bit, (unsigned long *)((c)-&gt;x86_capability))</span>
<span class="p_del">-#define setup_clear_cpu_cap(bit) do { \</span>
<span class="p_del">-	clear_cpu_cap(&amp;boot_cpu_data, bit);	\</span>
<span class="p_del">-	set_bit(bit, (unsigned long *)cpu_caps_cleared); \</span>
<span class="p_del">-} while (0)</span>
<span class="p_del">-#define setup_force_cpu_cap(bit) do { \</span>
<span class="p_del">-	set_cpu_cap(&amp;boot_cpu_data, bit);	\</span>
<span class="p_del">-	set_bit(bit, (unsigned long *)cpu_caps_set);	\</span>
<span class="p_del">-} while (0)</span>
<span class="p_del">-</span>
<span class="p_del">-#define cpu_has_fpu		boot_cpu_has(X86_FEATURE_FPU)</span>
<span class="p_del">-#define cpu_has_pse		boot_cpu_has(X86_FEATURE_PSE)</span>
<span class="p_del">-#define cpu_has_tsc		boot_cpu_has(X86_FEATURE_TSC)</span>
<span class="p_del">-#define cpu_has_pge		boot_cpu_has(X86_FEATURE_PGE)</span>
<span class="p_del">-#define cpu_has_apic		boot_cpu_has(X86_FEATURE_APIC)</span>
<span class="p_del">-#define cpu_has_fxsr		boot_cpu_has(X86_FEATURE_FXSR)</span>
<span class="p_del">-#define cpu_has_xmm		boot_cpu_has(X86_FEATURE_XMM)</span>
<span class="p_del">-#define cpu_has_xmm2		boot_cpu_has(X86_FEATURE_XMM2)</span>
<span class="p_del">-#define cpu_has_aes		boot_cpu_has(X86_FEATURE_AES)</span>
<span class="p_del">-#define cpu_has_avx		boot_cpu_has(X86_FEATURE_AVX)</span>
<span class="p_del">-#define cpu_has_avx2		boot_cpu_has(X86_FEATURE_AVX2)</span>
<span class="p_del">-#define cpu_has_clflush		boot_cpu_has(X86_FEATURE_CLFLUSH)</span>
<span class="p_del">-#define cpu_has_gbpages		boot_cpu_has(X86_FEATURE_GBPAGES)</span>
<span class="p_del">-#define cpu_has_arch_perfmon	boot_cpu_has(X86_FEATURE_ARCH_PERFMON)</span>
<span class="p_del">-#define cpu_has_pat		boot_cpu_has(X86_FEATURE_PAT)</span>
<span class="p_del">-#define cpu_has_x2apic		boot_cpu_has(X86_FEATURE_X2APIC)</span>
<span class="p_del">-#define cpu_has_xsave		boot_cpu_has(X86_FEATURE_XSAVE)</span>
<span class="p_del">-#define cpu_has_xsaves		boot_cpu_has(X86_FEATURE_XSAVES)</span>
<span class="p_del">-#define cpu_has_osxsave		boot_cpu_has(X86_FEATURE_OSXSAVE)</span>
<span class="p_del">-#define cpu_has_hypervisor	boot_cpu_has(X86_FEATURE_HYPERVISOR)</span>
<span class="p_del">-/*</span>
<span class="p_del">- * Do not add any more of those clumsy macros - use static_cpu_has_safe() for</span>
<span class="p_del">- * fast paths and boot_cpu_has() otherwise!</span>
<span class="p_del">- */</span>
<span class="p_del">-</span>
<span class="p_del">-#if __GNUC__ &gt;= 4 &amp;&amp; defined(CONFIG_X86_FAST_FEATURE_TESTS)</span>
<span class="p_del">-extern void warn_pre_alternatives(void);</span>
<span class="p_del">-extern bool __static_cpu_has_safe(u16 bit);</span>
<span class="p_del">-</span>
<span class="p_del">-/*</span>
<span class="p_del">- * Static testing of CPU features.  Used the same as boot_cpu_has().</span>
<span class="p_del">- * These are only valid after alternatives have run, but will statically</span>
<span class="p_del">- * patch the target code for additional performance.</span>
<span class="p_del">- */</span>
<span class="p_del">-static __always_inline __pure bool __static_cpu_has(u16 bit)</span>
<span class="p_del">-{</span>
<span class="p_del">-#ifdef CC_HAVE_ASM_GOTO</span>
<span class="p_del">-</span>
<span class="p_del">-#ifdef CONFIG_X86_DEBUG_STATIC_CPU_HAS</span>
<span class="p_del">-</span>
<span class="p_del">-		/*</span>
<span class="p_del">-		 * Catch too early usage of this before alternatives</span>
<span class="p_del">-		 * have run.</span>
<span class="p_del">-		 */</span>
<span class="p_del">-		asm_volatile_goto(&quot;1: jmp %l[t_warn]\n&quot;</span>
<span class="p_del">-			 &quot;2:\n&quot;</span>
<span class="p_del">-			 &quot;.section .altinstructions,\&quot;a\&quot;\n&quot;</span>
<span class="p_del">-			 &quot; .long 1b - .\n&quot;</span>
<span class="p_del">-			 &quot; .long 0\n&quot;		/* no replacement */</span>
<span class="p_del">-			 &quot; .word %P0\n&quot;		/* 1: do replace */</span>
<span class="p_del">-			 &quot; .byte 2b - 1b\n&quot;	/* source len */</span>
<span class="p_del">-			 &quot; .byte 0\n&quot;		/* replacement len */</span>
<span class="p_del">-			 &quot; .byte 0\n&quot;		/* pad len */</span>
<span class="p_del">-			 &quot;.previous\n&quot;</span>
<span class="p_del">-			 /* skipping size check since replacement size = 0 */</span>
<span class="p_del">-			 : : &quot;i&quot; (X86_FEATURE_ALWAYS) : : t_warn);</span>
<span class="p_del">-</span>
<span class="p_del">-#endif</span>
<span class="p_del">-</span>
<span class="p_del">-		asm_volatile_goto(&quot;1: jmp %l[t_no]\n&quot;</span>
<span class="p_del">-			 &quot;2:\n&quot;</span>
<span class="p_del">-			 &quot;.section .altinstructions,\&quot;a\&quot;\n&quot;</span>
<span class="p_del">-			 &quot; .long 1b - .\n&quot;</span>
<span class="p_del">-			 &quot; .long 0\n&quot;		/* no replacement */</span>
<span class="p_del">-			 &quot; .word %P0\n&quot;		/* feature bit */</span>
<span class="p_del">-			 &quot; .byte 2b - 1b\n&quot;	/* source len */</span>
<span class="p_del">-			 &quot; .byte 0\n&quot;		/* replacement len */</span>
<span class="p_del">-			 &quot; .byte 0\n&quot;		/* pad len */</span>
<span class="p_del">-			 &quot;.previous\n&quot;</span>
<span class="p_del">-			 /* skipping size check since replacement size = 0 */</span>
<span class="p_del">-			 : : &quot;i&quot; (bit) : : t_no);</span>
<span class="p_del">-		return true;</span>
<span class="p_del">-	t_no:</span>
<span class="p_del">-		return false;</span>
<span class="p_del">-</span>
<span class="p_del">-#ifdef CONFIG_X86_DEBUG_STATIC_CPU_HAS</span>
<span class="p_del">-	t_warn:</span>
<span class="p_del">-		warn_pre_alternatives();</span>
<span class="p_del">-		return false;</span>
<span class="p_del">-#endif</span>
<span class="p_del">-</span>
<span class="p_del">-#else /* CC_HAVE_ASM_GOTO */</span>
<span class="p_del">-</span>
<span class="p_del">-		u8 flag;</span>
<span class="p_del">-		/* Open-coded due to __stringify() in ALTERNATIVE() */</span>
<span class="p_del">-		asm volatile(&quot;1: movb $0,%0\n&quot;</span>
<span class="p_del">-			     &quot;2:\n&quot;</span>
<span class="p_del">-			     &quot;.section .altinstructions,\&quot;a\&quot;\n&quot;</span>
<span class="p_del">-			     &quot; .long 1b - .\n&quot;</span>
<span class="p_del">-			     &quot; .long 3f - .\n&quot;</span>
<span class="p_del">-			     &quot; .word %P1\n&quot;		/* feature bit */</span>
<span class="p_del">-			     &quot; .byte 2b - 1b\n&quot;		/* source len */</span>
<span class="p_del">-			     &quot; .byte 4f - 3f\n&quot;		/* replacement len */</span>
<span class="p_del">-			     &quot; .byte 0\n&quot;		/* pad len */</span>
<span class="p_del">-			     &quot;.previous\n&quot;</span>
<span class="p_del">-			     &quot;.section .discard,\&quot;aw\&quot;,@progbits\n&quot;</span>
<span class="p_del">-			     &quot; .byte 0xff + (4f-3f) - (2b-1b)\n&quot; /* size check */</span>
<span class="p_del">-			     &quot;.previous\n&quot;</span>
<span class="p_del">-			     &quot;.section .altinstr_replacement,\&quot;ax\&quot;\n&quot;</span>
<span class="p_del">-			     &quot;3: movb $1,%0\n&quot;</span>
<span class="p_del">-			     &quot;4:\n&quot;</span>
<span class="p_del">-			     &quot;.previous\n&quot;</span>
<span class="p_del">-			     : &quot;=qm&quot; (flag) : &quot;i&quot; (bit));</span>
<span class="p_del">-		return flag;</span>
<span class="p_del">-</span>
<span class="p_del">-#endif /* CC_HAVE_ASM_GOTO */</span>
<span class="p_del">-}</span>
<span class="p_del">-</span>
<span class="p_del">-#define static_cpu_has(bit)					\</span>
<span class="p_del">-(								\</span>
<span class="p_del">-	__builtin_constant_p(boot_cpu_has(bit)) ?		\</span>
<span class="p_del">-		boot_cpu_has(bit) :				\</span>
<span class="p_del">-	__builtin_constant_p(bit) ?				\</span>
<span class="p_del">-		__static_cpu_has(bit) :				\</span>
<span class="p_del">-		boot_cpu_has(bit)				\</span>
<span class="p_del">-)</span>
<span class="p_del">-</span>
<span class="p_del">-static __always_inline __pure bool _static_cpu_has_safe(u16 bit)</span>
<span class="p_del">-{</span>
<span class="p_del">-#ifdef CC_HAVE_ASM_GOTO</span>
<span class="p_del">-		asm_volatile_goto(&quot;1: jmp %l[t_dynamic]\n&quot;</span>
<span class="p_del">-			 &quot;2:\n&quot;</span>
<span class="p_del">-			 &quot;.skip -(((5f-4f) - (2b-1b)) &gt; 0) * &quot;</span>
<span class="p_del">-			         &quot;((5f-4f) - (2b-1b)),0x90\n&quot;</span>
<span class="p_del">-			 &quot;3:\n&quot;</span>
<span class="p_del">-			 &quot;.section .altinstructions,\&quot;a\&quot;\n&quot;</span>
<span class="p_del">-			 &quot; .long 1b - .\n&quot;		/* src offset */</span>
<span class="p_del">-			 &quot; .long 4f - .\n&quot;		/* repl offset */</span>
<span class="p_del">-			 &quot; .word %P1\n&quot;			/* always replace */</span>
<span class="p_del">-			 &quot; .byte 3b - 1b\n&quot;		/* src len */</span>
<span class="p_del">-			 &quot; .byte 5f - 4f\n&quot;		/* repl len */</span>
<span class="p_del">-			 &quot; .byte 3b - 2b\n&quot;		/* pad len */</span>
<span class="p_del">-			 &quot;.previous\n&quot;</span>
<span class="p_del">-			 &quot;.section .altinstr_replacement,\&quot;ax\&quot;\n&quot;</span>
<span class="p_del">-			 &quot;4: jmp %l[t_no]\n&quot;</span>
<span class="p_del">-			 &quot;5:\n&quot;</span>
<span class="p_del">-			 &quot;.previous\n&quot;</span>
<span class="p_del">-			 &quot;.section .altinstructions,\&quot;a\&quot;\n&quot;</span>
<span class="p_del">-			 &quot; .long 1b - .\n&quot;		/* src offset */</span>
<span class="p_del">-			 &quot; .long 0\n&quot;			/* no replacement */</span>
<span class="p_del">-			 &quot; .word %P0\n&quot;			/* feature bit */</span>
<span class="p_del">-			 &quot; .byte 3b - 1b\n&quot;		/* src len */</span>
<span class="p_del">-			 &quot; .byte 0\n&quot;			/* repl len */</span>
<span class="p_del">-			 &quot; .byte 0\n&quot;			/* pad len */</span>
<span class="p_del">-			 &quot;.previous\n&quot;</span>
<span class="p_del">-			 : : &quot;i&quot; (bit), &quot;i&quot; (X86_FEATURE_ALWAYS)</span>
<span class="p_del">-			 : : t_dynamic, t_no);</span>
<span class="p_del">-		return true;</span>
<span class="p_del">-	t_no:</span>
<span class="p_del">-		return false;</span>
<span class="p_del">-	t_dynamic:</span>
<span class="p_del">-		return __static_cpu_has_safe(bit);</span>
<span class="p_del">-#else</span>
<span class="p_del">-		u8 flag;</span>
<span class="p_del">-		/* Open-coded due to __stringify() in ALTERNATIVE() */</span>
<span class="p_del">-		asm volatile(&quot;1: movb $2,%0\n&quot;</span>
<span class="p_del">-			     &quot;2:\n&quot;</span>
<span class="p_del">-			     &quot;.section .altinstructions,\&quot;a\&quot;\n&quot;</span>
<span class="p_del">-			     &quot; .long 1b - .\n&quot;		/* src offset */</span>
<span class="p_del">-			     &quot; .long 3f - .\n&quot;		/* repl offset */</span>
<span class="p_del">-			     &quot; .word %P2\n&quot;		/* always replace */</span>
<span class="p_del">-			     &quot; .byte 2b - 1b\n&quot;		/* source len */</span>
<span class="p_del">-			     &quot; .byte 4f - 3f\n&quot;		/* replacement len */</span>
<span class="p_del">-			     &quot; .byte 0\n&quot;		/* pad len */</span>
<span class="p_del">-			     &quot;.previous\n&quot;</span>
<span class="p_del">-			     &quot;.section .discard,\&quot;aw\&quot;,@progbits\n&quot;</span>
<span class="p_del">-			     &quot; .byte 0xff + (4f-3f) - (2b-1b)\n&quot; /* size check */</span>
<span class="p_del">-			     &quot;.previous\n&quot;</span>
<span class="p_del">-			     &quot;.section .altinstr_replacement,\&quot;ax\&quot;\n&quot;</span>
<span class="p_del">-			     &quot;3: movb $0,%0\n&quot;</span>
<span class="p_del">-			     &quot;4:\n&quot;</span>
<span class="p_del">-			     &quot;.previous\n&quot;</span>
<span class="p_del">-			     &quot;.section .altinstructions,\&quot;a\&quot;\n&quot;</span>
<span class="p_del">-			     &quot; .long 1b - .\n&quot;		/* src offset */</span>
<span class="p_del">-			     &quot; .long 5f - .\n&quot;		/* repl offset */</span>
<span class="p_del">-			     &quot; .word %P1\n&quot;		/* feature bit */</span>
<span class="p_del">-			     &quot; .byte 4b - 3b\n&quot;		/* src len */</span>
<span class="p_del">-			     &quot; .byte 6f - 5f\n&quot;		/* repl len */</span>
<span class="p_del">-			     &quot; .byte 0\n&quot;		/* pad len */</span>
<span class="p_del">-			     &quot;.previous\n&quot;</span>
<span class="p_del">-			     &quot;.section .discard,\&quot;aw\&quot;,@progbits\n&quot;</span>
<span class="p_del">-			     &quot; .byte 0xff + (6f-5f) - (4b-3b)\n&quot; /* size check */</span>
<span class="p_del">-			     &quot;.previous\n&quot;</span>
<span class="p_del">-			     &quot;.section .altinstr_replacement,\&quot;ax\&quot;\n&quot;</span>
<span class="p_del">-			     &quot;5: movb $1,%0\n&quot;</span>
<span class="p_del">-			     &quot;6:\n&quot;</span>
<span class="p_del">-			     &quot;.previous\n&quot;</span>
<span class="p_del">-			     : &quot;=qm&quot; (flag)</span>
<span class="p_del">-			     : &quot;i&quot; (bit), &quot;i&quot; (X86_FEATURE_ALWAYS));</span>
<span class="p_del">-		return (flag == 2 ? __static_cpu_has_safe(bit) : flag);</span>
<span class="p_del">-#endif /* CC_HAVE_ASM_GOTO */</span>
<span class="p_del">-}</span>
<span class="p_del">-</span>
<span class="p_del">-#define static_cpu_has_safe(bit)				\</span>
<span class="p_del">-(								\</span>
<span class="p_del">-	__builtin_constant_p(boot_cpu_has(bit)) ?		\</span>
<span class="p_del">-		boot_cpu_has(bit) :				\</span>
<span class="p_del">-		_static_cpu_has_safe(bit)			\</span>
<span class="p_del">-)</span>
<span class="p_del">-#else</span>
<span class="p_del">-/*</span>
<span class="p_del">- * gcc 3.x is too stupid to do the static test; fall back to dynamic.</span>
<span class="p_del">- */</span>
<span class="p_del">-#define static_cpu_has(bit)		boot_cpu_has(bit)</span>
<span class="p_del">-#define static_cpu_has_safe(bit)	boot_cpu_has(bit)</span>
<span class="p_del">-#endif</span>
<span class="p_del">-</span>
<span class="p_del">-#define cpu_has_bug(c, bit)		cpu_has(c, (bit))</span>
<span class="p_del">-#define set_cpu_bug(c, bit)		set_cpu_cap(c, (bit))</span>
<span class="p_del">-#define clear_cpu_bug(c, bit)		clear_cpu_cap(c, (bit))</span>
<span class="p_del">-</span>
<span class="p_del">-#define static_cpu_has_bug(bit)		static_cpu_has((bit))</span>
<span class="p_del">-#define static_cpu_has_bug_safe(bit)	static_cpu_has_safe((bit))</span>
<span class="p_del">-#define boot_cpu_has_bug(bit)		cpu_has_bug(&amp;boot_cpu_data, (bit))</span>
<span class="p_del">-</span>
<span class="p_del">-#define MAX_CPU_FEATURES		(NCAPINTS * 32)</span>
<span class="p_del">-#define cpu_have_feature		boot_cpu_has</span>
<span class="p_del">-</span>
<span class="p_del">-#define CPU_FEATURE_TYPEFMT		&quot;x86,ven%04Xfam%04Xmod%04X&quot;</span>
<span class="p_del">-#define CPU_FEATURE_TYPEVAL		boot_cpu_data.x86_vendor, boot_cpu_data.x86, \</span>
<span class="p_del">-					boot_cpu_data.x86_model</span>
<span class="p_del">-</span>
<span class="p_del">-#endif /* defined(__KERNEL__) &amp;&amp; !defined(__ASSEMBLY__) */</span>
<span class="p_del">-#endif /* _ASM_X86_CPUFEATURE_H */</span>
<span class="p_add">+#endif /* _ASM_X86_CPUFEATURES_H */</span>
<span class="p_header">diff --git a/arch/x86/include/asm/fpu/internal.h b/arch/x86/include/asm/fpu/internal.h</span>
<span class="p_header">index 0fd440d..d01199d 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/fpu/internal.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/fpu/internal.h</span>
<span class="p_chunk">@@ -17,6 +17,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/user.h&gt;
 #include &lt;asm/fpu/api.h&gt;
 #include &lt;asm/fpu/xstate.h&gt;
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 
 /*
  * High level FPU state handling functions:
<span class="p_header">diff --git a/arch/x86/include/asm/irq_work.h b/arch/x86/include/asm/irq_work.h</span>
<span class="p_header">index 78162f8..d0afb05 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/irq_work.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/irq_work.h</span>
<span class="p_chunk">@@ -1,7 +1,7 @@</span> <span class="p_context"></span>
 #ifndef _ASM_IRQ_WORK_H
 #define _ASM_IRQ_WORK_H
 
<span class="p_del">-#include &lt;asm/processor.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 
 static inline bool arch_irq_work_has_interrupt(void)
 {
<span class="p_header">diff --git a/arch/x86/include/asm/mwait.h b/arch/x86/include/asm/mwait.h</span>
<span class="p_header">index c70689b..0deeb2d 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/mwait.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/mwait.h</span>
<span class="p_chunk">@@ -3,6 +3,8 @@</span> <span class="p_context"></span>
 
 #include &lt;linux/sched.h&gt;
 
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+</span>
 #define MWAIT_SUBSTATE_MASK		0xf
 #define MWAIT_CSTATE_MASK		0xf
 #define MWAIT_SUBSTATE_SIZE		4
<span class="p_header">diff --git a/arch/x86/include/asm/processor.h b/arch/x86/include/asm/processor.h</span>
<span class="p_header">index 2d5a50c..491a3d9 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/processor.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/processor.h</span>
<span class="p_chunk">@@ -13,7 +13,7 @@</span> <span class="p_context"> struct vm86;</span>
 #include &lt;asm/types.h&gt;
 #include &lt;uapi/asm/sigcontext.h&gt;
 #include &lt;asm/current.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/page.h&gt;
 #include &lt;asm/pgtable_types.h&gt;
 #include &lt;asm/percpu.h&gt;
<span class="p_chunk">@@ -24,7 +24,6 @@</span> <span class="p_context"> struct vm86;</span>
 #include &lt;asm/fpu/types.h&gt;
 
 #include &lt;linux/personality.h&gt;
<span class="p_del">-#include &lt;linux/cpumask.h&gt;</span>
 #include &lt;linux/cache.h&gt;
 #include &lt;linux/threads.h&gt;
 #include &lt;linux/math64.h&gt;
<span class="p_header">diff --git a/arch/x86/include/asm/smap.h b/arch/x86/include/asm/smap.h</span>
<span class="p_header">index ba665eb..db33330 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/smap.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/smap.h</span>
<span class="p_chunk">@@ -15,7 +15,7 @@</span> <span class="p_context"></span>
 
 #include &lt;linux/stringify.h&gt;
 #include &lt;asm/nops.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 
 /* &quot;Raw&quot; instruction opcodes */
 #define __ASM_CLAC	.byte 0x0f,0x01,0xca
<span class="p_header">diff --git a/arch/x86/include/asm/smp.h b/arch/x86/include/asm/smp.h</span>
<span class="p_header">index dfcf072..20a3de5 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/smp.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/smp.h</span>
<span class="p_chunk">@@ -16,7 +16,6 @@</span> <span class="p_context"></span>
 #endif
 #include &lt;asm/thread_info.h&gt;
 #include &lt;asm/cpumask.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
 
 extern int smp_num_siblings;
 extern unsigned int num_processors;
<span class="p_header">diff --git a/arch/x86/include/asm/thread_info.h b/arch/x86/include/asm/thread_info.h</span>
<span class="p_header">index c7b5510..c0778fc 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/thread_info.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/thread_info.h</span>
<span class="p_chunk">@@ -49,7 +49,7 @@</span> <span class="p_context"></span>
  */
 #ifndef __ASSEMBLY__
 struct task_struct;
<span class="p_del">-#include &lt;asm/processor.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 #include &lt;linux/atomic.h&gt;
 
 struct thread_info {
<span class="p_header">diff --git a/arch/x86/include/asm/tlbflush.h b/arch/x86/include/asm/tlbflush.h</span>
<span class="p_header">index 6df2029..0bb31cb 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/tlbflush.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/tlbflush.h</span>
<span class="p_chunk">@@ -5,6 +5,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/sched.h&gt;
 
 #include &lt;asm/processor.h&gt;
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 #include &lt;asm/special_insns.h&gt;
 
 #ifdef CONFIG_PARAVIRT
<span class="p_header">diff --git a/arch/x86/include/asm/uaccess_64.h b/arch/x86/include/asm/uaccess_64.h</span>
<span class="p_header">index b89c34c..3076986 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/uaccess_64.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/uaccess_64.h</span>
<span class="p_chunk">@@ -8,7 +8,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/errno.h&gt;
 #include &lt;linux/lockdep.h&gt;
 #include &lt;asm/alternative.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/page.h&gt;
 
 /*
<span class="p_header">diff --git a/arch/x86/kernel/cpu/Makefile b/arch/x86/kernel/cpu/Makefile</span>
<span class="p_header">index 5803130..faa7b52 100644</span>
<span class="p_header">--- a/arch/x86/kernel/cpu/Makefile</span>
<span class="p_header">+++ b/arch/x86/kernel/cpu/Makefile</span>
<span class="p_chunk">@@ -64,7 +64,7 @@</span> <span class="p_context"> ifdef CONFIG_X86_FEATURE_NAMES</span>
 quiet_cmd_mkcapflags = MKCAP   $@
       cmd_mkcapflags = $(CONFIG_SHELL) $(srctree)/$(src)/mkcapflags.sh $&lt; $@
 
<span class="p_del">-cpufeature = $(src)/../../include/asm/cpufeature.h</span>
<span class="p_add">+cpufeature = $(src)/../../include/asm/cpufeatures.h</span>
 
 targets += capflags.c
 $(obj)/capflags.c: $(cpufeature) $(src)/mkcapflags.sh FORCE
<span class="p_header">diff --git a/arch/x86/kernel/cpu/centaur.c b/arch/x86/kernel/cpu/centaur.c</span>
<span class="p_header">index ae20be6..6608c03 100644</span>
<span class="p_header">--- a/arch/x86/kernel/cpu/centaur.c</span>
<span class="p_header">+++ b/arch/x86/kernel/cpu/centaur.c</span>
<span class="p_chunk">@@ -1,7 +1,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/bitops.h&gt;
 #include &lt;linux/kernel.h&gt;
 
<span class="p_del">-#include &lt;asm/processor.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 #include &lt;asm/e820.h&gt;
 #include &lt;asm/mtrr.h&gt;
 #include &lt;asm/msr.h&gt;
<span class="p_header">diff --git a/arch/x86/kernel/cpu/cyrix.c b/arch/x86/kernel/cpu/cyrix.c</span>
<span class="p_header">index aaf152e..15e47c1 100644</span>
<span class="p_header">--- a/arch/x86/kernel/cpu/cyrix.c</span>
<span class="p_header">+++ b/arch/x86/kernel/cpu/cyrix.c</span>
<span class="p_chunk">@@ -8,6 +8,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/timer.h&gt;
 #include &lt;asm/pci-direct.h&gt;
 #include &lt;asm/tsc.h&gt;
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 
 #include &quot;cpu.h&quot;
 
<span class="p_header">diff --git a/arch/x86/kernel/cpu/intel.c b/arch/x86/kernel/cpu/intel.c</span>
<span class="p_header">index 565648b..9299e3b 100644</span>
<span class="p_header">--- a/arch/x86/kernel/cpu/intel.c</span>
<span class="p_header">+++ b/arch/x86/kernel/cpu/intel.c</span>
<span class="p_chunk">@@ -8,7 +8,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/module.h&gt;
 #include &lt;linux/uaccess.h&gt;
 
<span class="p_del">-#include &lt;asm/processor.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 #include &lt;asm/pgtable.h&gt;
 #include &lt;asm/msr.h&gt;
 #include &lt;asm/bugs.h&gt;
<span class="p_header">diff --git a/arch/x86/kernel/cpu/intel_cacheinfo.c b/arch/x86/kernel/cpu/intel_cacheinfo.c</span>
<span class="p_header">index 0b6c523..341449c 100644</span>
<span class="p_header">--- a/arch/x86/kernel/cpu/intel_cacheinfo.c</span>
<span class="p_header">+++ b/arch/x86/kernel/cpu/intel_cacheinfo.c</span>
<span class="p_chunk">@@ -14,7 +14,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/sysfs.h&gt;
 #include &lt;linux/pci.h&gt;
 
<span class="p_del">-#include &lt;asm/processor.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 #include &lt;asm/amd_nb.h&gt;
 #include &lt;asm/smp.h&gt;
 
<span class="p_header">diff --git a/arch/x86/kernel/cpu/match.c b/arch/x86/kernel/cpu/match.c</span>
<span class="p_header">index afa9f0d..fbb5e90 100644</span>
<span class="p_header">--- a/arch/x86/kernel/cpu/match.c</span>
<span class="p_header">+++ b/arch/x86/kernel/cpu/match.c</span>
<span class="p_chunk">@@ -1,5 +1,5 @@</span> <span class="p_context"></span>
 #include &lt;asm/cpu_device_id.h&gt;
<span class="p_del">-#include &lt;asm/processor.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 #include &lt;linux/cpu.h&gt;
 #include &lt;linux/module.h&gt;
 #include &lt;linux/slab.h&gt;
<span class="p_header">diff --git a/arch/x86/kernel/cpu/mkcapflags.sh b/arch/x86/kernel/cpu/mkcapflags.sh</span>
<span class="p_header">index 3f20710..6988c74 100644</span>
<span class="p_header">--- a/arch/x86/kernel/cpu/mkcapflags.sh</span>
<span class="p_header">+++ b/arch/x86/kernel/cpu/mkcapflags.sh</span>
<span class="p_chunk">@@ -1,6 +1,6 @@</span> <span class="p_context"></span>
 #!/bin/sh
 #
<span class="p_del">-# Generate the x86_cap/bug_flags[] arrays from include/asm/cpufeature.h</span>
<span class="p_add">+# Generate the x86_cap/bug_flags[] arrays from include/asm/cpufeatures.h</span>
 #
 
 IN=$1
<span class="p_chunk">@@ -49,8 +49,8 @@</span> <span class="p_context"> dump_array()</span>
 trap &#39;rm &quot;$OUT&quot;&#39; EXIT
 
 (
<span class="p_del">-	echo &quot;#ifndef _ASM_X86_CPUFEATURE_H&quot;</span>
<span class="p_del">-	echo &quot;#include &lt;asm/cpufeature.h&gt;&quot;</span>
<span class="p_add">+	echo &quot;#ifndef _ASM_X86_CPUFEATURES_H&quot;</span>
<span class="p_add">+	echo &quot;#include &lt;asm/cpufeatures.h&gt;&quot;</span>
 	echo &quot;#endif&quot;
 	echo &quot;&quot;
 
<span class="p_header">diff --git a/arch/x86/kernel/cpu/mtrr/main.c b/arch/x86/kernel/cpu/mtrr/main.c</span>
<span class="p_header">index 5c3d149..74f1d90 100644</span>
<span class="p_header">--- a/arch/x86/kernel/cpu/mtrr/main.c</span>
<span class="p_header">+++ b/arch/x86/kernel/cpu/mtrr/main.c</span>
<span class="p_chunk">@@ -47,7 +47,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/smp.h&gt;
 #include &lt;linux/syscore_ops.h&gt;
 
<span class="p_del">-#include &lt;asm/processor.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 #include &lt;asm/e820.h&gt;
 #include &lt;asm/mtrr.h&gt;
 #include &lt;asm/msr.h&gt;
<span class="p_header">diff --git a/arch/x86/kernel/cpu/transmeta.c b/arch/x86/kernel/cpu/transmeta.c</span>
<span class="p_header">index 252da7a..a19a663 100644</span>
<span class="p_header">--- a/arch/x86/kernel/cpu/transmeta.c</span>
<span class="p_header">+++ b/arch/x86/kernel/cpu/transmeta.c</span>
<span class="p_chunk">@@ -1,6 +1,6 @@</span> <span class="p_context"></span>
 #include &lt;linux/kernel.h&gt;
 #include &lt;linux/mm.h&gt;
<span class="p_del">-#include &lt;asm/processor.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 #include &lt;asm/msr.h&gt;
 #include &quot;cpu.h&quot;
 
<span class="p_header">diff --git a/arch/x86/kernel/e820.c b/arch/x86/kernel/e820.c</span>
<span class="p_header">index 569c1e4..b3c2a69 100644</span>
<span class="p_header">--- a/arch/x86/kernel/e820.c</span>
<span class="p_header">+++ b/arch/x86/kernel/e820.c</span>
<span class="p_chunk">@@ -24,6 +24,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/e820.h&gt;
 #include &lt;asm/proto.h&gt;
 #include &lt;asm/setup.h&gt;
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 
 /*
  * The e820 map is the map that gets modified e.g. with command line parameters
<span class="p_header">diff --git a/arch/x86/kernel/head_32.S b/arch/x86/kernel/head_32.S</span>
<span class="p_header">index 6bc9ae2..af11129 100644</span>
<span class="p_header">--- a/arch/x86/kernel/head_32.S</span>
<span class="p_header">+++ b/arch/x86/kernel/head_32.S</span>
<span class="p_chunk">@@ -19,7 +19,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/setup.h&gt;
 #include &lt;asm/processor-flags.h&gt;
 #include &lt;asm/msr-index.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/percpu.h&gt;
 #include &lt;asm/nops.h&gt;
 #include &lt;asm/bootparam.h&gt;
<span class="p_header">diff --git a/arch/x86/kernel/hpet.c b/arch/x86/kernel/hpet.c</span>
<span class="p_header">index b8e6ff5..be0ebbb 100644</span>
<span class="p_header">--- a/arch/x86/kernel/hpet.c</span>
<span class="p_header">+++ b/arch/x86/kernel/hpet.c</span>
<span class="p_chunk">@@ -12,6 +12,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/pm.h&gt;
 #include &lt;linux/io.h&gt;
 
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 #include &lt;asm/irqdomain.h&gt;
 #include &lt;asm/fixmap.h&gt;
 #include &lt;asm/hpet.h&gt;
<span class="p_header">diff --git a/arch/x86/kernel/msr.c b/arch/x86/kernel/msr.c</span>
<span class="p_header">index 64f9616..7f3550a 100644</span>
<span class="p_header">--- a/arch/x86/kernel/msr.c</span>
<span class="p_header">+++ b/arch/x86/kernel/msr.c</span>
<span class="p_chunk">@@ -40,7 +40,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/uaccess.h&gt;
 #include &lt;linux/gfp.h&gt;
 
<span class="p_del">-#include &lt;asm/processor.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 #include &lt;asm/msr.h&gt;
 
 static struct class *msr_class;
<span class="p_header">diff --git a/arch/x86/kernel/verify_cpu.S b/arch/x86/kernel/verify_cpu.S</span>
<span class="p_header">index 07efb35..014ea59 100644</span>
<span class="p_header">--- a/arch/x86/kernel/verify_cpu.S</span>
<span class="p_header">+++ b/arch/x86/kernel/verify_cpu.S</span>
<span class="p_chunk">@@ -30,7 +30,7 @@</span> <span class="p_context"></span>
  * 	appropriately. Either display a message or halt.
  */
 
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/msr-index.h&gt;
 
 verify_cpu:
<span class="p_header">diff --git a/arch/x86/lib/clear_page_64.S b/arch/x86/lib/clear_page_64.S</span>
<span class="p_header">index a2fe51b..65be7cf 100644</span>
<span class="p_header">--- a/arch/x86/lib/clear_page_64.S</span>
<span class="p_header">+++ b/arch/x86/lib/clear_page_64.S</span>
<span class="p_chunk">@@ -1,5 +1,5 @@</span> <span class="p_context"></span>
 #include &lt;linux/linkage.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/alternative-asm.h&gt;
 
 /*
<span class="p_header">diff --git a/arch/x86/lib/copy_page_64.S b/arch/x86/lib/copy_page_64.S</span>
<span class="p_header">index 009f982..24ef1c2 100644</span>
<span class="p_header">--- a/arch/x86/lib/copy_page_64.S</span>
<span class="p_header">+++ b/arch/x86/lib/copy_page_64.S</span>
<span class="p_chunk">@@ -1,7 +1,7 @@</span> <span class="p_context"></span>
 /* Written 2003 by Andi Kleen, based on a kernel by Evandro Menezes */
 
 #include &lt;linux/linkage.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/alternative-asm.h&gt;
 
 /*
<span class="p_header">diff --git a/arch/x86/lib/copy_user_64.S b/arch/x86/lib/copy_user_64.S</span>
<span class="p_header">index 982ce34..fba3430 100644</span>
<span class="p_header">--- a/arch/x86/lib/copy_user_64.S</span>
<span class="p_header">+++ b/arch/x86/lib/copy_user_64.S</span>
<span class="p_chunk">@@ -10,7 +10,7 @@</span> <span class="p_context"></span>
 #include &lt;asm/current.h&gt;
 #include &lt;asm/asm-offsets.h&gt;
 #include &lt;asm/thread_info.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/alternative-asm.h&gt;
 #include &lt;asm/asm.h&gt;
 #include &lt;asm/smap.h&gt;
<span class="p_header">diff --git a/arch/x86/lib/memcpy_64.S b/arch/x86/lib/memcpy_64.S</span>
<span class="p_header">index 16698bb..a0de849 100644</span>
<span class="p_header">--- a/arch/x86/lib/memcpy_64.S</span>
<span class="p_header">+++ b/arch/x86/lib/memcpy_64.S</span>
<span class="p_chunk">@@ -1,7 +1,7 @@</span> <span class="p_context"></span>
 /* Copyright 2002 Andi Kleen */
 
 #include &lt;linux/linkage.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/alternative-asm.h&gt;
 
 /*
<span class="p_header">diff --git a/arch/x86/lib/memmove_64.S b/arch/x86/lib/memmove_64.S</span>
<span class="p_header">index ca2afdd..90ce01b 100644</span>
<span class="p_header">--- a/arch/x86/lib/memmove_64.S</span>
<span class="p_header">+++ b/arch/x86/lib/memmove_64.S</span>
<span class="p_chunk">@@ -6,7 +6,7 @@</span> <span class="p_context"></span>
  *	- Copyright 2011 Fenghua Yu &lt;fenghua.yu@intel.com&gt;
  */
 #include &lt;linux/linkage.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/alternative-asm.h&gt;
 
 #undef memmove
<span class="p_header">diff --git a/arch/x86/lib/memset_64.S b/arch/x86/lib/memset_64.S</span>
<span class="p_header">index 2661fad..c9c8122 100644</span>
<span class="p_header">--- a/arch/x86/lib/memset_64.S</span>
<span class="p_header">+++ b/arch/x86/lib/memset_64.S</span>
<span class="p_chunk">@@ -1,7 +1,7 @@</span> <span class="p_context"></span>
 /* Copyright 2002 Andi Kleen, SuSE Labs */
 
 #include &lt;linux/linkage.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/alternative-asm.h&gt;
 
 .weak memset
<span class="p_header">diff --git a/arch/x86/mm/setup_nx.c b/arch/x86/mm/setup_nx.c</span>
<span class="p_header">index 92e2eac..f65a33f 100644</span>
<span class="p_header">--- a/arch/x86/mm/setup_nx.c</span>
<span class="p_header">+++ b/arch/x86/mm/setup_nx.c</span>
<span class="p_chunk">@@ -4,6 +4,7 @@</span> <span class="p_context"></span>
 
 #include &lt;asm/pgtable.h&gt;
 #include &lt;asm/proto.h&gt;
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;</span>
 
 static int disable_nx;
 
<span class="p_header">diff --git a/arch/x86/oprofile/op_model_amd.c b/arch/x86/oprofile/op_model_amd.c</span>
<span class="p_header">index 50d86c0..660a83c 100644</span>
<span class="p_header">--- a/arch/x86/oprofile/op_model_amd.c</span>
<span class="p_header">+++ b/arch/x86/oprofile/op_model_amd.c</span>
<span class="p_chunk">@@ -24,7 +24,6 @@</span> <span class="p_context"></span>
 #include &lt;asm/nmi.h&gt;
 #include &lt;asm/apic.h&gt;
 #include &lt;asm/processor.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
 
 #include &quot;op_x86_model.h&quot;
 #include &quot;op_counter.h&quot;
<span class="p_header">diff --git a/arch/x86/um/asm/barrier.h b/arch/x86/um/asm/barrier.h</span>
<span class="p_header">index 174781a..00c3190 100644</span>
<span class="p_header">--- a/arch/x86/um/asm/barrier.h</span>
<span class="p_header">+++ b/arch/x86/um/asm/barrier.h</span>
<span class="p_chunk">@@ -3,7 +3,7 @@</span> <span class="p_context"></span>
 
 #include &lt;asm/asm.h&gt;
 #include &lt;asm/segment.h&gt;
<span class="p_del">-#include &lt;asm/cpufeature.h&gt;</span>
<span class="p_add">+#include &lt;asm/cpufeatures.h&gt;</span>
 #include &lt;asm/cmpxchg.h&gt;
 #include &lt;asm/nops.h&gt;
 
<span class="p_header">diff --git a/lib/atomic64_test.c b/lib/atomic64_test.c</span>
<span class="p_header">index d62de8b..1234818 100644</span>
<span class="p_header">--- a/lib/atomic64_test.c</span>
<span class="p_header">+++ b/lib/atomic64_test.c</span>
<span class="p_chunk">@@ -17,7 +17,7 @@</span> <span class="p_context"></span>
 #include &lt;linux/atomic.h&gt;
 
 #ifdef CONFIG_X86
<span class="p_del">-#include &lt;asm/processor.h&gt;	/* for boot_cpu_has below */</span>
<span class="p_add">+#include &lt;asm/cpufeature.h&gt;	/* for boot_cpu_has below */</span>
 #endif
 
 #define TEST(bit, op, c_op, val)				\

</pre>
</div>




  </div>
  <div id="footer">
   <a href="http://jk.ozlabs.org/projects/patchwork/">patchwork</a>
   patch tracking system
  </div>
 </body>
</html>



