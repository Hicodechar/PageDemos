
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <title>[GIT,PULL] s390 patches for 4.8 merge window - Patchwork</title>
  <link rel="stylesheet" type="text/css" href="/static/css/style.css"/>
  <script type="text/javascript" src="/static/js/common.js"></script>
  <script type="text/javascript" src="/static/js/jquery-1.10.1.min.js"></script>

 </head>
 <body>
  <div id="title">
  <h1 style="float: left;">
     <a
      href="/">Patchwork</a>
    [GIT,PULL] s390 patches for 4.8 merge window</h1>
  <div id="auth">

     <a href="/user/login/">login</a>
     <br/>
     <a href="/register/">register</a>
     <br/>
     <a href="/mail/">mail settings</a>

   </div>
   <div style="clear: both;"></div>
  </div>
  <div id="nav">
   <div id="navleft">
   
    <strong>Project</strong>: LKML
     :
     <a href="/project/LKML/list/"
      >patches</a>
     :
     <a href="/project/LKML/"
      >project info</a>
    
     :
     <a href="/"
     >other projects</a>
     
    
   </div>
   <div id="navright">
    <a href="/help/about/">about</a>
   </div>
   <div style="clear: both"></div>
  </div>

  <div id="content">

<script language="JavaScript" type="text/javascript">
function toggle_headers(link_id, headers_id)
{
    var link = document.getElementById(link_id)
    var headers = document.getElementById(headers_id)

    var hidden = headers.style['display'] == 'none';

    if (hidden) {
        link.innerHTML = 'hide';
        headers.style['display'] = 'block';
    } else {
        link.innerHTML = 'show';
        headers.style['display'] = 'none';
    }

}
</script>

<table class="patchmeta">
 <tr>
  <th>Submitter</th>
  <td><a href="/project/LKML/list/?submitter=93">Martin Schwidefsky</a></td>
 </tr>
 <tr>
  <th>Date</th>
  <td>July 25, 2016, 4:22 p.m.</td>
 </tr>
 <tr>
  <th>Message ID</th>
  <td>&lt;20160725182248.7b858b73@mschwide&gt;</td>
 </tr>
 <tr>
  <th>Download</th>
  <td>
   <a href="/patch/9246035/mbox/"
   >mbox</a>
|
   <a href="/patch/9246035/raw/"
   >patch</a>

   </td>
 </tr>
 <tr>
  <th>Permalink</th>
  <td><a href="/patch/9246035/">/patch/9246035/</a>
 </tr>
  <tr>
   <th>State</th>
   <td>New</td>
  </tr>


 <tr>
  <th>Headers</th>
  <td><a id="togglepatchheaders"
   href="javascript:toggle_headers('togglepatchheaders', 'patchheaders')"
   >show</a>
   <div id="patchheaders" class="patchheaders" style="display:none;">
    <pre>Return-Path: &lt;linux-kernel-owner@kernel.org&gt;
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
	[172.30.200.125])
	by pdx-korg-patchwork.web.codeaurora.org (Postfix) with ESMTP id
	8467C6077C for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Mon, 25 Jul 2016 16:23:05 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 7137625819
	for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Mon, 25 Jul 2016 16:23:05 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id 637C22705B; Mon, 25 Jul 2016 16:23:05 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-6.9 required=2.0 tests=BAYES_00,RCVD_IN_DNSWL_HI
	autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 0B90425819
	for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Mon, 25 Jul 2016 16:23:04 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1753408AbcGYQXA (ORCPT
	&lt;rfc822;patchwork-LKML@patchwork.kernel.org&gt;);
	Mon, 25 Jul 2016 12:23:00 -0400
Received: from mx0a-001b2d01.pphosted.com ([148.163.156.1]:53727 &quot;EHLO
	mx0a-001b2d01.pphosted.com&quot; rhost-flags-OK-OK-OK-OK)
	by vger.kernel.org with ESMTP id S1752917AbcGYQW5 (ORCPT
	&lt;rfc822;linux-kernel@vger.kernel.org&gt;);
	Mon, 25 Jul 2016 12:22:57 -0400
Received: from pps.filterd (m0098396.ppops.net [127.0.0.1])
	by mx0a-001b2d01.pphosted.com (8.16.0.11/8.16.0.11) with SMTP id
	u6PGJ2DN121293
	for &lt;linux-kernel@vger.kernel.org&gt;; Mon, 25 Jul 2016 12:22:56 -0400
Received: from e06smtp11.uk.ibm.com (e06smtp11.uk.ibm.com [195.75.94.107])
	by mx0a-001b2d01.pphosted.com with ESMTP id 24c2wfdur1-1
	(version=TLSv1.2 cipher=AES256-SHA bits=256 verify=NOT)
	for &lt;linux-kernel@vger.kernel.org&gt;; Mon, 25 Jul 2016 12:22:56 -0400
Received: from localhost
	by e06smtp11.uk.ibm.com with IBM ESMTP SMTP Gateway: Authorized Use
	Only! Violators will be prosecuted
	for &lt;linux-kernel@vger.kernel.org&gt; from &lt;schwidefsky@de.ibm.com&gt;;
	Mon, 25 Jul 2016 17:22:53 +0100
Received: from d06dlp02.portsmouth.uk.ibm.com (9.149.20.14)
	by e06smtp11.uk.ibm.com (192.168.101.141) with IBM ESMTP SMTP
	Gateway: Authorized Use Only! Violators will be prosecuted; 
	Mon, 25 Jul 2016 17:22:50 +0100
X-IBM-Helo: d06dlp02.portsmouth.uk.ibm.com
X-IBM-MailFrom: schwidefsky@de.ibm.com
X-IBM-RcptTo: linux-kernel@vger.kernel.org;linux-s390@vger.kernel.org
Received: from b06cxnps4076.portsmouth.uk.ibm.com
	(d06relay13.portsmouth.uk.ibm.com [9.149.109.198])
	by d06dlp02.portsmouth.uk.ibm.com (Postfix) with ESMTP id
	BF4392190023; Mon, 25 Jul 2016 17:22:16 +0100 (BST)
Received: from d06av09.portsmouth.uk.ibm.com (d06av09.portsmouth.uk.ibm.com
	[9.149.37.250])
	by b06cxnps4076.portsmouth.uk.ibm.com (8.14.9/8.14.9/NCO v10.0) with
	ESMTP id u6PGMn1o56623104; Mon, 25 Jul 2016 16:22:49 GMT
Received: from d06av09.portsmouth.uk.ibm.com (localhost [127.0.0.1])
	by d06av09.portsmouth.uk.ibm.com (8.14.4/8.14.4/NCO v10.0 AVout) with
	ESMTP id u6PGMnOf020868; Mon, 25 Jul 2016 10:22:49 -0600
Received: from mschwide (dyn-9-152-212-192.boeblingen.de.ibm.com
	[9.152.212.192])
	by d06av09.portsmouth.uk.ibm.com (8.14.4/8.14.4/NCO v10.0 AVin) with
	ESMTP id u6PGMnlO020860; Mon, 25 Jul 2016 10:22:49 -0600
Date: Mon, 25 Jul 2016 18:22:48 +0200
From: Martin Schwidefsky &lt;schwidefsky@de.ibm.com&gt;
To: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Cc: linux-kernel &lt;linux-kernel@vger.kernel.org&gt;,
	linux-s390 &lt;linux-s390@vger.kernel.org&gt;,
	Heiko Carstens &lt;heiko.carstens@de.ibm.com&gt;
Subject: [GIT PULL] s390 patches for 4.8 merge window
X-Mailer: Claws Mail 3.9.3 (GTK+ 2.24.23; x86_64-pc-linux-gnu)
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-TM-AS-MML: disable
X-Content-Scanned: Fidelis XPS MAILER
x-cbid: 16072516-0040-0000-0000-000002B4100E
X-IBM-AV-DETECTION: SAVI=unused REMOTE=unused XFE=unused
x-cbparentid: 16072516-0041-0000-0000-00001C5C380A
Message-Id: &lt;20160725182248.7b858b73@mschwide&gt;
X-Proofpoint-Virus-Version: vendor=fsecure engine=2.50.10432:, ,
	definitions=2016-07-25_12:, , signatures=0
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
	spamscore=0 suspectscore=2
	malwarescore=0 phishscore=0 adultscore=0 bulkscore=0 classifier=spam
	adjust=0 reason=mlx scancount=1 engine=8.0.1-1604210000
	definitions=main-1607250190
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: &lt;linux-kernel.vger.kernel.org&gt;
X-Mailing-List: linux-kernel@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP
</pre>
   </div>
  </td>
 </tr>
</table>

<div class="patchforms">





 <div style="clear: both;">
 </div>
</div>



<h2>Comments</h2>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=93">Martin Schwidefsky</a> - July 25, 2016, 4:22 p.m.</div>
<pre class="content">
Hi Linus,

please pull from the &#39;for-linus&#39; branch of

	git://git.kernel.org/pub/scm/linux/kernel/git/s390/linux.git for-linus

to receive the following updates:

There are a couple of new things for s390 with this merge request:

 * A new scheduling domain &quot;drawer&quot; is added to reflect the unusual
   topology found on z13 machines. Performance tests showed up to
   8 percent gain with the additional domain.
 * The new crc-32 checksum crypto module uses the vector-galois-field
   multiply and sum SIMD instruction to speed up crc-32 and crc-32c.
 * Proper __ro_after_init support, this requires RO_AFTER_INIT_DATA
   in the generic vmlinux.lds linker script definitions.
 * Kcov instrumentation support. A prerequisite for that is the
   inline assembly basic block cleanup, which is the reason for the 
   net/iucv/iucv.c change.
 * Support for 2GB pages is added to the hugetlbfs backend.

Then there are two removals:

 * The oprofile hardware sampling support is dead code and is removed.
   The oprofile user space uses the perf interface nowadays.
 * The ETR clock synchronization is removed, this has been superseeded
   be the STP clock synchronization. And it always has been &quot;interesting&quot;
   code..

And the usual bug fixes and cleanups.

The shortlog:

Bhaktipriya Shridhar (1):
      s390/cio/chp : Remove deprecated create_singlethread_workqueue

Christian Borntraeger (1):
      s390: dump_stack: fill in arch description

Dan Carpenter (1):
      s390/smp: clean up a condition

Daniel van Gerpen (1):
      s390: use canonical include guard style

David Hildenbrand (1):
      s390/mm: fix gmap tlb flush issues

Gerald Schaefer (1):
      s390/mm: add support for 2GB hugepages

Heiko Carstens (49):
      s390/pgtable: introduce and use generic csp inline asm
      s390/vmem: align segment and region tables to 16k
      s390/vmem: introduce and use SEGMENT_KERNEL and REGION3_KERNEL
      s390/pgtable: get rid of _REGION3_ENTRY_RO
      s390/vmem: make use of pte_clear()
      s390/mm: always use PAGE_KERNEL when mapping pages
      s390/pgtable: make pmd and pud helper functions available
      s390/pageattr: allow kernel page table splitting
      s390/vmem: simplify vmem code for read-only mappings
      s390/pgtable: add mapping statistics
      s390/cpuinfo: print cache info and all single cpu lines on first iteration
      s390/cpuinfo: show dynamic and static cpu mhz
      s390/mm: align swapper_pg_dir to 16k
      s390/kexec: fix update of os_info crash kernel size
      s390/kexec: fix crash on resize of reserved memory
      vmlinux.lds.h: allow arch specific handling of ro_after_init data section
      s390: add proper __ro_after_init support
      s390: use __section macro everywhere
      s390/uaccess: fix whitespace damage
      s390/uaccess: use __builtin_expect for get_user/put_user
      s390: avoid extable collisions
      s390/ipl: use load normal for LPAR re-ipl
      s390/ipl: rename diagnose enums
      topology/sysfs: provide drawer id and siblings attributes
      s390/topology: add drawer scheduling domain level
      s390/topology: remove z10 special handling
      s390/mm: fix compile for PAGE_DEFAULT_KEY != 0
      s390: calculate loops_per_jiffies with fp instructions
      s390: remove math emulation code
      s390/oprofile: remove hardware sampler support
      s390/perf: remove perf_release/reserver_sampling functions
      s390/cpuinfo: rename cpu field to cpu number
      s390/uaccess: fix __put_get_user_asm define
      s390/lib: use basic blocks for inline assemblies
      s390/mm: use basic block for essa inline assembly
      s390/crypto: use basic blocks for ap bus inline assemblies
      s390/iucv: use basic blocks for iucv inline assemblies
      s390/pci: use basic blocks for pci inline assemblies
      s390/cio: use basic blocks for cmf inline assemblies
      s390/cio: use basic blocks for i/o inline assemblies
      s390/smp: use basic blocks for sigp inline assemblies
      s390/sysinfo: use basic block for stsi inline assembly
      s390/hypfs: use basic block for diag inline assembly
      s390/cpumf: use basic block for ecctr inline assembly
      s390: enable kcov support
      s390: remove pointless load within __switch_to
      s390: stack address vs thread_info
      s390/cpuinfo: show maximum thread id
      s390: have unique symbol for __switch_to address

Hendrik Brueckner (4):
      s390/vx: add support functions for in-kernel FPU use
      s390/crc32-vx: use vector instructions to optimize CRC-32 computation
      s390/crc32-vx: add crypto API module for optimized CRC-32 algorithms
      s390: Updated kernel config files

Jason Baron (1):
      s390: add explicit &lt;linux/stringify.h&gt; for jump label

Markus Elfring (1):
      s390/pci: Delete an unnecessary check before the function call &quot;pci_dev_put&quot;

Martin Schwidefsky (9):
      s390/time: STP sync clock correction
      s390/time: move PTFF definitions
      s390/time: LPAR offset handling
      s390/time: add leap seconds to initial system time
      s390/time: remove ETR support
      s390/mm: fix vunmap vs finish_arch_post_lock_switch
      bitmap: bitmap_equal memcmp optimization
      s390/mm: simplify the TLB flushing code
      s390/ptrace: clarify bits in the per_struct

Muhammad Falak R Wani (1):
      s390/keyboard: use memdup_user_nul()

Peter Oberparleiter (1):
      s390/console: Make preferred console handling more consistent

Sebastian Ott (9):
      s390: use SPARSE_IRQ
      s390/pci: ensure page aligned dma start address
      s390/pci: ensure to not cross a dma segment boundary
      s390/cio: allow to reset channel measurement block
      s390/cio/device_ops: fix kernel doc
      s390/chsc: fix ioctl CHSC_INFO_CU command
      s390/cio: make fmt1 channel path descriptor optional
      s390/chsc: sanitize fmt check for chp_desc determination
      s390/chsc: improve channel path descriptor determination

Thomas Richter (1):
      s390/Documentation: improve sort command for trace buffer

 Documentation/cputopology.txt           |   40 +-
 Documentation/kernel-parameters.txt     |    2 -
 Documentation/s390/s390dbf.txt          |    2 +-
 arch/s390/Kconfig                       |   16 +-
 arch/s390/boot/compressed/Makefile      |    2 +
 arch/s390/configs/default_defconfig     |    1 +
 arch/s390/configs/gcov_defconfig        |    1 +
 arch/s390/configs/performance_defconfig |    1 +
 arch/s390/crypto/Makefile               |    3 +
 arch/s390/crypto/crc32-vx.c             |  310 ++++++++
 arch/s390/crypto/crc32be-vx.S           |  207 ++++++
 arch/s390/crypto/crc32le-vx.S           |  268 +++++++
 arch/s390/defconfig                     |    4 +
 arch/s390/hypfs/hypfs_diag.c            |   14 +-
 arch/s390/hypfs/hypfs_vm.c              |    2 +-
 arch/s390/include/asm/cache.h           |    5 +-
 arch/s390/include/asm/cio.h             |    2 +-
 arch/s390/include/asm/cpu_mf.h          |   17 +-
 arch/s390/include/asm/diag.h            |    2 +-
 arch/s390/include/asm/etr.h             |  261 -------
 arch/s390/include/asm/fcx.h             |    2 +-
 arch/s390/include/asm/fpu/api.h         |   75 ++
 arch/s390/include/asm/fpu/types.h       |   10 +
 arch/s390/include/asm/hugetlb.h         |    5 +-
 arch/s390/include/asm/ipl.h             |   10 +-
 arch/s390/include/asm/irq.h             |    7 +-
 arch/s390/include/asm/jump_label.h      |    1 +
 arch/s390/include/asm/kprobes.h         |    4 +-
 arch/s390/include/asm/mathemu.h         |   28 -
 arch/s390/include/asm/mmu.h             |    2 +-
 arch/s390/include/asm/mmu_context.h     |   15 +-
 arch/s390/include/asm/page.h            |    8 +-
 arch/s390/include/asm/perf_event.h      |   12 -
 arch/s390/include/asm/pgtable.h         |  272 +++++--
 arch/s390/include/asm/processor.h       |   17 +-
 arch/s390/include/asm/sections.h        |    1 +
 arch/s390/include/asm/setup.h           |    4 +
 arch/s390/include/asm/sfp-machine.h     |  142 ----
 arch/s390/include/asm/sfp-util.h        |   67 --
 arch/s390/include/asm/sigp.h            |   17 +-
 arch/s390/include/asm/stp.h             |   51 ++
 arch/s390/include/asm/timex.h           |   66 +-
 arch/s390/include/asm/tlbflush.h        |   31 +-
 arch/s390/include/asm/topology.h        |    4 +
 arch/s390/include/asm/uaccess.h         |   65 +-
 arch/s390/include/uapi/asm/ptrace.h     |    6 +-
 arch/s390/kernel/Makefile               |    5 +-
 arch/s390/kernel/cache.c                |    7 +-
 arch/s390/kernel/dis.c                  |    1 -
 arch/s390/kernel/dumpstack.c            |   12 +-
 arch/s390/kernel/early.c                |   22 +
 arch/s390/kernel/entry.S                |   11 +-
 arch/s390/kernel/fpu.c                  |  249 +++++++
 arch/s390/kernel/ipl.c                  |   25 +-
 arch/s390/kernel/irq.c                  |    7 +-
 arch/s390/kernel/machine_kexec.c        |   55 +-
 arch/s390/kernel/nmi.c                  |   13 +-
 arch/s390/kernel/perf_cpum_sf.c         |    5 -
 arch/s390/kernel/perf_event.c           |   30 -
 arch/s390/kernel/processor.c            |  114 ++-
 arch/s390/kernel/setup.c                |   40 +-
 arch/s390/kernel/smp.c                  |   18 +-
 arch/s390/kernel/sysinfo.c              |   63 +-
 arch/s390/kernel/time.c                 | 1053 ++-------------------------
 arch/s390/kernel/topology.c             |   89 +--
 arch/s390/kernel/vdso32/Makefile        |    2 +
 arch/s390/kernel/vdso64/Makefile        |    2 +
 arch/s390/kernel/vmlinux.lds.S          |   21 +-
 arch/s390/kvm/kvm-s390.c                |    2 +-
 arch/s390/lib/string.c                  |   50 +-
 arch/s390/lib/uaccess.c                 |    6 +-
 arch/s390/mm/dump_pagetables.c          |    2 +-
 arch/s390/mm/fault.c                    |    2 +-
 arch/s390/mm/gmap.c                     |    7 +-
 arch/s390/mm/gup.c                      |   45 +-
 arch/s390/mm/hugetlbpage.c              |  129 +++-
 arch/s390/mm/init.c                     |   13 +-
 arch/s390/mm/page-states.c              |   13 +-
 arch/s390/mm/pageattr.c                 |  267 ++++++-
 arch/s390/mm/pgtable.c                  |   93 ++-
 arch/s390/mm/vmem.c                     |   73 +-
 arch/s390/numa/mode_emu.c               |   25 +-
 arch/s390/oprofile/Makefile             |    1 -
 arch/s390/oprofile/hwsampler.c          | 1178 -------------------------------
 arch/s390/oprofile/hwsampler.h          |   63 --
 arch/s390/oprofile/init.c               |  489 -------------
 arch/s390/oprofile/op_counter.h         |   21 -
 arch/s390/pci/pci_dma.c                 |    4 +-
 arch/s390/pci/pci_event.c               |    3 +-
 arch/s390/pci/pci_insn.c                |   12 +-
 drivers/base/topology.c                 |   13 +
 drivers/crypto/Kconfig                  |   13 +
 drivers/s390/block/dasd_eckd.c          |    4 +-
 drivers/s390/char/keyboard.c            |   15 +-
 drivers/s390/char/sclp_con.c            |    3 +-
 drivers/s390/char/sclp_config.c         |    2 +-
 drivers/s390/char/zcore.c               |    2 +-
 drivers/s390/cio/chp.c                  |   22 +-
 drivers/s390/cio/chp.h                  |    2 +-
 drivers/s390/cio/chsc.c                 |   25 +-
 drivers/s390/cio/chsc.h                 |    5 +-
 drivers/s390/cio/chsc_sch.c             |    2 +-
 drivers/s390/cio/cmf.c                  |   44 +-
 drivers/s390/cio/device_ops.c           |   22 +-
 drivers/s390/cio/idset.h                |    2 +-
 drivers/s390/cio/ioasm.c                |   91 ++-
 drivers/s390/crypto/ap_bus.c            |   77 +-
 include/asm-generic/vmlinux.lds.h       |   10 +-
 include/linux/bitmap.h                  |    4 +
 mm/hugetlb.c                            |    4 +-
 net/iucv/iucv.c                         |   36 +-
 111 files changed, 2861 insertions(+), 3961 deletions(-)
 create mode 100644 arch/s390/crypto/crc32-vx.c
 create mode 100644 arch/s390/crypto/crc32be-vx.S
 create mode 100644 arch/s390/crypto/crc32le-vx.S
 delete mode 100644 arch/s390/include/asm/etr.h
 delete mode 100644 arch/s390/include/asm/mathemu.h
 delete mode 100644 arch/s390/include/asm/sfp-machine.h
 delete mode 100644 arch/s390/include/asm/sfp-util.h
 create mode 100644 arch/s390/include/asm/stp.h
 create mode 100644 arch/s390/kernel/fpu.c
 delete mode 100644 arch/s390/oprofile/hwsampler.c
 delete mode 100644 arch/s390/oprofile/hwsampler.h
 delete mode 100644 arch/s390/oprofile/op_counter.h


There are a couple of merge conflicts between the s390 tree and
the kvm tree. If the kvm tree is pulled first this patch will
resolve the fallout:
</pre>
</div>



<h2>Patch</h2>
<div class="patch">
<pre class="content">
<span class="p_header">diff --git a/arch/s390/hypfs/hypfs_diag.c b/arch/s390/hypfs/hypfs_diag.c</span>
<span class="p_header">index cc1e16a..28f03ca 100644</span>
<span class="p_header">--- a/arch/s390/hypfs/hypfs_diag.c</span>
<span class="p_header">+++ b/arch/s390/hypfs/hypfs_diag.c</span>
<span class="p_chunk">@@ -210,33 +210,6 @@</span> <span class="p_context"> static inline __u64 phys_cpu__ctidx(enum diag204_format type, void *hdr)</span>
 }
 
 /* Diagnose 204 functions */
<span class="p_del">-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span>
<span class="p_del">-=======</span>
<span class="p_del">-</span>
<span class="p_del">-static inline int __diag204(unsigned long *subcode, unsigned long size, void *addr)</span>
<span class="p_del">-{</span>
<span class="p_del">-	register unsigned long _subcode asm(&quot;0&quot;) = *subcode;</span>
<span class="p_del">-	register unsigned long _size asm(&quot;1&quot;) = size;</span>
<span class="p_del">-</span>
<span class="p_del">-	asm volatile(</span>
<span class="p_del">-		&quot;	diag	%2,%0,0x204\n&quot;</span>
<span class="p_del">-		&quot;0:	nopr	%%r7\n&quot;</span>
<span class="p_del">-		EX_TABLE(0b,0b)</span>
<span class="p_del">-		: &quot;+d&quot; (_subcode), &quot;+d&quot; (_size) : &quot;d&quot; (addr) : &quot;memory&quot;);</span>
<span class="p_del">-	*subcode = _subcode;</span>
<span class="p_del">-	return _size;</span>
<span class="p_del">-}</span>
<span class="p_del">-</span>
<span class="p_del">-static int diag204(unsigned long subcode, unsigned long size, void *addr)</span>
<span class="p_del">-{</span>
<span class="p_del">-	diag_stat_inc(DIAG_STAT_X204);</span>
<span class="p_del">-	size = __diag204(&amp;subcode, size, addr);</span>
<span class="p_del">-	if (subcode)</span>
<span class="p_del">-		return -1;</span>
<span class="p_del">-	return size;</span>
<span class="p_del">-}</span>
<span class="p_del">-</span>
<span class="p_del">-&gt;&gt;&gt;&gt;&gt;&gt;&gt; 64a40c84001e55001a4d80496b6b56e4d04e4360</span>
 /*
  * For the old diag subcode 4 with simple data format we have to use real
  * memory. If we use subcode 6 or 7 with extended data format, we can (and
<span class="p_header">diff --git a/arch/s390/kernel/diag.c b/arch/s390/kernel/diag.c</span>
<span class="p_header">index a44faf4..a97354c 100644</span>
<span class="p_header">--- a/arch/s390/kernel/diag.c</span>
<span class="p_header">+++ b/arch/s390/kernel/diag.c</span>
<span class="p_chunk">@@ -162,25 +162,27 @@</span> <span class="p_context"> int diag14(unsigned long rx, unsigned long ry1, unsigned long subcode)</span>
 }
 EXPORT_SYMBOL(diag14);
 
<span class="p_del">-static inline int __diag204(unsigned long subcode, unsigned long size, void *addr)</span>
<span class="p_add">+static inline int __diag204(unsigned long *subcode, unsigned long size, void *addr)</span>
 {
<span class="p_del">-	register unsigned long _subcode asm(&quot;0&quot;) = subcode;</span>
<span class="p_add">+	register unsigned long _subcode asm(&quot;0&quot;) = *subcode;</span>
 	register unsigned long _size asm(&quot;1&quot;) = size;
 
 	asm volatile(
 		&quot;	diag	%2,%0,0x204\n&quot;
<span class="p_del">-		&quot;0:\n&quot;</span>
<span class="p_add">+		&quot;0:	nopr	%%r7\n&quot;</span>
 		EX_TABLE(0b,0b)
 		: &quot;+d&quot; (_subcode), &quot;+d&quot; (_size) : &quot;d&quot; (addr) : &quot;memory&quot;);
<span class="p_del">-	if (_subcode)</span>
<span class="p_del">-		return -1;</span>
<span class="p_add">+	*subcode = _subcode;</span>
 	return _size;
 }
 
 int diag204(unsigned long subcode, unsigned long size, void *addr)
 {
 	diag_stat_inc(DIAG_STAT_X204);
<span class="p_del">-	return __diag204(subcode, size, addr);</span>
<span class="p_add">+	size = __diag204(&amp;subcode, size, addr);</span>
<span class="p_add">+	if (subcode)</span>
<span class="p_add">+		return -1;</span>
<span class="p_add">+	return size;</span>
 }
 EXPORT_SYMBOL(diag204);
 
<span class="p_header">diff --git a/arch/s390/kvm/kvm-s390.c b/arch/s390/kvm/kvm-s390.c</span>
<span class="p_header">index 8911848..d0bf317 100644</span>
<span class="p_header">--- a/arch/s390/kvm/kvm-s390.c</span>
<span class="p_header">+++ b/arch/s390/kvm/kvm-s390.c</span>
<span class="p_chunk">@@ -38,7 +38,6 @@</span> <span class="p_context"></span>
 #include &lt;asm/isc.h&gt;
 #include &lt;asm/sclp.h&gt;
 #include &lt;asm/cpacf.h&gt;
<span class="p_del">-#include &lt;asm/etr.h&gt;</span>
 #include &quot;kvm-s390.h&quot;
 #include &quot;gaccess.h&quot;
 
<span class="p_chunk">@@ -243,7 +242,8 @@</span> <span class="p_context"> static void kvm_s390_cpu_feat_init(void)</span>
 	}
 
 	if (test_facility(28)) /* TOD-clock steering */
<span class="p_del">-		etr_ptff(kvm_s390_available_subfunc.ptff, ETR_PTFF_QAF);</span>
<span class="p_add">+		ptff(kvm_s390_available_subfunc.ptff,</span>
<span class="p_add">+		     sizeof(kvm_s390_available_subfunc.ptff), PTFF_QAF);</span>
 
 	if (test_facility(17)) { /* MSA */
 		__cpacf_query(CPACF_KMAC, kvm_s390_available_subfunc.kmac);
<span class="p_header">diff --git a/arch/s390/mm/gmap.c b/arch/s390/mm/gmap.c</span>
<span class="p_header">index 3d12272..2ce6bb3 100644</span>
<span class="p_header">--- a/arch/s390/mm/gmap.c</span>
<span class="p_header">+++ b/arch/s390/mm/gmap.c</span>
<span class="p_chunk">@@ -175,18 +175,9 @@</span> <span class="p_context"> static void gmap_free(struct gmap *gmap)</span>
 {
 	struct page *page, *next;
 
<span class="p_del">-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span>
 	/* Flush tlb of all gmaps (if not already done for shadows) */
 	if (!(gmap_is_shadow(gmap) &amp;&amp; gmap-&gt;removed))
 		gmap_flush_tlb(gmap);
<span class="p_del">-=======</span>
<span class="p_del">-	/* Flush tlb. */</span>
<span class="p_del">-	if (MACHINE_HAS_IDTE)</span>
<span class="p_del">-		__tlb_flush_idte(gmap-&gt;asce);</span>
<span class="p_del">-	else</span>
<span class="p_del">-		__tlb_flush_global();</span>
<span class="p_del">-</span>
<span class="p_del">-&gt;&gt;&gt;&gt;&gt;&gt;&gt; 64a40c84001e55001a4d80496b6b56e4d04e4360</span>
 	/* Free all segment &amp; region tables. */
 	list_for_each_entry_safe(page, next, &amp;gmap-&gt;crst_list, lru)
 		__free_pages(page, 2);

</pre>
</div>




  </div>
  <div id="footer">
   <a href="http://jk.ozlabs.org/projects/patchwork/">patchwork</a>
   patch tracking system
  </div>
 </body>
</html>



