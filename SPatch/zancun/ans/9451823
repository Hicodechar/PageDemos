
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <title>[v2,1/6] selftests: remove duplicated all and clean target - Patchwork</title>
  <link rel="stylesheet" type="text/css" href="/static/css/style.css"/>
  <script type="text/javascript" src="/static/js/common.js"></script>
  <script type="text/javascript" src="/static/js/jquery-1.10.1.min.js"></script>

 </head>
 <body>
  <div id="title">
  <h1 style="float: left;">
     <a
      href="/">Patchwork</a>
    [v2,1/6] selftests: remove duplicated all and clean target</h1>
  <div id="auth">

     <a href="/user/login/">login</a>
     <br/>
     <a href="/register/">register</a>
     <br/>
     <a href="/mail/">mail settings</a>

   </div>
   <div style="clear: both;"></div>
  </div>
  <div id="nav">
   <div id="navleft">
   
    <strong>Project</strong>: LKML
     :
     <a href="/project/LKML/list/"
      >patches</a>
     :
     <a href="/project/LKML/"
      >project info</a>
    
     :
     <a href="/"
     >other projects</a>
     
    
   </div>
   <div id="navright">
    <a href="/help/about/">about</a>
   </div>
   <div style="clear: both"></div>
  </div>

  <div id="content">

<script language="JavaScript" type="text/javascript">
function toggle_headers(link_id, headers_id)
{
    var link = document.getElementById(link_id)
    var headers = document.getElementById(headers_id)

    var hidden = headers.style['display'] == 'none';

    if (hidden) {
        link.innerHTML = 'hide';
        headers.style['display'] = 'block';
    } else {
        link.innerHTML = 'show';
        headers.style['display'] = 'none';
    }

}
</script>

<table class="patchmeta">
 <tr>
  <th>Submitter</th>
  <td><a href="/project/LKML/list/?submitter=109151">zhangjian</a></td>
 </tr>
 <tr>
  <th>Date</th>
  <td>Nov. 29, 2016, 11:55 a.m.</td>
 </tr>
 <tr>
  <th>Message ID</th>
  <td>&lt;20161129115552.8148-2-bamvor.zhangjian@huawei.com&gt;</td>
 </tr>
 <tr>
  <th>Download</th>
  <td>
   <a href="/patch/9451823/mbox/"
   >mbox</a>
|
   <a href="/patch/9451823/raw/"
   >patch</a>

   </td>
 </tr>
 <tr>
  <th>Permalink</th>
  <td><a href="/patch/9451823/">/patch/9451823/</a>
 </tr>
  <tr>
   <th>State</th>
   <td>New</td>
  </tr>


 <tr>
  <th>Headers</th>
  <td><a id="togglepatchheaders"
   href="javascript:toggle_headers('togglepatchheaders', 'patchheaders')"
   >show</a>
   <div id="patchheaders" class="patchheaders" style="display:none;">
    <pre>Return-Path: &lt;linux-kernel-owner@kernel.org&gt;
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
	[172.30.200.125])
	by pdx-korg-patchwork.web.codeaurora.org (Postfix) with ESMTP id
	A56B36071C for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Tue, 29 Nov 2016 11:56:04 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 93484281DB
	for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Tue, 29 Nov 2016 11:56:04 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id 8800E28249; Tue, 29 Nov 2016 11:56:04 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-6.9 required=2.0 tests=BAYES_00,RCVD_IN_DNSWL_HI
	autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id E68D028285
	for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Tue, 29 Nov 2016 11:56:02 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1757055AbcK2Lzs (ORCPT
	&lt;rfc822;patchwork-LKML@patchwork.kernel.org&gt;);
	Tue, 29 Nov 2016 06:55:48 -0500
Received: from szxga02-in.huawei.com ([119.145.14.65]:20326 &quot;EHLO
	szxga02-in.huawei.com&quot; rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1757375AbcK2LzE (ORCPT
	&lt;rfc822;linux-kernel@vger.kernel.org&gt;);
	Tue, 29 Nov 2016 06:55:04 -0500
Received: from 172.24.1.60 (EHLO szxeml427-hub.china.huawei.com)
	([172.24.1.60])
	by szxrg02-dlp.huawei.com (MOS 4.3.7-GA FastPath queued)
	with ESMTP id DRL51250; Tue, 29 Nov 2016 19:54:20 +0800 (CST)
Received: from linux696.huawei.com (10.110.60.54) by
	szxeml427-hub.china.huawei.com (10.82.67.182) with Microsoft SMTP
	Server id 14.3.235.1; Tue, 29 Nov 2016 19:53:59 +0800
From: &lt;bamvor.zhangjian@huawei.com&gt;
To: &lt;shuahkh@osg.samsung.com&gt;
CC: &lt;linux-api@vger.kernel.org&gt;, &lt;linux-kernel@vger.kernel.org&gt;,
	&lt;khilman@kernel.org&gt;, &lt;broonie@kernel.org&gt;, &lt;mpe@ellerman.id.au&gt;
Subject: [PATCH v2 1/6] selftests: remove duplicated all and clean target
Date: Tue, 29 Nov 2016 19:55:47 +0800
Message-ID: &lt;20161129115552.8148-2-bamvor.zhangjian@huawei.com&gt;
X-Mailer: git-send-email 2.10.0
In-Reply-To: &lt;20161129115552.8148-1-bamvor.zhangjian@huawei.com&gt;
References: &lt;20161129115552.8148-1-bamvor.zhangjian@huawei.com&gt;
MIME-Version: 1.0
Content-Type: text/plain
X-Originating-IP: [10.110.60.54]
X-CFilter-Loop: Reflected
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: &lt;linux-kernel.vger.kernel.org&gt;
X-Mailing-List: linux-kernel@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP
</pre>
   </div>
  </td>
 </tr>
</table>

<div class="patchforms">





 <div style="clear: both;">
 </div>
</div>



<h2>Comments</h2>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=109151">zhangjian</a> - Nov. 29, 2016, 11:55 a.m.</div>
<pre class="content">
<span class="from">From: Bamvor Jian Zhang &lt;bamvor.zhangjian@linaro.org&gt;</span>

Currently, kselftest use TEST_PROGS, TEST_PROGS_EXTENDED, TEST_FILES to
indicate the test program, extended test program and test files. It is
easy to understand the purpose of these files. But mix of compiled and
uncompiled files lead to duplicated &quot;all&quot; and &quot;clean&quot; targets.

In order to remove the duplicated targets, introduce TEST_GEN_PROGS,
TEST_GEN_PROGS_EXTENDED, TEST_GEN_FILES to indicate the compiled
objects.

Also, the later patch will make use of TEST_GEN_XXX to redirect these
files to output directory indicated by KBUILD_OUTPUT or O.

And add this changes to &quot;Contributing new tests(details)&quot; of
Documentation/kselftest.txt.
<span class="signed-off-by">
Signed-off-by: Bamvor Jian Zhang &lt;bamvor.zhangjian@linaro.org&gt;</span>
---
 Documentation/kselftest.txt                        | 12 +++++++++++
 tools/testing/selftests/bpf/Makefile               | 10 ++-------
 tools/testing/selftests/breakpoints/Makefile       | 10 +++------
 tools/testing/selftests/capabilities/Makefile      | 11 ++--------
 tools/testing/selftests/efivarfs/Makefile          |  8 +-------
 tools/testing/selftests/exec/Makefile              | 10 ++++-----
 tools/testing/selftests/futex/functional/Makefile  | 12 +++--------
 tools/testing/selftests/ipc/Makefile               |  7 +------
 tools/testing/selftests/kcmp/Makefile              |  6 ++----
 tools/testing/selftests/lib.mk                     | 18 ++++++++++++----
 tools/testing/selftests/membarrier/Makefile        |  6 +-----
 tools/testing/selftests/memfd/Makefile             | 14 +++----------
 tools/testing/selftests/mount/Makefile             |  6 ++----
 tools/testing/selftests/mqueue/Makefile            |  6 +-----
 tools/testing/selftests/net/Makefile               | 13 ++++--------
 tools/testing/selftests/nsfs/Makefile              |  9 +-------
 tools/testing/selftests/powerpc/alignment/Makefile |  9 ++------
 .../testing/selftests/powerpc/benchmarks/Makefile  | 11 +++-------
 .../selftests/powerpc/context_switch/Makefile      |  9 ++------
 tools/testing/selftests/powerpc/copyloops/Makefile | 11 +++-------
 tools/testing/selftests/powerpc/dscr/Makefile      | 13 ++++--------
 tools/testing/selftests/powerpc/math/Makefile      | 13 ++++--------
 tools/testing/selftests/powerpc/mm/Makefile        | 12 ++++-------
 tools/testing/selftests/powerpc/pmu/Makefile       | 12 +++++------
 tools/testing/selftests/powerpc/pmu/ebb/Makefile   | 11 +++-------
 .../testing/selftests/powerpc/primitives/Makefile  |  9 ++------
 .../testing/selftests/powerpc/stringloops/Makefile |  9 ++------
 .../selftests/powerpc/switch_endian/Makefile       |  8 +++-----
 tools/testing/selftests/powerpc/syscalls/Makefile  |  9 ++------
 tools/testing/selftests/powerpc/tm/Makefile        | 11 +++-------
 tools/testing/selftests/powerpc/vphn/Makefile      | 10 +++------
 tools/testing/selftests/ptrace/Makefile            |  8 +-------
 tools/testing/selftests/seccomp/Makefile           |  6 +-----
 tools/testing/selftests/sigaltstack/Makefile       |  5 +----
 tools/testing/selftests/size/Makefile              |  6 +-----
 tools/testing/selftests/timers/Makefile            |  9 ++------
 tools/testing/selftests/vm/Makefile                | 24 +++++++++-------------
 37 files changed, 118 insertions(+), 255 deletions(-)
</pre>
</div>



<h2>Patch</h2>
<div class="patch">
<pre class="content">
<span class="p_header">diff --git a/Documentation/kselftest.txt b/Documentation/kselftest.txt</span>
<span class="p_header">index e5c7254..d431dc8 100644</span>
<span class="p_header">--- a/Documentation/kselftest.txt</span>
<span class="p_header">+++ b/Documentation/kselftest.txt</span>
<span class="p_chunk">@@ -95,3 +95,15 @@</span> <span class="p_context"> In general, the rules for selftests are</span>
 
  * Don&#39;t cause the top-level &quot;make run_tests&quot; to fail if your feature is
    unconfigured.
<span class="p_add">+</span>
<span class="p_add">+Contributing new tests(details)</span>
<span class="p_add">+===============================</span>
<span class="p_add">+</span>
<span class="p_add">+ * Use TEST_GEN_XXX if such binaries or files are generated during</span>
<span class="p_add">+   compiling.</span>
<span class="p_add">+   TEST_PROGS, TEST_GEN_PROGS mean it is the excutable tested by</span>
<span class="p_add">+   default.</span>
<span class="p_add">+   TEST_PROGS_EXTENDED, TEST_GEN_PROGS_EXTENDED mean it is the</span>
<span class="p_add">+   executable which is not tested by default.</span>
<span class="p_add">+   TEST_FILES, TEST_GEN_FILES mean it is the file which is used by</span>
<span class="p_add">+   test.</span>
<span class="p_header">diff --git a/tools/testing/selftests/bpf/Makefile b/tools/testing/selftests/bpf/Makefile</span>
<span class="p_header">index 7a5f245..058351b 100644</span>
<span class="p_header">--- a/tools/testing/selftests/bpf/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/bpf/Makefile</span>
<span class="p_chunk">@@ -1,13 +1,7 @@</span> <span class="p_context"></span>
 CFLAGS += -Wall -O2 -I../../../../usr/include
 
<span class="p_del">-test_objs = test_verifier test_maps test_lru_map</span>
<span class="p_add">+TEST_GEN_PROGS = test_verifier test_maps test_lru_map</span>
 
<span class="p_del">-TEST_PROGS := test_verifier test_maps test_lru_map test_kmod.sh</span>
<span class="p_del">-TEST_FILES := $(test_objs)</span>
<span class="p_del">-</span>
<span class="p_del">-all: $(test_objs)</span>
<span class="p_add">+TEST_PROGS := test_kmod.sh</span>
 
 include ../lib.mk
<span class="p_del">-</span>
<span class="p_del">-clean:</span>
<span class="p_del">-	$(RM) $(test_objs)</span>
<span class="p_header">diff --git a/tools/testing/selftests/breakpoints/Makefile b/tools/testing/selftests/breakpoints/Makefile</span>
<span class="p_header">index 61b79e8..72aa103 100644</span>
<span class="p_header">--- a/tools/testing/selftests/breakpoints/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/breakpoints/Makefile</span>
<span class="p_chunk">@@ -3,17 +3,13 @@</span> <span class="p_context"> uname_M := $(shell uname -m 2&gt;/dev/null || echo not)</span>
 ARCH ?= $(shell echo $(uname_M) | sed -e s/i.86/x86/ -e s/x86_64/x86/)
 
 ifeq ($(ARCH),x86)
<span class="p_del">-TEST_PROGS := breakpoint_test</span>
<span class="p_add">+TEST_GEN_PROGS := breakpoint_test</span>
 endif
 ifeq ($(ARCH),aarch64)
<span class="p_del">-TEST_PROGS := breakpoint_test_arm64</span>
<span class="p_add">+TEST_GEN_PROGS := breakpoint_test_arm64</span>
 endif
 
<span class="p_del">-TEST_PROGS += step_after_suspend_test</span>
<span class="p_del">-</span>
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_add">+TEST_GEN_PROGS += step_after_suspend_test</span>
 
 include ../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -fr breakpoint_test breakpoint_test_arm64 step_after_suspend_test</span>
<span class="p_header">diff --git a/tools/testing/selftests/capabilities/Makefile b/tools/testing/selftests/capabilities/Makefile</span>
<span class="p_header">index 008602a..29b8adf 100644</span>
<span class="p_header">--- a/tools/testing/selftests/capabilities/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/capabilities/Makefile</span>
<span class="p_chunk">@@ -1,15 +1,8 @@</span> <span class="p_context"></span>
<span class="p_del">-TEST_FILES := validate_cap</span>
<span class="p_del">-TEST_PROGS := test_execve</span>
<span class="p_del">-</span>
<span class="p_del">-BINARIES := $(TEST_FILES) $(TEST_PROGS)</span>
<span class="p_add">+TEST_GEN_FILES := validate_cap</span>
<span class="p_add">+TEST_GEN_PROGS := test_execve</span>
 
 CFLAGS += -O2 -g -std=gnu99 -Wall
 LDLIBS += -lcap-ng -lrt -ldl
 
<span class="p_del">-all: $(BINARIES)</span>
<span class="p_del">-</span>
<span class="p_del">-clean:</span>
<span class="p_del">-	$(RM) $(BINARIES)</span>
<span class="p_del">-</span>
 include ../lib.mk
 
<span class="p_header">diff --git a/tools/testing/selftests/efivarfs/Makefile b/tools/testing/selftests/efivarfs/Makefile</span>
<span class="p_header">index 736c3dd..c49dcea 100644</span>
<span class="p_header">--- a/tools/testing/selftests/efivarfs/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/efivarfs/Makefile</span>
<span class="p_chunk">@@ -1,13 +1,7 @@</span> <span class="p_context"></span>
 CFLAGS = -Wall
 
<span class="p_del">-test_objs = open-unlink create-read</span>
<span class="p_del">-</span>
<span class="p_del">-all: $(test_objs)</span>
<span class="p_del">-</span>
<span class="p_add">+TEST_GEN_FILES := open-unlink create-read</span>
 TEST_PROGS := efivarfs.sh
<span class="p_del">-TEST_FILES := $(test_objs)</span>
 
 include ../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(test_objs)</span>
<span class="p_header">diff --git a/tools/testing/selftests/exec/Makefile b/tools/testing/selftests/exec/Makefile</span>
<span class="p_header">index d430060..b3bf091 100644</span>
<span class="p_header">--- a/tools/testing/selftests/exec/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/exec/Makefile</span>
<span class="p_chunk">@@ -1,7 +1,4 @@</span> <span class="p_context"></span>
 CFLAGS = -Wall
<span class="p_del">-BINARIES = execveat</span>
<span class="p_del">-DEPS = execveat.symlink execveat.denatured script subdir</span>
<span class="p_del">-all: $(BINARIES) $(DEPS)</span>
 
 subdir:
 	mkdir -p $@
<span class="p_chunk">@@ -17,11 +14,12 @@</span> <span class="p_context"> execveat.denatured: execveat</span>
 %: %.c
 	$(CC) $(CFLAGS) -o $@ $^
 
<span class="p_del">-TEST_PROGS := execveat</span>
<span class="p_add">+TEST_GEN_PROGS := execveat</span>
<span class="p_add">+TEST_GEN_FILES := execveat.symlink execveat.denatured script subdir</span>
 # Makefile is a run-time dependency, since it&#39;s accessed by the execveat test
<span class="p_del">-TEST_FILES := $(DEPS) Makefile</span>
<span class="p_add">+TEST_FILES := Makefile</span>
 
 include ../lib.mk
 
 clean:
<span class="p_del">-	rm -rf $(BINARIES) $(DEPS) subdir.moved execveat.moved xxxxx*</span>
<span class="p_add">+	rm -rf $(TEST_GEN_PROGS) $(TEST_GEN_FILES) subdir.moved execveat.moved xxxxx*</span>
<span class="p_header">diff --git a/tools/testing/selftests/futex/functional/Makefile b/tools/testing/selftests/futex/functional/Makefile</span>
<span class="p_header">index 9d6b75e..ac35782 100644</span>
<span class="p_header">--- a/tools/testing/selftests/futex/functional/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/futex/functional/Makefile</span>
<span class="p_chunk">@@ -3,7 +3,7 @@</span> <span class="p_context"> CFLAGS := $(CFLAGS) -g -O2 -Wall -D_GNU_SOURCE -pthread $(INCLUDES)</span>
 LDFLAGS := $(LDFLAGS) -pthread -lrt
 
 HEADERS := ../include/futextest.h
<span class="p_del">-TARGETS := \</span>
<span class="p_add">+TEST_GEN_FILES := \</span>
 	futex_wait_timeout \
 	futex_wait_wouldblock \
 	futex_requeue_pi \
<span class="p_chunk">@@ -12,14 +12,8 @@</span> <span class="p_context"> TARGETS := \</span>
 	futex_wait_uninitialized_heap \
 	futex_wait_private_mapped_file
 
<span class="p_del">-TEST_PROGS := $(TARGETS) run.sh</span>
<span class="p_del">-</span>
<span class="p_del">-.PHONY: all clean</span>
<span class="p_del">-all: $(TARGETS)</span>
<span class="p_del">-</span>
<span class="p_del">-$(TARGETS): $(HEADERS)</span>
<span class="p_add">+TEST_PROGS := run.sh</span>
 
 include ../../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(TARGETS)</span>
<span class="p_add">+$(TEST_GEN_FILES): $(HEADERS)</span>
<span class="p_header">diff --git a/tools/testing/selftests/ipc/Makefile b/tools/testing/selftests/ipc/Makefile</span>
<span class="p_header">index 25d2e70..30ef4c7 100644</span>
<span class="p_header">--- a/tools/testing/selftests/ipc/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/ipc/Makefile</span>
<span class="p_chunk">@@ -11,12 +11,7 @@</span> <span class="p_context"> endif</span>
 
 CFLAGS += -I../../../../usr/include/
 
<span class="p_del">-all:</span>
<span class="p_del">-	$(CC) $(CFLAGS) msgque.c -o msgque_test</span>
<span class="p_del">-</span>
<span class="p_del">-TEST_PROGS := msgque_test</span>
<span class="p_add">+TEST_GEN_PROGS := msgque</span>
 
 include ../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -fr ./msgque_test</span>
<span class="p_header">diff --git a/tools/testing/selftests/kcmp/Makefile b/tools/testing/selftests/kcmp/Makefile</span>
<span class="p_header">index 2ae7450..9e8b673 100644</span>
<span class="p_header">--- a/tools/testing/selftests/kcmp/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/kcmp/Makefile</span>
<span class="p_chunk">@@ -1,10 +1,8 @@</span> <span class="p_context"></span>
 CFLAGS += -I../../../../usr/include/
 
<span class="p_del">-all: kcmp_test</span>
<span class="p_del">-</span>
<span class="p_del">-TEST_PROGS := kcmp_test</span>
<span class="p_add">+TEST_GEN_PROGS := kcmp_test</span>
 
 include ../lib.mk
 
 clean:
<span class="p_del">-	$(RM) kcmp_test kcmp-test-file</span>
<span class="p_add">+	$(RM) $(TEST_GEN_PROGS) kcmp-test-file</span>
<span class="p_header">diff --git a/tools/testing/selftests/lib.mk b/tools/testing/selftests/lib.mk</span>
<span class="p_header">index 50a93f5..9fddffd 100644</span>
<span class="p_header">--- a/tools/testing/selftests/lib.mk</span>
<span class="p_header">+++ b/tools/testing/selftests/lib.mk</span>
<span class="p_chunk">@@ -3,7 +3,7 @@</span> <span class="p_context"></span>
 CC := $(CROSS_COMPILE)gcc
 
 define RUN_TESTS
<span class="p_del">-	@for TEST in $(TEST_PROGS); do \</span>
<span class="p_add">+	@for TEST in $(TEST_GEN_PROGS) $(TEST_PROGS); do \</span>
 		(./$$TEST &amp;&amp; echo &quot;selftests: $$TEST [PASS]&quot;) || echo &quot;selftests: $$TEST [FAIL]&quot;; \
 	done;
 endef
<span class="p_chunk">@@ -14,8 +14,13 @@</span> <span class="p_context"> run_tests: all</span>
 define INSTALL_RULE
 	@if [ &quot;X$(TEST_PROGS)$(TEST_PROGS_EXTENDED)$(TEST_FILES)&quot; != &quot;X&quot; ]; then					\
 		mkdir -p ${INSTALL_PATH};										\
<span class="p_del">-		echo &quot;rsync -a $(TEST_DIRS) $(TEST_PROGS) $(TEST_PROGS_EXTENDED) $(TEST_FILES) $(INSTALL_PATH)/&quot;;	\</span>
<span class="p_del">-		rsync -a $(TEST_DIRS) $(TEST_PROGS) $(TEST_PROGS_EXTENDED) $(TEST_FILES) $(INSTALL_PATH)/;		\</span>
<span class="p_add">+		echo &quot;rsync -a $(TEST_DIRS) $(TEST_PROGS) $(TEST_PROGS_EXTENDED) $(TEST_FILES) $(INSTALL_PATH)/&quot;;       \</span>
<span class="p_add">+		rsync -a $(TEST_DIRS) $(TEST_PROGS) $(TEST_PROGS_EXTENDED) $(TEST_FILES) $(INSTALL_PATH)/;              \</span>
<span class="p_add">+	fi</span>
<span class="p_add">+	@if [ &quot;X$(TEST_GEN_PROGS)$(TEST_GEN_PROGS_EXTENDED)$(TEST_GEN_FILES)&quot; != &quot;X&quot; ]; then					\</span>
<span class="p_add">+		mkdir -p ${INSTALL_PATH};										\</span>
<span class="p_add">+		echo &quot;rsync -a $(TEST_GEN_PROGS) $(TEST_GEN_PROGS_EXTENDED) $(TEST_GEN_FILES) $(INSTALL_PATH)/&quot;;	\</span>
<span class="p_add">+		rsync -a $(TEST_GEN_PROGS) $(TEST_GEN_PROGS_EXTENDED) $(TEST_GEN_FILES) $(INSTALL_PATH)/;		\</span>
 	fi
 endef
 
<span class="p_chunk">@@ -27,7 +32,7 @@</span> <span class="p_context"> else</span>
 endif
 
 define EMIT_TESTS
<span class="p_del">-	@for TEST in $(TEST_PROGS); do \</span>
<span class="p_add">+	@for TEST in $(TEST_GEN_PROGS) $(TEST_PROGS); do \</span>
 		echo &quot;(./$$TEST &amp;&amp; echo \&quot;selftests: $$TEST [PASS]\&quot;) || echo \&quot;selftests: $$TEST [FAIL]\&quot;&quot;; \
 	done;
 endef
<span class="p_chunk">@@ -35,4 +40,9 @@</span> <span class="p_context"> endef</span>
 emit_tests:
 	$(EMIT_TESTS)
 
<span class="p_add">+all: $(TEST_GEN_PROGS) $(TEST_GEN_PROGS_EXTENDED) $(TEST_GEN_FILES)</span>
<span class="p_add">+</span>
<span class="p_add">+clean:</span>
<span class="p_add">+	$(RM) -r $(TEST_GEN_PROGS) $(TEST_GEN_PROGS_EXTENDED) $(TEST_GEN_FILES)</span>
<span class="p_add">+</span>
 .PHONY: run_tests all clean install emit_tests
<span class="p_header">diff --git a/tools/testing/selftests/membarrier/Makefile b/tools/testing/selftests/membarrier/Makefile</span>
<span class="p_header">index a1a9708..0284553 100644</span>
<span class="p_header">--- a/tools/testing/selftests/membarrier/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/membarrier/Makefile</span>
<span class="p_chunk">@@ -1,10 +1,6 @@</span> <span class="p_context"></span>
 CFLAGS += -g -I../../../../usr/include/
 
<span class="p_del">-TEST_PROGS := membarrier_test</span>
<span class="p_del">-</span>
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_add">+TEST_GEN_PROGS := membarrier_test</span>
 
 include ../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	$(RM) $(TEST_PROGS)</span>
<span class="p_header">diff --git a/tools/testing/selftests/memfd/Makefile b/tools/testing/selftests/memfd/Makefile</span>
<span class="p_header">index fd396ac..2c87f23 100644</span>
<span class="p_header">--- a/tools/testing/selftests/memfd/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/memfd/Makefile</span>
<span class="p_chunk">@@ -4,19 +4,11 @@</span> <span class="p_context"> CFLAGS += -I../../../../include/uapi/</span>
 CFLAGS += -I../../../../include/
 CFLAGS += -I../../../../usr/include/
 
<span class="p_del">-TEST_PROGS := memfd_test</span>
<span class="p_del">-</span>
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_del">-</span>
<span class="p_del">-include ../lib.mk</span>
<span class="p_del">-</span>
<span class="p_del">-build_fuse: fuse_mnt fuse_test</span>
<span class="p_add">+TEST_PROGS := run_fuse_test.sh</span>
<span class="p_add">+TEST_GEN_FILES := memfd_test fuse_mnt fuse_test</span>
 
 fuse_mnt.o: CFLAGS += $(shell pkg-config fuse --cflags)
 fuse_mnt: LDFLAGS += $(shell pkg-config fuse --libs)
 
<span class="p_del">-run_fuse: build_fuse</span>
<span class="p_del">-	@./run_fuse_test.sh || echo &quot;fuse_test: [FAIL]&quot;</span>
<span class="p_add">+include ../lib.mk</span>
 
<span class="p_del">-clean:</span>
<span class="p_del">-	$(RM) memfd_test fuse_test</span>
<span class="p_header">diff --git a/tools/testing/selftests/mount/Makefile b/tools/testing/selftests/mount/Makefile</span>
<span class="p_header">index 5e35c9c..e8fb15e 100644</span>
<span class="p_header">--- a/tools/testing/selftests/mount/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/mount/Makefile</span>
<span class="p_chunk">@@ -1,14 +1,14 @@</span> <span class="p_context"></span>
 # Makefile for mount selftests.
 CFLAGS = -Wall \
          -O2
<span class="p_del">-all: unprivileged-remount-test</span>
 
 unprivileged-remount-test: unprivileged-remount-test.c
 	$(CC) $(CFLAGS) unprivileged-remount-test.c -o unprivileged-remount-test
 
<span class="p_add">+TEST_GEN_PROGS := unprivileged-remount-test</span>
<span class="p_add">+</span>
 include ../lib.mk
 
<span class="p_del">-TEST_PROGS := unprivileged-remount-test</span>
 override RUN_TESTS := if [ -f /proc/self/uid_map ] ; \
 		      then	\
 				./unprivileged-remount-test ; \
<span class="p_chunk">@@ -17,5 +17,3 @@</span> <span class="p_context"> override RUN_TESTS := if [ -f /proc/self/uid_map ] ; \</span>
 		      fi
 override EMIT_TESTS := echo &quot;$(RUN_TESTS)&quot;
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f unprivileged-remount-test</span>
<span class="p_header">diff --git a/tools/testing/selftests/mqueue/Makefile b/tools/testing/selftests/mqueue/Makefile</span>
<span class="p_header">index eebac29..79a664a 100644</span>
<span class="p_header">--- a/tools/testing/selftests/mqueue/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/mqueue/Makefile</span>
<span class="p_chunk">@@ -1,8 +1,6 @@</span> <span class="p_context"></span>
 CFLAGS += -O2
 LDLIBS = -lrt -lpthread -lpopt
<span class="p_del">-TEST_PROGS := mq_open_tests mq_perf_tests</span>
<span class="p_del">-</span>
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_add">+TEST_GEN_PROGS := mq_open_tests mq_perf_tests</span>
 
 include ../lib.mk
 
<span class="p_chunk">@@ -16,5 +14,3 @@</span> <span class="p_context"> override define EMIT_TESTS</span>
 	echo &quot;./mq_perf_tests || echo \&quot;selftests: mq_perf_tests [FAIL]\&quot;&quot;
 endef
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f mq_open_tests mq_perf_tests</span>
<span class="p_header">diff --git a/tools/testing/selftests/net/Makefile b/tools/testing/selftests/net/Makefile</span>
<span class="p_header">index e24e4c8..fe5b36d 100644</span>
<span class="p_header">--- a/tools/testing/selftests/net/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/net/Makefile</span>
<span class="p_chunk">@@ -3,20 +3,15 @@</span> <span class="p_context"></span>
 CFLAGS =  -Wall -Wl,--no-as-needed -O2 -g
 CFLAGS += -I../../../../usr/include/
 
<span class="p_del">-NET_PROGS =  socket</span>
<span class="p_del">-NET_PROGS += psock_fanout psock_tpacket</span>
<span class="p_del">-NET_PROGS += reuseport_bpf reuseport_bpf_cpu reuseport_bpf_numa</span>
<span class="p_del">-NET_PROGS += reuseport_dualstack</span>
<span class="p_del">-</span>
<span class="p_del">-all: $(NET_PROGS)</span>
 reuseport_bpf_numa: LDFLAGS += -lnuma
 %: %.c
 	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $^
 
 TEST_PROGS := run_netsocktests run_afpackettests test_bpf.sh
<span class="p_del">-TEST_FILES := $(NET_PROGS)</span>
<span class="p_add">+TEST_GEN_FILES =  socket</span>
<span class="p_add">+TEST_GEN_FILES += psock_fanout psock_tpacket</span>
<span class="p_add">+TEST_GEN_FILES += reuseport_bpf reuseport_bpf_cpu reuseport_bpf_numa</span>
<span class="p_add">+TEST_GEN_FILES += reuseport_dualstack</span>
 
 include ../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	$(RM) $(NET_PROGS)</span>
<span class="p_header">diff --git a/tools/testing/selftests/nsfs/Makefile b/tools/testing/selftests/nsfs/Makefile</span>
<span class="p_header">index 2306054..9ff7c7f 100644</span>
<span class="p_header">--- a/tools/testing/selftests/nsfs/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/nsfs/Makefile</span>
<span class="p_chunk">@@ -1,12 +1,5 @@</span> <span class="p_context"></span>
<span class="p_del">-TEST_PROGS := owner pidns</span>
<span class="p_add">+TEST_GEN_PROGS := owner pidns</span>
 
 CFLAGS := -Wall -Werror
 
<span class="p_del">-all: owner pidns</span>
<span class="p_del">-owner: owner.c</span>
<span class="p_del">-pidns: pidns.c</span>
<span class="p_del">-</span>
<span class="p_del">-clean:</span>
<span class="p_del">-	$(RM) owner pidns</span>
<span class="p_del">-</span>
 include ../lib.mk
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/alignment/Makefile b/tools/testing/selftests/powerpc/alignment/Makefile</span>
<span class="p_header">index ad6a4e4..16b2200 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/alignment/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/alignment/Makefile</span>
<span class="p_chunk">@@ -1,10 +1,5 @@</span> <span class="p_context"></span>
<span class="p_del">-TEST_PROGS := copy_unaligned copy_first_unaligned paste_unaligned paste_last_unaligned</span>
<span class="p_del">-</span>
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_del">-</span>
<span class="p_del">-$(TEST_PROGS): ../harness.c ../utils.c copy_paste_unaligned_common.c</span>
<span class="p_add">+TEST_GEN_PROGS := copy_unaligned copy_first_unaligned paste_unaligned paste_last_unaligned</span>
 
 include ../../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(TEST_PROGS)</span>
<span class="p_add">+$(TEST_GEN_PROGS): ../harness.c ../utils.c copy_paste_unaligned_common.c</span>
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/benchmarks/Makefile b/tools/testing/selftests/powerpc/benchmarks/Makefile</span>
<span class="p_header">index 545077f..08a55bd 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/benchmarks/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/benchmarks/Makefile</span>
<span class="p_chunk">@@ -1,16 +1,11 @@</span> <span class="p_context"></span>
<span class="p_del">-TEST_PROGS := gettimeofday context_switch mmap_bench futex_bench null_syscall</span>
<span class="p_add">+TEST_GEN_PROGS := gettimeofday context_switch mmap_bench futex_bench null_syscall</span>
 
 CFLAGS += -O2
 
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_add">+$(TEST_GEN_PROGS): ../harness.c</span>
 
<span class="p_del">-$(TEST_PROGS): ../harness.c</span>
<span class="p_add">+include ../../lib.mk</span>
 
 context_switch: ../utils.c
 context_switch: CFLAGS += -maltivec -mvsx -mabi=altivec
 context_switch: LDLIBS += -lpthread
<span class="p_del">-</span>
<span class="p_del">-include ../../lib.mk</span>
<span class="p_del">-</span>
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(TEST_PROGS) *.o</span>
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/context_switch/Makefile b/tools/testing/selftests/powerpc/context_switch/Makefile</span>
<span class="p_header">index e164d14..e9351bb 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/context_switch/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/context_switch/Makefile</span>
<span class="p_chunk">@@ -1,10 +1,5 @@</span> <span class="p_context"></span>
<span class="p_del">-TEST_PROGS := cp_abort</span>
<span class="p_del">-</span>
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_del">-</span>
<span class="p_del">-$(TEST_PROGS): ../harness.c ../utils.c</span>
<span class="p_add">+TEST_GEN_PROGS := cp_abort</span>
 
 include ../../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(TEST_PROGS)</span>
<span class="p_add">+$(TEST_GEN_PROGS): ../harness.c ../utils.c</span>
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/copyloops/Makefile b/tools/testing/selftests/powerpc/copyloops/Makefile</span>
<span class="p_header">index 384843e..9ad1558 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/copyloops/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/copyloops/Makefile</span>
<span class="p_chunk">@@ -7,19 +7,14 @@</span> <span class="p_context"> CFLAGS += -maltivec</span>
 # Use our CFLAGS for the implicit .S rule
 ASFLAGS = $(CFLAGS)
 
<span class="p_del">-TEST_PROGS := copyuser_64 copyuser_power7 memcpy_64 memcpy_power7</span>
<span class="p_add">+TEST_GEN_PROGS := copyuser_64 copyuser_power7 memcpy_64 memcpy_power7</span>
 EXTRA_SOURCES := validate.c ../harness.c
 
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_add">+include ../../lib.mk</span>
 
 copyuser_64:     CPPFLAGS += -D COPY_LOOP=test___copy_tofrom_user_base
 copyuser_power7: CPPFLAGS += -D COPY_LOOP=test___copy_tofrom_user_power7
 memcpy_64:       CPPFLAGS += -D COPY_LOOP=test_memcpy
 memcpy_power7:   CPPFLAGS += -D COPY_LOOP=test_memcpy_power7
 
<span class="p_del">-$(TEST_PROGS): $(EXTRA_SOURCES)</span>
<span class="p_del">-</span>
<span class="p_del">-include ../../lib.mk</span>
<span class="p_del">-</span>
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(TEST_PROGS) *.o</span>
<span class="p_add">+$(TEST_GEN_PROGS): $(EXTRA_SOURCES)</span>
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/dscr/Makefile b/tools/testing/selftests/powerpc/dscr/Makefile</span>
<span class="p_header">index 49327ee..4262de4 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/dscr/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/dscr/Makefile</span>
<span class="p_chunk">@@ -1,14 +1,9 @@</span> <span class="p_context"></span>
<span class="p_del">-TEST_PROGS := dscr_default_test dscr_explicit_test dscr_user_test	\</span>
<span class="p_add">+TEST_GEN_PROGS := dscr_default_test dscr_explicit_test dscr_user_test	\</span>
 	      dscr_inherit_test dscr_inherit_exec_test dscr_sysfs_test	\
 	      dscr_sysfs_thread_test
 
<span class="p_del">-dscr_default_test: LDLIBS += -lpthread</span>
<span class="p_del">-</span>
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_del">-</span>
<span class="p_del">-$(TEST_PROGS): ../harness.c</span>
<span class="p_del">-</span>
 include ../../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(TEST_PROGS) *.o</span>
<span class="p_add">+dscr_default_test: LDLIBS += -lpthread</span>
<span class="p_add">+</span>
<span class="p_add">+$(TEST_GEN_PROGS): ../harness.c</span>
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/math/Makefile b/tools/testing/selftests/powerpc/math/Makefile</span>
<span class="p_header">index a505b66..814c385 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/math/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/math/Makefile</span>
<span class="p_chunk">@@ -1,9 +1,9 @@</span> <span class="p_context"></span>
<span class="p_del">-TEST_PROGS := fpu_syscall fpu_preempt fpu_signal vmx_syscall vmx_preempt vmx_signal vsx_preempt</span>
<span class="p_add">+TEST_GEN_PROGS := fpu_syscall fpu_preempt fpu_signal vmx_syscall vmx_preempt vmx_signal vsx_preempt</span>
 
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_add">+include ../../lib.mk</span>
 
<span class="p_del">-$(TEST_PROGS): ../harness.c</span>
<span class="p_del">-$(TEST_PROGS): CFLAGS += -O2 -g -pthread -m64 -maltivec</span>
<span class="p_add">+$(TEST_GEN_PROGS): ../harness.c</span>
<span class="p_add">+$(TEST_GEN_PROGS): CFLAGS += -O2 -g -pthread -m64 -maltivec</span>
 
 fpu_syscall: fpu_asm.S
 fpu_preempt: fpu_asm.S
<span class="p_chunk">@@ -15,8 +15,3 @@</span> <span class="p_context"> vmx_signal: vmx_asm.S</span>
 
 vsx_preempt: CFLAGS += -mvsx
 vsx_preempt: vsx_asm.S
<span class="p_del">-</span>
<span class="p_del">-include ../../lib.mk</span>
<span class="p_del">-</span>
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(TEST_PROGS) *.o</span>
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/mm/Makefile b/tools/testing/selftests/powerpc/mm/Makefile</span>
<span class="p_header">index 3bdb96e..d563378 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/mm/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/mm/Makefile</span>
<span class="p_chunk">@@ -1,19 +1,15 @@</span> <span class="p_context"></span>
 noarg:
 	$(MAKE) -C ../
 
<span class="p_del">-TEST_PROGS := hugetlb_vs_thp_test subpage_prot prot_sao</span>
<span class="p_del">-TEST_FILES := tempfile</span>
<span class="p_add">+TEST_GEN_PROGS := hugetlb_vs_thp_test subpage_prot prot_sao</span>
<span class="p_add">+TEST_GEN_FILES := tempfile</span>
 
<span class="p_del">-all: $(TEST_PROGS) $(TEST_FILES)</span>
<span class="p_add">+include ../../lib.mk</span>
 
<span class="p_del">-$(TEST_PROGS): ../harness.c</span>
<span class="p_add">+$(TEST_GEN_PROGS): ../harness.c</span>
 
 prot_sao: ../utils.c
 
<span class="p_del">-include ../../lib.mk</span>
<span class="p_del">-</span>
 tempfile:
 	dd if=/dev/zero of=tempfile bs=64k count=1
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(TEST_PROGS) tempfile</span>
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/pmu/Makefile b/tools/testing/selftests/powerpc/pmu/Makefile</span>
<span class="p_header">index ac41a71..ab0f902 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/pmu/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/pmu/Makefile</span>
<span class="p_chunk">@@ -1,12 +1,14 @@</span> <span class="p_context"></span>
 noarg:
 	$(MAKE) -C ../
 
<span class="p_del">-TEST_PROGS := count_instructions l3_bank_test per_event_excludes</span>
<span class="p_add">+TEST_GEN_PROGS := count_instructions l3_bank_test per_event_excludes</span>
 EXTRA_SOURCES := ../harness.c event.c lib.c ../utils.c
 
<span class="p_del">-all: $(TEST_PROGS) ebb</span>
<span class="p_add">+include ../../lib.mk</span>
<span class="p_add">+</span>
<span class="p_add">+all: $(TEST_GEN_PROGS) ebb</span>
 
<span class="p_del">-$(TEST_PROGS): $(EXTRA_SOURCES)</span>
<span class="p_add">+$(TEST_GEN_PROGS): $(EXTRA_SOURCES)</span>
 
 # loop.S can only be built 64-bit
 count_instructions: loop.S count_instructions.c $(EXTRA_SOURCES)
<span class="p_chunk">@@ -14,8 +16,6 @@</span> <span class="p_context"> count_instructions: loop.S count_instructions.c $(EXTRA_SOURCES)</span>
 
 per_event_excludes: ../utils.c
 
<span class="p_del">-include ../../lib.mk</span>
<span class="p_del">-</span>
 DEFAULT_RUN_TESTS := $(RUN_TESTS)
 override define RUN_TESTS
 	$(DEFAULT_RUN_TESTS)
<span class="p_chunk">@@ -35,7 +35,7 @@</span> <span class="p_context"> override define INSTALL_RULE</span>
 endef
 
 clean:
<span class="p_del">-	rm -f $(TEST_PROGS) loop.o</span>
<span class="p_add">+	$(RM) $(TEST_PROGS) loop.o</span>
 	$(MAKE) -C ebb clean
 
 ebb:
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/pmu/ebb/Makefile b/tools/testing/selftests/powerpc/pmu/ebb/Makefile</span>
<span class="p_header">index 8d2279c4..0bc2bd6 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/pmu/ebb/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/pmu/ebb/Makefile</span>
<span class="p_chunk">@@ -4,7 +4,7 @@</span> <span class="p_context"> noarg:</span>
 # The EBB handler is 64-bit code and everything links against it
 CFLAGS += -m64
 
<span class="p_del">-TEST_PROGS := reg_access_test event_attributes_test cycles_test	\</span>
<span class="p_add">+TEST_GEN_PROGS := reg_access_test event_attributes_test cycles_test	\</span>
 	 cycles_with_freeze_test pmc56_overflow_test		\
 	 ebb_vs_cpu_event_test cpu_event_vs_ebb_test		\
 	 cpu_event_pinned_vs_ebb_test task_event_vs_ebb_test	\
<span class="p_chunk">@@ -16,16 +16,11 @@</span> <span class="p_context"> TEST_PROGS := reg_access_test event_attributes_test cycles_test	\</span>
 	 lost_exception_test no_handler_test			\
 	 cycles_with_mmcr2_test
 
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_add">+include ../../../lib.mk</span>
 
<span class="p_del">-$(TEST_PROGS): ../../harness.c ../../utils.c ../event.c ../lib.c \</span>
<span class="p_add">+$(TEST_GEN_PROGS): ../../harness.c ../../utils.c ../event.c ../lib.c \</span>
 	       ebb.c ebb_handler.S trace.c busy_loop.S
 
 instruction_count_test: ../loop.S
 
 lost_exception_test: ../lib.c
<span class="p_del">-</span>
<span class="p_del">-include ../../../lib.mk</span>
<span class="p_del">-</span>
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(TEST_PROGS)</span>
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/primitives/Makefile b/tools/testing/selftests/powerpc/primitives/Makefile</span>
<span class="p_header">index b68c622..175366d 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/primitives/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/primitives/Makefile</span>
<span class="p_chunk">@@ -1,12 +1,7 @@</span> <span class="p_context"></span>
 CFLAGS += -I$(CURDIR)
 
<span class="p_del">-TEST_PROGS := load_unaligned_zeropad</span>
<span class="p_del">-</span>
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_del">-</span>
<span class="p_del">-$(TEST_PROGS): ../harness.c</span>
<span class="p_add">+TEST_GEN_PROGS := load_unaligned_zeropad</span>
 
 include ../../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(TEST_PROGS) *.o</span>
<span class="p_add">+$(TEST_GEN_PROGS): ../harness.c</span>
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/stringloops/Makefile b/tools/testing/selftests/powerpc/stringloops/Makefile</span>
<span class="p_header">index 2a728f4..557b937 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/stringloops/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/stringloops/Makefile</span>
<span class="p_chunk">@@ -2,14 +2,9 @@</span> <span class="p_context"></span>
 CFLAGS += -m64
 CFLAGS += -I$(CURDIR)
 
<span class="p_del">-TEST_PROGS := memcmp</span>
<span class="p_add">+TEST_GEN_PROGS := memcmp</span>
 EXTRA_SOURCES := memcmp_64.S ../harness.c
 
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_del">-</span>
<span class="p_del">-$(TEST_PROGS): $(EXTRA_SOURCES)</span>
<span class="p_del">-</span>
 include ../../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(TEST_PROGS) *.o</span>
<span class="p_add">+$(TEST_GEN_PROGS): $(EXTRA_SOURCES)</span>
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/switch_endian/Makefile b/tools/testing/selftests/powerpc/switch_endian/Makefile</span>
<span class="p_header">index e21d106..bd01223 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/switch_endian/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/switch_endian/Makefile</span>
<span class="p_chunk">@@ -1,8 +1,8 @@</span> <span class="p_context"></span>
<span class="p_del">-TEST_PROGS := switch_endian_test</span>
<span class="p_add">+TEST_GEN_PROGS := switch_endian_test</span>
 
 ASFLAGS += -O2 -Wall -g -nostdlib -m64
 
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_add">+include ../../lib.mk</span>
 
 switch_endian_test: check-reversed.S
 
<span class="p_chunk">@@ -12,7 +12,5 @@</span> <span class="p_context"> check-reversed.o: check.o</span>
 check-reversed.S: check-reversed.o
 	hexdump -v -e &#39;/1 &quot;.byte 0x%02X\n&quot;&#39; $&lt; &gt; $@
 
<span class="p_del">-include ../../lib.mk</span>
<span class="p_del">-</span>
 clean:
<span class="p_del">-	rm -f $(TEST_PROGS) *.o check-reversed.S</span>
<span class="p_add">+	$(RM) $(TEST_GEN_PROGS) *.o check-reversed.S</span>
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/syscalls/Makefile b/tools/testing/selftests/powerpc/syscalls/Makefile</span>
<span class="p_header">index b35c794..da22ca7 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/syscalls/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/syscalls/Makefile</span>
<span class="p_chunk">@@ -1,12 +1,7 @@</span> <span class="p_context"></span>
<span class="p_del">-TEST_PROGS := ipc_unmuxed</span>
<span class="p_add">+TEST_GEN_PROGS := ipc_unmuxed</span>
 
 CFLAGS += -I../../../../../usr/include
 
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_del">-</span>
<span class="p_del">-$(TEST_PROGS): ../harness.c</span>
<span class="p_del">-</span>
 include ../../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(TEST_PROGS) *.o</span>
<span class="p_add">+$(TEST_GEN_PROGS): ../harness.c</span>
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/tm/Makefile b/tools/testing/selftests/powerpc/tm/Makefile</span>
<span class="p_header">index c6c53c8..117c624 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/tm/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/tm/Makefile</span>
<span class="p_chunk">@@ -1,12 +1,12 @@</span> <span class="p_context"></span>
 SIGNAL_CONTEXT_CHK_TESTS := tm-signal-context-chk-gpr tm-signal-context-chk-fpu \
 	tm-signal-context-chk-vmx tm-signal-context-chk-vsx
 
<span class="p_del">-TEST_PROGS := tm-resched-dscr tm-syscall tm-signal-msr-resv tm-signal-stack \</span>
<span class="p_add">+TEST_GEN_PROGS := tm-resched-dscr tm-syscall tm-signal-msr-resv tm-signal-stack \</span>
 	tm-vmxcopy tm-fork tm-tar tm-tmspr $(SIGNAL_CONTEXT_CHK_TESTS)
 
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_add">+include ../../lib.mk</span>
 
<span class="p_del">-$(TEST_PROGS): ../harness.c ../utils.c</span>
<span class="p_add">+$(TEST_GEN_PROGS): ../harness.c ../utils.c</span>
 
 CFLAGS += -mhtm
 
<span class="p_chunk">@@ -16,8 +16,3 @@</span> <span class="p_context"> tm-tmspr: CFLAGS += -pthread</span>
 
 $(SIGNAL_CONTEXT_CHK_TESTS): tm-signal.S
 $(SIGNAL_CONTEXT_CHK_TESTS): CFLAGS += -mhtm -m64 -mvsx
<span class="p_del">-</span>
<span class="p_del">-include ../../lib.mk</span>
<span class="p_del">-</span>
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(TEST_PROGS) *.o</span>
<span class="p_header">diff --git a/tools/testing/selftests/powerpc/vphn/Makefile b/tools/testing/selftests/powerpc/vphn/Makefile</span>
<span class="p_header">index a485f2e..f8ced26 100644</span>
<span class="p_header">--- a/tools/testing/selftests/powerpc/vphn/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/powerpc/vphn/Makefile</span>
<span class="p_chunk">@@ -1,12 +1,8 @@</span> <span class="p_context"></span>
<span class="p_del">-TEST_PROGS := test-vphn</span>
<span class="p_add">+TEST_GEN_PROGS := test-vphn</span>
 
 CFLAGS += -m64
 
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_del">-</span>
<span class="p_del">-$(TEST_PROGS): ../harness.c</span>
<span class="p_del">-</span>
 include ../../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f $(TEST_PROGS)</span>
<span class="p_add">+$(TEST_GEN_PROGS): ../harness.c</span>
<span class="p_add">+</span>
<span class="p_header">diff --git a/tools/testing/selftests/ptrace/Makefile b/tools/testing/selftests/ptrace/Makefile</span>
<span class="p_header">index 453927f..8a2bc55 100644</span>
<span class="p_header">--- a/tools/testing/selftests/ptrace/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/ptrace/Makefile</span>
<span class="p_chunk">@@ -1,11 +1,5 @@</span> <span class="p_context"></span>
 CFLAGS += -iquote../../../../include/uapi -Wall
<span class="p_del">-peeksiginfo: peeksiginfo.c</span>
 
<span class="p_del">-all: peeksiginfo</span>
<span class="p_del">-</span>
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f peeksiginfo</span>
<span class="p_del">-</span>
<span class="p_del">-TEST_PROGS := peeksiginfo</span>
<span class="p_add">+TEST_GEN_PROGS := peeksiginfo</span>
 
 include ../lib.mk
<span class="p_header">diff --git a/tools/testing/selftests/seccomp/Makefile b/tools/testing/selftests/seccomp/Makefile</span>
<span class="p_header">index 8401e87..5fa6fd2 100644</span>
<span class="p_header">--- a/tools/testing/selftests/seccomp/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/seccomp/Makefile</span>
<span class="p_chunk">@@ -1,10 +1,6 @@</span> <span class="p_context"></span>
<span class="p_del">-TEST_PROGS := seccomp_bpf</span>
<span class="p_add">+TEST_GEN_PROGS := seccomp_bpf</span>
 CFLAGS += -Wl,-no-as-needed -Wall
 LDFLAGS += -lpthread
 
<span class="p_del">-all: $(TEST_PROGS)</span>
<span class="p_del">-</span>
 include ../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	$(RM) $(TEST_PROGS)</span>
<span class="p_header">diff --git a/tools/testing/selftests/sigaltstack/Makefile b/tools/testing/selftests/sigaltstack/Makefile</span>
<span class="p_header">index 56af56e..f68fbf8 100644</span>
<span class="p_header">--- a/tools/testing/selftests/sigaltstack/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/sigaltstack/Makefile</span>
<span class="p_chunk">@@ -1,8 +1,5 @@</span> <span class="p_context"></span>
 CFLAGS = -Wall
<span class="p_del">-BINARIES = sas</span>
<span class="p_del">-all: $(BINARIES)</span>
<span class="p_add">+TEST_GEN_PROGS = sas</span>
 
 include ../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -rf $(BINARIES)</span>
<span class="p_header">diff --git a/tools/testing/selftests/size/Makefile b/tools/testing/selftests/size/Makefile</span>
<span class="p_header">index bbd0b53..c67f357 100644</span>
<span class="p_header">--- a/tools/testing/selftests/size/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/size/Makefile</span>
<span class="p_chunk">@@ -1,11 +1,7 @@</span> <span class="p_context"></span>
<span class="p_del">-all: get_size</span>
 
 get_size: get_size.c
 	$(CC) -static -ffreestanding -nostartfiles -s $&lt; -o $@
 
<span class="p_del">-TEST_PROGS := get_size</span>
<span class="p_add">+TEST_GEN_PROGS := get_size</span>
 
 include ../lib.mk
<span class="p_del">-</span>
<span class="p_del">-clean:</span>
<span class="p_del">-	$(RM) get_size</span>
<span class="p_header">diff --git a/tools/testing/selftests/timers/Makefile b/tools/testing/selftests/timers/Makefile</span>
<span class="p_header">index 1d55568..4a3bffe 100644</span>
<span class="p_header">--- a/tools/testing/selftests/timers/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/timers/Makefile</span>
<span class="p_chunk">@@ -5,16 +5,13 @@</span> <span class="p_context"> LDFLAGS += -lrt -lpthread</span>
 
 # these are all &quot;safe&quot; tests that don&#39;t modify
 # system time or require escalated privledges
<span class="p_del">-TEST_PROGS = posix_timers nanosleep nsleep-lat set-timer-lat mqueue-lat \</span>
<span class="p_add">+TEST_GEN_PROGS = posix_timers nanosleep nsleep-lat set-timer-lat mqueue-lat \</span>
 	     inconsistency-check raw_skew threadtest rtctest
 
<span class="p_del">-TEST_PROGS_EXTENDED = alarmtimer-suspend valid-adjtimex adjtick change_skew \</span>
<span class="p_add">+TEST_GEN_PROGS_EXTENDED = alarmtimer-suspend valid-adjtimex adjtick change_skew \</span>
 		      skew_consistency clocksource-switch leap-a-day \
 		      leapcrash set-tai set-2038 set-tz
 
<span class="p_del">-bins = $(TEST_PROGS) $(TEST_PROGS_EXTENDED)</span>
<span class="p_del">-</span>
<span class="p_del">-all: ${bins}</span>
 
 include ../lib.mk
 
<span class="p_chunk">@@ -34,5 +31,3 @@</span> <span class="p_context"> run_destructive_tests: run_tests</span>
 	./set-tai
 	./set-2038
 
<span class="p_del">-clean:</span>
<span class="p_del">-	rm -f ${bins}</span>
<span class="p_header">diff --git a/tools/testing/selftests/vm/Makefile b/tools/testing/selftests/vm/Makefile</span>
<span class="p_header">index bbab7f4..323383a 100644</span>
<span class="p_header">--- a/tools/testing/selftests/vm/Makefile</span>
<span class="p_header">+++ b/tools/testing/selftests/vm/Makefile</span>
<span class="p_chunk">@@ -1,18 +1,17 @@</span> <span class="p_context"></span>
 # Makefile for vm selftests
 
 CFLAGS = -Wall -I ../../../../usr/include $(EXTRA_CFLAGS)
<span class="p_del">-BINARIES = compaction_test</span>
<span class="p_del">-BINARIES += hugepage-mmap</span>
<span class="p_del">-BINARIES += hugepage-shm</span>
<span class="p_del">-BINARIES += map_hugetlb</span>
<span class="p_del">-BINARIES += mlock2-tests</span>
<span class="p_del">-BINARIES += on-fault-limit</span>
<span class="p_del">-BINARIES += thuge-gen</span>
<span class="p_del">-BINARIES += transhuge-stress</span>
<span class="p_del">-BINARIES += userfaultfd</span>
<span class="p_del">-BINARIES += mlock-random-test</span>
<span class="p_add">+TEST_GEN_FILES = compaction_test</span>
<span class="p_add">+TEST_GEN_FILES += hugepage-mmap</span>
<span class="p_add">+TEST_GEN_FILES += hugepage-shm</span>
<span class="p_add">+TEST_GEN_FILES += map_hugetlb</span>
<span class="p_add">+TEST_GEN_FILES += mlock2-tests</span>
<span class="p_add">+TEST_GEN_FILES += on-fault-limit</span>
<span class="p_add">+TEST_GEN_FILES += thuge-gen</span>
<span class="p_add">+TEST_GEN_FILES += transhuge-stress</span>
<span class="p_add">+TEST_GEN_FILES += userfaultfd</span>
<span class="p_add">+TEST_GEN_FILES += mlock-random-test</span>
 
<span class="p_del">-all: $(BINARIES)</span>
 %: %.c
 	$(CC) $(CFLAGS) -o $@ $^ -lrt
 userfaultfd: userfaultfd.c ../../../../usr/include/linux/kernel.h
<span class="p_chunk">@@ -25,9 +24,6 @@</span> <span class="p_context"> mlock-random-test: mlock-random-test.c</span>
 	make -C ../../../.. headers_install
 
 TEST_PROGS := run_vmtests
<span class="p_del">-TEST_FILES := $(BINARIES)</span>
 
 include ../lib.mk
 
<span class="p_del">-clean:</span>
<span class="p_del">-	$(RM) $(BINARIES)</span>

</pre>
</div>




  </div>
  <div id="footer">
   <a href="http://jk.ozlabs.org/projects/patchwork/">patchwork</a>
   patch tracking system
  </div>
 </body>
</html>



