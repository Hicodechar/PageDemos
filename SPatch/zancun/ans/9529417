
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <title>[v3,02/37] treewide: Move dma_ops from struct dev_archdata into struct device - Patchwork</title>
  <link rel="stylesheet" type="text/css" href="/static/css/style.css"/>
  <script type="text/javascript" src="/static/js/common.js"></script>
  <script type="text/javascript" src="/static/js/jquery-1.10.1.min.js"></script>

 </head>
 <body>
  <div id="title">
  <h1 style="float: left;">
     <a
      href="/">Patchwork</a>
    [v3,02/37] treewide: Move dma_ops from struct dev_archdata into struct device</h1>
  <div id="auth">

     <a href="/user/login/">login</a>
     <br/>
     <a href="/register/">register</a>
     <br/>
     <a href="/mail/">mail settings</a>

   </div>
   <div style="clear: both;"></div>
  </div>
  <div id="nav">
   <div id="navleft">
   
    <strong>Project</strong>: LKML
     :
     <a href="/project/LKML/list/"
      >patches</a>
     :
     <a href="/project/LKML/"
      >project info</a>
    
     :
     <a href="/"
     >other projects</a>
     
    
   </div>
   <div id="navright">
    <a href="/help/about/">about</a>
   </div>
   <div style="clear: both"></div>
  </div>

  <div id="content">

<script language="JavaScript" type="text/javascript">
function toggle_headers(link_id, headers_id)
{
    var link = document.getElementById(link_id)
    var headers = document.getElementById(headers_id)

    var hidden = headers.style['display'] == 'none';

    if (hidden) {
        link.innerHTML = 'hide';
        headers.style['display'] = 'block';
    } else {
        link.innerHTML = 'show';
        headers.style['display'] = 'none';
    }

}
</script>

<table class="patchmeta">
 <tr>
  <th>Submitter</th>
  <td><a href="/project/LKML/list/?submitter=119921">Bart Van Assche</a></td>
 </tr>
 <tr>
  <th>Date</th>
  <td>Jan. 20, 2017, 9:04 p.m.</td>
 </tr>
 <tr>
  <th>Message ID</th>
  <td>&lt;20170120210437.26389-3-bart.vanassche@sandisk.com&gt;</td>
 </tr>
 <tr>
  <th>Download</th>
  <td>
   <a href="/patch/9529417/mbox/"
   >mbox</a>
|
   <a href="/patch/9529417/raw/"
   >patch</a>

   </td>
 </tr>
 <tr>
  <th>Permalink</th>
  <td><a href="/patch/9529417/">/patch/9529417/</a>
 </tr>
  <tr>
   <th>State</th>
   <td>New</td>
  </tr>


 <tr>
  <th>Headers</th>
  <td><a id="togglepatchheaders"
   href="javascript:toggle_headers('togglepatchheaders', 'patchheaders')"
   >show</a>
   <div id="patchheaders" class="patchheaders" style="display:none;">
    <pre>Return-Path: &lt;linux-kernel-owner@kernel.org&gt;
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
	[172.30.200.125])
	by pdx-korg-patchwork.web.codeaurora.org (Postfix) with ESMTP id
	0F8D36020B for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Fri, 20 Jan 2017 21:06:51 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id DA68B2868D
	for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Fri, 20 Jan 2017 21:06:50 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id CD4D7286D6; Fri, 20 Jan 2017 21:06:50 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-6.9 required=2.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 6FBE32868D
	for &lt;patchwork-LKML@patchwork.kernel.org&gt;;
	Fri, 20 Jan 2017 21:06:49 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1752539AbdATVGi (ORCPT
	&lt;rfc822;patchwork-LKML@patchwork.kernel.org&gt;);
	Fri, 20 Jan 2017 16:06:38 -0500
Received: from mail-sn1nam01on0062.outbound.protection.outlook.com
	([104.47.32.62]:61712
	&quot;EHLO NAM01-SN1-obe.outbound.protection.outlook.com&quot;
	rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
	id S1750916AbdATVGB (ORCPT &lt;rfc822;linux-kernel@vger.kernel.org&gt;);
	Fri, 20 Jan 2017 16:06:01 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=sandiskcorp.onmicrosoft.com; s=selector1-sandisk-com;
	h=From:Date:Subject:Message-ID:Content-Type:MIME-Version;
	bh=IDkgSBo/N9pXkdSf+8fhuPS0dlFiK5SSUbDPoOlvD1Y=;
	b=UxlZ64Ei0VIuxZ0pjZJyOkvyWIFup3W8/oyShSvM4j5Rv9dPJRJoOk3lTCHlBSeF9UQJ4HvekM47XRp0XiJWkvvlW0Fw2Y+29jdrIfvyeDQBW7pDbNxa1MamTb1MDiBHqF+5YcwKVhm6bOc/JlXZyEE6FBd+UK4fGNirERiFgpE=
Received: from MWHPR02CA0009.namprd02.prod.outlook.com (10.168.209.147) by
	CY1PR02MB1413.namprd02.prod.outlook.com (10.161.171.15) with
	Microsoft SMTP Server (version=TLS1_2,
	cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384) id
	15.1.860.13; Fri, 20 Jan 2017 21:04:47 +0000
Received: from BY2FFO11FD019.protection.gbl (2a01:111:f400:7c0c::188) by
	MWHPR02CA0009.outlook.office365.com (2603:10b6:300:4b::19) with
	Microsoft SMTP Server (version=TLS1_2,
	cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384) id 15.1.860.13 via
	Frontend Transport; Fri, 20 Jan 2017 21:04:46 +0000
Authentication-Results: spf=pass (sender IP is 63.163.107.225)
	smtp.mailfrom=sandisk.com; vger.kernel.org;
	dkim=none (message not signed)
	header.d=none;vger.kernel.org; dmarc=bestguesspass action=none
	header.from=sandisk.com;
Received-SPF: Pass (protection.outlook.com: domain of sandisk.com designates
	63.163.107.225 as permitted sender)
	receiver=protection.outlook.com; 
	client-ip=63.163.107.225; helo=milsmgep14.sandisk.com;
Received: from milsmgep14.sandisk.com (63.163.107.225) by
	BY2FFO11FD019.mail.protection.outlook.com (10.1.14.107) with
	Microsoft SMTP Server (version=TLS1_2,
	cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384) id
	15.1.803.8 via Frontend Transport; Fri, 20 Jan 2017 21:04:46 +0000
Received: from MILHUBIP04.sdcorp.global.sandisk.com (Unknown_Domain
	[10.201.67.162])
	(using TLS with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(Client did not present a certificate)
	by  (Symantec Messaging Gateway) with SMTP id 3D.C8.01420.C3972885;
	Fri, 20 Jan 2017 12:55:28 -0800 (PST)
Received: from milsmgip11.sandisk.com (10.177.8.100) by
	MILHUBIP04.sdcorp.global.sandisk.com (10.177.9.97) with Microsoft
	SMTP Server id 14.3.319.2; Fri, 20 Jan 2017 13:04:40 -0800
X-AuditID: 0ac94371-47fff7000001058c-52-5882793cea6f
Received: from exp-402881.sdcorp.global.sandisk.com ( [10.177.8.100])   by
	(Symantec Messaging Gateway) with SMTP id 25.33.16817.86B72885;
	Fri, 20 Jan 2017 13:04:40 -0800 (PST)
From: Bart Van Assche &lt;bart.vanassche@sandisk.com&gt;
To: Doug Ledford &lt;dledford@redhat.com&gt;
CC: &lt;linux-rdma@vger.kernel.org&gt;,
	Bart Van Assche &lt;bart.vanassche@sandisk.com&gt;,
	Benjamin Herrenschmidt &lt;benh@kernel.crashing.org&gt;,
	Boris Ostrovsky &lt;boris.ostrovsky@oracle.com&gt;,
	David Woodhouse &lt;dwmw2@infradead.org&gt;, Juergen Gross &lt;jgross@suse.com&gt;,
	&quot;H . Peter Anvin&quot; &lt;hpa@zytor.com&gt;, Ingo Molnar &lt;mingo@redhat.com&gt;,
	&lt;linux-arch@vger.kernel.org&gt;, &lt;linux-kernel@vger.kernel.org&gt;,
	Russell King &lt;linux@armlinux.org.uk&gt;, &lt;x86@kernel.org&gt;
Subject: [PATCH v3 02/37] treewide: Move dma_ops from struct dev_archdata
	into struct device
Date: Fri, 20 Jan 2017 13:04:02 -0800
Message-ID: &lt;20170120210437.26389-3-bart.vanassche@sandisk.com&gt;
X-Mailer: git-send-email 2.11.0
In-Reply-To: &lt;20170120210437.26389-1-bart.vanassche@sandisk.com&gt;
References: &lt;20170120210437.26389-1-bart.vanassche@sandisk.com&gt;
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFprBIsWRmVeSWpSXmKPExsXCddJ5ka5DZVOEwccONosPTa3MFhent7JY
	vDz/gdVi4srJzBbTNopbzLlpZNGx6yuLxeVdc9gsnh3qZbE4NHUvo8WlAwuYLH5seMzqwONx
	+dpFZo/NK7Q8et60sHpsWtXJ5vHx6S0Wj/f7rrJ5rN9ylcXj8yY5jxMtX1gDOKO4bFJSczLL
	Uov07RK4Mu42L2Av+LaLsWLqhCVsDYwv5zB2MXJySAiYSHR23GHpYuTiEBJYyiTRerSNFcLZ
	wSix+sY1NpiqCZd2QFVtZpTYc/cRWDubgJHEt/czWUBsEQE1iU2vFrGDFDEL7GGWmLH7PxNI
	QlggRmLGn/NgNouAqsTDHa/BGngF7CX6Vq1igdggL7Gr7SIriM0p4CDx6XIf2AIhoJrjl5+C
	DZUQeMoqsWrNWjaIZkGJkzOfgDUzC0hIHHzxghmiQV3i5JL5TBMYhWYhKZuFpGwBI9MqRrHc
	zJzi3PTUAkMTveLEvJTM4my95PzcTYyQ+Crcwfj6tvchRgEORiUeXoWApggh1sSy4srcQ4wS
	HMxKIryvgdEpxJuSWFmVWpQfX1Sak1p8iFGag0VJnPdi9McwIYH0xJLU7NTUgtQimCwTB6dU
	A+P5P+4TdE38Vv/81HtIYGfhvo1Pd6pv1gzau0gwMqvEbeVJzjSRXx7Ttu3rrP0TXmezj/OH
	RK06j1P5+rUZn/vZmFlVeBXf6V2y2p/8dZlJ6pyYUm1v0YNvv7+/r/U1T8bWINvj/cXdkubd
	5rnye7W+9Vc0fZ3o+de0KDpmlfMPN2m3xSd59ZVYijMSDbWYi4oTAePSFMqrAgAA
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFnrOJMWRmVeSWpSXmKPExsXCtZEjRTejuinC4MltUYuDP9sYLT40tTJb
	XJzeymLx8vwHVouJKyczW0zbKG4x56aRRceurywWl3fNYbN4dqiXxeLQ1L2MFpcOLGCy+LHh
	MasDr8flaxeZPTav0PLoedPC6rFpVSebx8ent1g83u+7yuYxbc15Jo/1W66yeHzeJOdxouUL
	awBXFJdNSmpOZllqkb5dAlfG3eYF7AXfdjFWTJ2whK2B8eUcxi5GTg4JAROJCZd2sHQxcnEI
	CWxklNj06SwzSIJNwEji2/uZLCC2iICaxKZXi9hBipgF9jFLrGz7AFYkLBAjMePPeSYQm0VA
	VeLhjtdgDbwC9hIPV/1lgdggL7Gr7SIriM0p4CDx6XIf2GYhoJrjl5+yT2DkXsDIsIpRLDcz
	pzg3PbPA0FCvODEvJbM4Wy85P3cTIzgoOSN3MD6daH6IkYmDU6qB0fKpG5/A3M8+2vkb80qW
	+VrHWU9tWvG/zlakosZl8pSY+7aFLP02XG+FVAT8TAJWOe91fbO/ZH7EPcXk4sTC8x8ESsz+
	7NzR66spt7Py/WUB0yk/1ytwb1v3X+G/lVdiWYe7BptvVEyUjUw546ynHyTYLWYrKMzY6H13
	vUaeLFvYNhutVfuVWIozEg21mIuKEwHIH17c+gEAAA==
MIME-Version: 1.0
Content-Type: text/plain
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:63.163.107.225; IPV:NLI; CTRY:US; EFV:NLI;
	SFV:NSPM;
	SFS:(10009020)(6009001)(7916002)(39840400002)(39410400002)(39450400003)(39860400002)(39850400002)(2980300002)(438002)(189002)(199003)(36756003)(2950100002)(81156014)(6916009)(575784001)(48376002)(92566002)(5890100001)(68736007)(4326007)(626004)(47776003)(2270400002)(2906002)(33646002)(110136003)(8676002)(50466002)(1076002)(50226002)(69596002)(8936002)(106466001)(97736004)(53936002)(6666003)(81166006)(50986999)(76176999)(38730400001)(189998001)(356003)(305945005)(5003940100001)(5660300001)(86362001)(54906002)(7416002)(77096006);
	DIR:OUT; SFP:1101; SCL:1; SRVR:CY1PR02MB1413;
	H:milsmgep14.sandisk.com; FPR:; SPF:Pass;
	PTR:InfoDomainNonexistent; MX:1; A:1; LANG:en; 
X-Microsoft-Exchange-Diagnostics: 1; BY2FFO11FD019;
	1:O1lAQTDGUdvqbgaLUZTuPCFT8y1Yo633DHg6c3sq3TDlNpDuqoeDqSV2Og7GWedW0SJ0YQBcr8muNaQs9vlhF495X96aDfvzapYMVyGPpEtMNdu10OXDOVSpJMxvxOKPER4TRta8y7jhkh6FbYFWnfVqnLUS27C1S6HMo9awRFEJzQZl0uzkeR4sNOpa2HDvdLcp0dXx/CPu2cJmi16Tw8bE0eUEffO8hvc1OoueLyK8iW5ZkmYptNbp1/vwDM+dDi1/Jm5213fZFyKBSXnUvW3J7RZ+rhTQ4EtKjVS0u8MNhbUn75Oh0hRa+OrzfC9RTY/SRtN/WM6qvJCC7NGyZHwnUAlr/nw79Vi0CLm5+r8rTISX/U1NFfI8u5C2R1cARoUt4cMB7+4WRnhnZkm59P5C6lFhajXHBO9hGBX8D6ZSISOfCTvkaKSDitQnCVcALXynLIRnB2PZZgcEIpnuC6XpL2/Yvy+gbGp1m+x1zAbLjg08xi2G7i3f7w0Mr+Hy
X-MS-Office365-Filtering-Correlation-Id: 2e294be0-cf34-401c-26a8-08d44177f6c0
X-Microsoft-Antispam: UriScan:; BCL:0; PCL:0; RULEID:(22001)(8251501002);
	SRVR:CY1PR02MB1413; 
X-Microsoft-Exchange-Diagnostics: 1; CY1PR02MB1413;
	3:PQJoucBQUk6XtqCEzWK20LhoK7XdZ6r6pNF1mHDuEvuj0WyP2YHitSK0gEG85mpTLB7MzjBWB/M0KdUV5W2cxiT7noqy7aiu7POkEfEqxDOHOayoNqcpO0ks6m11FFboSKSa58rIWICMQ6LbQO4eGvuw94Eyy2Mm9v7wUfhleH8LnZATrge12UtRG6wy9HVygos4zUgt576DG/N5m58xWMNg9bac11rs6DaUi8hpJOHkutTRVKCOKVn+vnW9lB7mLkcG42lm1xkgssJnjGDNYiFumaooGmPF+Z8fqoqsJjI9zBc6Ifs5h4mT/yMrPGLJnwiTbU5ij5SWMq94nqJLezfpUMA9etNCvPpkuSv/lWBeZHxfMJbbuT9RUF5nR3h1K+sW5Rw5E/D6JfhG4wm1WA==
X-Microsoft-Exchange-Diagnostics: 1; CY1PR02MB1413;
	25:WsJ17PcHRRwKqNuDxdegLIkT+ijKHH2XBMUoNJ3h7IaOjm4Oix6+jfVcIgnB9Mtk0wyT+4XNz1nJfWUNFrsLkRHOOBthjy57nVtJnRAIt2Kk/+3X1887zy0k2oBCZ1QNHMTBWHRBqaFYety24Fkmbwr4J8EocCdfmiP6+thaz8D1zpbVkfvBaHtnIevc6yl/EphLLyYhZ8jm3ZH+qzI+ssrGeFiePw+BAYJGs/5BKbR7aAva3HVfXNzMdPXZtD6jWjvODF5BhH1hpFjlXEQ3lrH6U1EwMnACbuzUv+YuQdMJFNjy9zKoFp+FC4Do9AP0Y0TCWiqpA3LJlSXBTK5i/Nc/LGl6aZe6RN5am2m89FS1f+TP89DIvaOgALyYS+jkue0oRBBd232yLOLwn1hxouS/ktLUJj08NSTkpO8itSjUYHNuxaCC4dL0tg/QXUTOdmH0qHKiQy/6SvdwOjMiJlB8LU6IB+fFsVR5MdqhbycqrhOX7/YLLsVExDI/hgNGtG9wOxOfdY3ZGHk4CIl0ejz0Lh4yD1ydLg/yX47QCc4wkfNiJmglHYs/QSEmifjr4/dsIdsRlAUEZoIo93kLJcxwYrnRwZ+YhgYce1tt0pJE4onVXwKdFUJbUbtrRtEaz27/+pWa9WSGjz9Jw4x9S2QMpP95Ck0sq03RdEzy/cHrER1jXR+5E3J897yGkXO6d6U9N1N4HZeYa8LXDpmrraZOpCWRaLlrpsnNVHxqNWjD+HtZndHkK59OyHEc0z+Wu6k4gJwiDQgDxy0q6NcV1NpFwr0ldMdbe6TR9+njzjIGP7s0koKXEJMxKaBJVk+lzdUyhp6hF910N+I6ROIjEQ==
X-Microsoft-Exchange-Diagnostics: 1; CY1PR02MB1413;
	31:aih3wGkvDgMxkODeCIUK3Jhf8D6OxMRWras/uftApY2RMrmH+u8FZ5dLOQzwUjEddmuwKblbf4Ia+7cBVj+LlkSDAfg2EzZm1RDrJfeVKQ4oXQ1E2drYNzELEmvIUwMnVoCZaQcXWTcF9aSCvpaTfQr4+2YjdEJYX3vbhFeRIBXG0ddJa/Elry6vZ4MMZa7JeG15NfkAvz+EnwTKMEQvUaUxwmeqX4h27RR+uBwVYm6XSK/begIMw0iJZK6pH1uGymtlawAPWHOWOQJp24ZLLbAKog+t5jeAipHBf24H6GI=;
	20:sdhQ/PVwKR3ofWS9xfxJFvTjDMqIN0Upq3R6Zk2VDouv3Bn3duiCmj545kILAontLYIEuq/TiGOn956kJ9IOKN9eZRKys157R+351sLIQ4/fFSLxJ1L4Uz+65PxTun9+Vh+1X3T7uV/ilsrT9KPl+dfdXNKuaMkEdPOt+wXjP1xK2oVVk0roQKiIvMMMC1gThgzcM6fM1GZeKVdhzkVixUsVN74Q2I1PV9b+kslpuMEf+CzTw4pR6HHVJIRtOuaTLXdcTV2CMamrMcrwYcWCdD309cqpxy08flEvSn4qk/PuRw9bPI1yjQzr5Z/HIu1IYQCE8G96n4YhVn5Hlmey8HQwwrsf2hkEjpmmU2F0riudxj4n5bdaLKBxbVOEjTCdcXt/qk5GIVqFNYoZOuAK8SHNU08IbsF7sLxXRBSdcIK6fnVRIgxfGj6G4zYFy1Jl85CnNsCuKIe7Oe1hs1IrOSNWQrp98ME1pU5igtw4EoIzI0Q2XTJ46CMYn1LuIAWk
X-Microsoft-Antispam-PRVS: &lt;CY1PR02MB1413BFE9CC0960E2914A4CBC81710@CY1PR02MB1413.namprd02.prod.outlook.com&gt;
X-Exchange-Antispam-Report-Test: UriScan:(9452136761055)(146099531331640)(42932892334569); 
X-Exchange-Antispam-Report-CFA-Test: BCL:0; PCL:0;
	RULEID:(6040375)(601004)(2401047)(5005006)(8121501046)(13016025)(13018025)(10201501046)(3002001)(6055026)(6041248)(20161123560025)(20161123564025)(20161123562025)(20161123555025)(6072148);
	SRVR:CY1PR02MB1413; BCL:0; PCL:0; RULEID:; SRVR:CY1PR02MB1413;
X-Microsoft-Exchange-Diagnostics: 1; CY1PR02MB1413;
	4:5c6suo/xS9LaplFDLrP47k0OlXsHTvU7GEluS096Yox68n7Lgi/+MkHPbRBz8C2tfEfzGdaLLm4xaZjKatEmH9fHm+uwAmmUA2KttXo1FSvF77S3mJmIYS0efTrb0z8h09RGEHPsBCPHiiFwUfxRzDu1Ln9gYdVa14IUwcjVBGq8Xiidlao+215IOOIbiO/7pqp9u5xt7QCH6buSVMSbNlfqQdoGv5yQpPqDS/SKl9ybavgmmOTCS9PdjV2ETPS3hoHEq1ghBHi+LGjl5mHIAI/MWcJFxnzEQ1Qc42+aHW52/+uTMRnn2gWMVt8kxi7DLuai34YzqLbcbajtSAhQKCEBmQ/WLecrdyI+RpH+CzUDYHbVvRzBXC4+aZm92rZoNUzfHRNjDuj56aqFmOp3aVl+nMQXwKp+sUbHc6douU8INg4NKzSqE6oN1rEEYrCEhyOPa6e5A+wtyoBrxzFEmU1DerfZPhLCjJZFTXhYOeV/bToye41I9tABVnmDp+DjlyzSBvA0ur47/ujOOcdg/XnrmMm7TD090ASPffjA/XVBvLA4tcaEqW+63zVBV/cAUWnkAw2r/DIxEvj6CVO8MiYFBdsOCfVIDXjP6dSJCqwt0AzwC2AodRDdhFkoKfR02CtaF21gPcw85UdQrWVnwFFYDvL5vV7DOiqlT8AJj+7EPIYI+emrmWMIDMCekvZ1mOwh69AT00Dar5RXC4JFj9NFwHDY48JOMgSFUdZ8r88=
X-Forefront-PRVS: 01930B2BA8
X-Microsoft-Exchange-Diagnostics: =?us-ascii?Q?1; CY1PR02MB1413;
	23:KdNMO5DWcFTDxnwStuwn+8/k7tx2tya3TZrMbEwmZ?=
	=?us-ascii?Q?n8//yKz48GJDgkqCxSn9dU+N71KmqfoqDipdHHymckly6bltQz3Zb4PBWLn9?=
	=?us-ascii?Q?Z9TvJFO7ghCY5hZbL1SkuWd6oOn3+sTzs/jgiXAGwmdMu0u4HVXEak6Xm0lr?=
	=?us-ascii?Q?RYJsx73RKycQQZ4EvJ6dH8jlb/J34jfNQ0ZEweG4399zZHIqF4hUtLTHF1VQ?=
	=?us-ascii?Q?Jh6k11fveqvVvX2+8ZiVuk6tTjayVKLr7HeINzB4BWQF84WSiArBLkSvJL/B?=
	=?us-ascii?Q?Qk8zqUmuCp352R86PliVvR7FcIkkIbSfE0r/XcPuqExugBjj+3X97lKm2cQt?=
	=?us-ascii?Q?DxQGoz7fpi0LkhWFwkbhdEYkHJyhcS8UbvvI3Xbo+q5D7L73jSkJgv76kbVM?=
	=?us-ascii?Q?ElfjxNGVgnk4QqPmvr1R7oAkH83Smn40c9uVnXgAmd5CWfZcyJGEu9oPtB70?=
	=?us-ascii?Q?btjkMzBmKR6NixYt+6LOzKPopp8kMpxnGbrcQvOkVZfmq03wje6XdBKqUat4?=
	=?us-ascii?Q?isR8KQtZzajKSdQgPEPEV2Ip/GBXuc5y3k9qr/XIvHU/y0YgZ2UZCkJIKNha?=
	=?us-ascii?Q?zU42rJ8FwVCltP8NYuNkbDEOCl1mILxD0ZBi3RZu0ghK2nuHYay5vOp5BEvm?=
	=?us-ascii?Q?v2FWMB2CTY+snrMv7Z/NZD5zH/Apk6zlMEhth7t1qQlSxNgmiSujAmX2Whn3?=
	=?us-ascii?Q?zZ/G7JBfcRLv1T7lnxmCEW4/ygR06sqNT9ZH6nVNqL5DnBO3pI/5V8+CEvf4?=
	=?us-ascii?Q?SviOKQOzZVFjRQgyTwnx44mekGEQWVCmsKPLZhyeqbdvp3SPFsQwUoWpJoNi?=
	=?us-ascii?Q?8tUnm5xZF2opbjdjoPPc8kr60hPfbuT77vEd9axYx5MabPWVqSFKP/88k963?=
	=?us-ascii?Q?BkUX5IS9ScQC0EEzPSvGH3+uM8ZyCR30KuAgliuAr01W7BoaNylFfbhaP9sd?=
	=?us-ascii?Q?SuKPimtUX2ZfLoJ/6D0nbZ0o7EtA/Z0WdCKQOZZgv8AIT6na/fdnyuv1vV2k?=
	=?us-ascii?Q?OOYiu/q04r7LW9PQm3cvJZIK4mBV7QaZJS++nW6v2qYX69IC4nHBRcL1l1gB?=
	=?us-ascii?Q?66RO7amcr+6tyJYjMynyOmxSR/DtF95qtkpAXvH7pOf6Ze1/uXJhMRWYLqnz?=
	=?us-ascii?Q?uybooGZpmUzr4o+BKR4BRwJZsm4QKKDDfhOymFzARiqXmRLej6++k6gYXQgG?=
	=?us-ascii?Q?ePUL3BpPaOW12SYQHmgwt1BSGTdWpEo/XPR51wOBJxnKnk7Gy6NrkcCKg=3D?=
	=?us-ascii?Q?=3D?=
X-Microsoft-Exchange-Diagnostics: 1; CY1PR02MB1413;
	6:VSm3O56s5XzBCagnEHVBMULXmgPb8MZk5n4DntuaJT9cpsH9XxMLcPDEfYPc2M6nNj7W6aQUMB1TRJ0ua3aPwGqCHPKpsWheTT4KI+JgEZ8U0vy8Cpr0TvpkFYbG+Mj9I613MJWIRONhikOgXEghrEtk2uUeR0KRIZ3tZWksi0hl4R4XEELrYe4TABzRFKu9BoPZ3Yp1S5+8xdlYX3QBxV1aClrI6ykjCxzBhSe5PQl0T9QRwBCUNj2gjsRGkRaHRIzl0kRoAaw6hB5DBDOmUTJxqoHf+Zt0HCHTXflKfPfvprZ0dgtRSJ4vqNa51l91kqSoMivSV+PByGrUcJl0zmzGjeMF8Txtw32k5d5JSVx2o21OuedfuWSQRJrN+0BBbbqmpSrCCV5YFBVai7thtyv6isligNwgUXX1/J7l5DPO4mlIkdsUOH/Sip2qD6XPXlyH/VdMmTVLxT2gO4SYRA==;
	5:+GlUPXc6WX60+ae6YI4cD2eEZEXG+ddiT5hxLFYgJwhDHmDzQ4PoNBdwdQeFGpgCzT250sJVbeOtatuAZ7F+/yMEoXr4Se4eJhxA8QK4lRX/ovItGnid+4Yv+VqBhH97fm0f02KxagWGYW9iNYY+mA==;
	24:ZfDbC03tYF1DfUT/4v6uMTX0Tk4XDb4MwCsHf0ml/ggd9MbTPiW505qYHnZAvr2J/tBdLoLXrQml1GLPEz62+VfHvdXKPahEPachY/4o+0c=
SpamDiagnosticOutput: 1:99
SpamDiagnosticMetadata: NSPM
X-Microsoft-Exchange-Diagnostics: 1; CY1PR02MB1413;
	7:ZBMkIPGWp2QD0SmpYTBgwNSg0RPGbtjuTd0Q9OQY3Dfg2aBm01s3Zzu9KZ6m3Qf64KWfgZEyITtrbkTFS3VSuGHQWsRnUbaJ5Vb1AsqS0N2KQ17Go6RlcaLJWJtc8rHcEqmYG2AchzdBdObJfpbDRuazXQ2YEV38udf9t4tCenDpecgXCxUXP+5g7hpOJ3vLO8vUjzGbwtci23XK+DqhkVqzZCrZWzT7zC6wgP779TjqEVNVL/9J32pRViRkJypSbVWU6fEtUzcx8vWtrHO8MWoOVweOSeDjPPsNmyfvc7LytWAFkSIKMyzYzZU2K2KZdr/BMe7qHW9UvTQHG1VYZxfwZSXyS1s8ewFb1ghSUP6EsVI4ruisq9mtpv7wGEGIv++pTpni/N8ULAuqeI/aALIXXJIyDEVqQOtTYtA6/wyvqVLVV6YhDa0gbGszsHloY0rvTVoeIn0Ko4Uvf6WbeA==
X-OriginatorOrg: sandisk.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 20 Jan 2017 21:04:46.1692
	(UTC)
X-MS-Exchange-CrossTenant-Id: fcd9ea9c-ae8c-460c-ab3c-3db42d7ac64d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=fcd9ea9c-ae8c-460c-ab3c-3db42d7ac64d;
	Ip=[63.163.107.225]; Helo=[milsmgep14.sandisk.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: CY1PR02MB1413
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: &lt;linux-kernel.vger.kernel.org&gt;
X-Mailing-List: linux-kernel@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP
</pre>
   </div>
  </td>
 </tr>
</table>

<div class="patchforms">





 <div style="clear: both;">
 </div>
</div>



<h2>Comments</h2>

<div class="comment">
<div class="meta"><a href="/project/LKML/list/?submitter=119921">Bart Van Assche</a> - Jan. 20, 2017, 9:04 p.m.</div>
<pre class="content">
Some but not all architectures provide set_dma_ops(). Move dma_ops
from struct dev_archdata into struct device such that it becomes
possible on all architectures to configure dma_ops per device.
<span class="signed-off-by">
Signed-off-by: Bart Van Assche &lt;bart.vanassche@sandisk.com&gt;</span>
<span class="acked-by">Acked-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;</span>
Cc: Benjamin Herrenschmidt &lt;benh@kernel.crashing.org&gt;
Cc: Boris Ostrovsky &lt;boris.ostrovsky@oracle.com&gt;
Cc: David Woodhouse &lt;dwmw2@infradead.org&gt;
Cc: Juergen Gross &lt;jgross@suse.com&gt;
Cc: H. Peter Anvin &lt;hpa@zytor.com&gt;
Cc: Ingo Molnar &lt;mingo@redhat.com&gt;
Cc: linux-arch@vger.kernel.org
Cc: linux-kernel@vger.kernel.org
Cc: Russell King &lt;linux@armlinux.org.uk&gt;
Cc: x86@kernel.org
---
 arch/arm/include/asm/device.h            | 1 -
 arch/arm/include/asm/dma-mapping.h       | 6 +++---
 arch/arm64/include/asm/device.h          | 1 -
 arch/arm64/include/asm/dma-mapping.h     | 4 ++--
 arch/arm64/mm/dma-mapping.c              | 8 ++++----
 arch/m32r/include/asm/device.h           | 1 -
 arch/m32r/include/asm/dma-mapping.h      | 4 ++--
 arch/mips/include/asm/device.h           | 5 -----
 arch/mips/include/asm/dma-mapping.h      | 4 ++--
 arch/mips/pci/pci-octeon.c               | 2 +-
 arch/powerpc/include/asm/device.h        | 4 ----
 arch/powerpc/include/asm/dma-mapping.h   | 4 ++--
 arch/powerpc/kernel/dma.c                | 2 +-
 arch/powerpc/platforms/cell/iommu.c      | 2 +-
 arch/powerpc/platforms/pasemi/iommu.c    | 2 +-
 arch/powerpc/platforms/pasemi/setup.c    | 2 +-
 arch/powerpc/platforms/ps3/system-bus.c  | 4 ++--
 arch/powerpc/platforms/pseries/ibmebus.c | 2 +-
 arch/s390/include/asm/device.h           | 1 -
 arch/s390/include/asm/dma-mapping.h      | 4 ++--
 arch/s390/pci/pci.c                      | 2 +-
 arch/tile/include/asm/device.h           | 3 ---
 arch/tile/include/asm/dma-mapping.h      | 6 +++---
 arch/x86/include/asm/device.h            | 3 ---
 arch/x86/include/asm/dma-mapping.h       | 4 ++--
 arch/x86/kernel/pci-calgary_64.c         | 4 ++--
 arch/x86/pci/common.c                    | 2 +-
 arch/x86/pci/sta2x11-fixup.c             | 8 ++++----
 arch/xtensa/include/asm/device.h         | 4 ----
 arch/xtensa/include/asm/dma-mapping.h    | 4 ++--
 drivers/infiniband/ulp/srpt/ib_srpt.c    | 2 +-
 drivers/iommu/amd_iommu.c                | 6 +++---
 drivers/misc/mic/bus/mic_bus.c           | 2 +-
 drivers/misc/mic/bus/scif_bus.c          | 2 +-
 drivers/misc/mic/bus/vop_bus.c           | 2 +-
 include/linux/device.h                   | 1 +
 36 files changed, 48 insertions(+), 70 deletions(-)
</pre>
</div>



<h2>Patch</h2>
<div class="patch">
<pre class="content">
<span class="p_header">diff --git a/arch/arm/include/asm/device.h b/arch/arm/include/asm/device.h</span>
<span class="p_header">index d8a572f9c187..220ba207be91 100644</span>
<span class="p_header">--- a/arch/arm/include/asm/device.h</span>
<span class="p_header">+++ b/arch/arm/include/asm/device.h</span>
<span class="p_chunk">@@ -7,7 +7,6 @@</span> <span class="p_context"></span>
 #define ASMARM_DEVICE_H
 
 struct dev_archdata {
<span class="p_del">-	const struct dma_map_ops	*dma_ops;</span>
 #ifdef CONFIG_DMABOUNCE
 	struct dmabounce_device_info *dmabounce;
 #endif
<span class="p_header">diff --git a/arch/arm/include/asm/dma-mapping.h b/arch/arm/include/asm/dma-mapping.h</span>
<span class="p_header">index 1aabd781306f..312f4d0564d6 100644</span>
<span class="p_header">--- a/arch/arm/include/asm/dma-mapping.h</span>
<span class="p_header">+++ b/arch/arm/include/asm/dma-mapping.h</span>
<span class="p_chunk">@@ -18,8 +18,8 @@</span> <span class="p_context"> extern const struct dma_map_ops arm_coherent_dma_ops;</span>
 
 static inline const struct dma_map_ops *__generic_dma_ops(struct device *dev)
 {
<span class="p_del">-	if (dev &amp;&amp; dev-&gt;archdata.dma_ops)</span>
<span class="p_del">-		return dev-&gt;archdata.dma_ops;</span>
<span class="p_add">+	if (dev &amp;&amp; dev-&gt;dma_ops)</span>
<span class="p_add">+		return dev-&gt;dma_ops;</span>
 	return &amp;arm_dma_ops;
 }
 
<span class="p_chunk">@@ -34,7 +34,7 @@</span> <span class="p_context"> static inline const struct dma_map_ops *get_dma_ops(struct device *dev)</span>
 static inline void set_dma_ops(struct device *dev, const struct dma_map_ops *ops)
 {
 	BUG_ON(!dev);
<span class="p_del">-	dev-&gt;archdata.dma_ops = ops;</span>
<span class="p_add">+	dev-&gt;dma_ops = ops;</span>
 }
 
 #define HAVE_ARCH_DMA_SUPPORTED 1
<span class="p_header">diff --git a/arch/arm64/include/asm/device.h b/arch/arm64/include/asm/device.h</span>
<span class="p_header">index 00c678cc31e1..73d5bab015eb 100644</span>
<span class="p_header">--- a/arch/arm64/include/asm/device.h</span>
<span class="p_header">+++ b/arch/arm64/include/asm/device.h</span>
<span class="p_chunk">@@ -17,7 +17,6 @@</span> <span class="p_context"></span>
 #define __ASM_DEVICE_H
 
 struct dev_archdata {
<span class="p_del">-	const struct dma_map_ops *dma_ops;</span>
 #ifdef CONFIG_IOMMU_API
 	void *iommu;			/* private IOMMU data */
 #endif
<span class="p_header">diff --git a/arch/arm64/include/asm/dma-mapping.h b/arch/arm64/include/asm/dma-mapping.h</span>
<span class="p_header">index 1fedb43be712..58ae36cc3b60 100644</span>
<span class="p_header">--- a/arch/arm64/include/asm/dma-mapping.h</span>
<span class="p_header">+++ b/arch/arm64/include/asm/dma-mapping.h</span>
<span class="p_chunk">@@ -29,8 +29,8 @@</span> <span class="p_context"> extern const struct dma_map_ops dummy_dma_ops;</span>
 
 static inline const struct dma_map_ops *__generic_dma_ops(struct device *dev)
 {
<span class="p_del">-	if (dev &amp;&amp; dev-&gt;archdata.dma_ops)</span>
<span class="p_del">-		return dev-&gt;archdata.dma_ops;</span>
<span class="p_add">+	if (dev &amp;&amp; dev-&gt;dma_ops)</span>
<span class="p_add">+		return dev-&gt;dma_ops;</span>
 
 	/*
 	 * We expect no ISA devices, and all other DMA masters are expected to
<span class="p_header">diff --git a/arch/arm64/mm/dma-mapping.c b/arch/arm64/mm/dma-mapping.c</span>
<span class="p_header">index bcef6368d48f..dbab4c6c084b 100644</span>
<span class="p_header">--- a/arch/arm64/mm/dma-mapping.c</span>
<span class="p_header">+++ b/arch/arm64/mm/dma-mapping.c</span>
<span class="p_chunk">@@ -837,7 +837,7 @@</span> <span class="p_context"> static bool do_iommu_attach(struct device *dev, const struct iommu_ops *ops,</span>
 		return false;
 	}
 
<span class="p_del">-	dev-&gt;archdata.dma_ops = &amp;iommu_dma_ops;</span>
<span class="p_add">+	dev-&gt;dma_ops = &amp;iommu_dma_ops;</span>
 	return true;
 }
 
<span class="p_chunk">@@ -941,7 +941,7 @@</span> <span class="p_context"> static void __iommu_setup_dma_ops(struct device *dev, u64 dma_base, u64 size,</span>
 
 void arch_teardown_dma_ops(struct device *dev)
 {
<span class="p_del">-	dev-&gt;archdata.dma_ops = NULL;</span>
<span class="p_add">+	dev-&gt;dma_ops = NULL;</span>
 }
 
 #else
<span class="p_chunk">@@ -955,8 +955,8 @@</span> <span class="p_context"> static void __iommu_setup_dma_ops(struct device *dev, u64 dma_base, u64 size,</span>
 void arch_setup_dma_ops(struct device *dev, u64 dma_base, u64 size,
 			const struct iommu_ops *iommu, bool coherent)
 {
<span class="p_del">-	if (!dev-&gt;archdata.dma_ops)</span>
<span class="p_del">-		dev-&gt;archdata.dma_ops = &amp;swiotlb_dma_ops;</span>
<span class="p_add">+	if (!dev-&gt;dma_ops)</span>
<span class="p_add">+		dev-&gt;dma_ops = &amp;swiotlb_dma_ops;</span>
 
 	dev-&gt;archdata.dma_coherent = coherent;
 	__iommu_setup_dma_ops(dev, dma_base, size, iommu);
<span class="p_header">diff --git a/arch/m32r/include/asm/device.h b/arch/m32r/include/asm/device.h</span>
<span class="p_header">index 7955a9799466..5203fc87f080 100644</span>
<span class="p_header">--- a/arch/m32r/include/asm/device.h</span>
<span class="p_header">+++ b/arch/m32r/include/asm/device.h</span>
<span class="p_chunk">@@ -4,7 +4,6 @@</span> <span class="p_context"></span>
  * This file is released under the GPLv2
  */
 struct dev_archdata {
<span class="p_del">-	const struct dma_map_ops *dma_ops;</span>
 };
 
 struct pdev_archdata {
<span class="p_header">diff --git a/arch/m32r/include/asm/dma-mapping.h b/arch/m32r/include/asm/dma-mapping.h</span>
<span class="p_header">index 99c43d2f05dc..27b1597ac563 100644</span>
<span class="p_header">--- a/arch/m32r/include/asm/dma-mapping.h</span>
<span class="p_header">+++ b/arch/m32r/include/asm/dma-mapping.h</span>
<span class="p_chunk">@@ -12,8 +12,8 @@</span> <span class="p_context"></span>
 
 static inline const struct dma_map_ops *get_dma_ops(struct device *dev)
 {
<span class="p_del">-	if (dev &amp;&amp; dev-&gt;archdata.dma_ops)</span>
<span class="p_del">-		return dev-&gt;archdata.dma_ops;</span>
<span class="p_add">+	if (dev &amp;&amp; dev-&gt;dma_ops)</span>
<span class="p_add">+		return dev-&gt;dma_ops;</span>
 	return &amp;dma_noop_ops;
 }
 
<span class="p_header">diff --git a/arch/mips/include/asm/device.h b/arch/mips/include/asm/device.h</span>
<span class="p_header">index ebc5c1265473..6aa796f1081a 100644</span>
<span class="p_header">--- a/arch/mips/include/asm/device.h</span>
<span class="p_header">+++ b/arch/mips/include/asm/device.h</span>
<span class="p_chunk">@@ -6,12 +6,7 @@</span> <span class="p_context"></span>
 #ifndef _ASM_MIPS_DEVICE_H
 #define _ASM_MIPS_DEVICE_H
 
<span class="p_del">-struct dma_map_ops;</span>
<span class="p_del">-</span>
 struct dev_archdata {
<span class="p_del">-	/* DMA operations on that device */</span>
<span class="p_del">-	const struct dma_map_ops *dma_ops;</span>
<span class="p_del">-</span>
 #ifdef CONFIG_DMA_PERDEV_COHERENT
 	/* Non-zero if DMA is coherent with CPU caches */
 	bool dma_coherent;
<span class="p_header">diff --git a/arch/mips/include/asm/dma-mapping.h b/arch/mips/include/asm/dma-mapping.h</span>
<span class="p_header">index b59b084a7569..dad3b09fe993 100644</span>
<span class="p_header">--- a/arch/mips/include/asm/dma-mapping.h</span>
<span class="p_header">+++ b/arch/mips/include/asm/dma-mapping.h</span>
<span class="p_chunk">@@ -13,8 +13,8 @@</span> <span class="p_context"> extern const struct dma_map_ops *mips_dma_map_ops;</span>
 
 static inline const struct dma_map_ops *get_dma_ops(struct device *dev)
 {
<span class="p_del">-	if (dev &amp;&amp; dev-&gt;archdata.dma_ops)</span>
<span class="p_del">-		return dev-&gt;archdata.dma_ops;</span>
<span class="p_add">+	if (dev &amp;&amp; dev-&gt;dma_ops)</span>
<span class="p_add">+		return dev-&gt;dma_ops;</span>
 	else
 		return mips_dma_map_ops;
 }
<span class="p_header">diff --git a/arch/mips/pci/pci-octeon.c b/arch/mips/pci/pci-octeon.c</span>
<span class="p_header">index 308d051fc45c..9ee01936862e 100644</span>
<span class="p_header">--- a/arch/mips/pci/pci-octeon.c</span>
<span class="p_header">+++ b/arch/mips/pci/pci-octeon.c</span>
<span class="p_chunk">@@ -167,7 +167,7 @@</span> <span class="p_context"> int pcibios_plat_dev_init(struct pci_dev *dev)</span>
 		pci_write_config_dword(dev, pos + PCI_ERR_ROOT_STATUS, dconfig);
 	}
 
<span class="p_del">-	dev-&gt;dev.archdata.dma_ops = octeon_pci_dma_map_ops;</span>
<span class="p_add">+	dev-&gt;dev.dma_ops = octeon_pci_dma_map_ops;</span>
 
 	return 0;
 }
<span class="p_header">diff --git a/arch/powerpc/include/asm/device.h b/arch/powerpc/include/asm/device.h</span>
<span class="p_header">index 49cbb0fca233..0245bfcaac32 100644</span>
<span class="p_header">--- a/arch/powerpc/include/asm/device.h</span>
<span class="p_header">+++ b/arch/powerpc/include/asm/device.h</span>
<span class="p_chunk">@@ -6,7 +6,6 @@</span> <span class="p_context"></span>
 #ifndef _ASM_POWERPC_DEVICE_H
 #define _ASM_POWERPC_DEVICE_H
 
<span class="p_del">-struct dma_map_ops;</span>
 struct device_node;
 #ifdef CONFIG_PPC64
 struct pci_dn;
<span class="p_chunk">@@ -20,9 +19,6 @@</span> <span class="p_context"> struct iommu_table;</span>
  * drivers/macintosh/macio_asic.c
  */
 struct dev_archdata {
<span class="p_del">-	/* DMA operations on that device */</span>
<span class="p_del">-	const struct dma_map_ops	*dma_ops;</span>
<span class="p_del">-</span>
 	/*
 	 * These two used to be a union. However, with the hybrid ops we need
 	 * both so here we store both a DMA offset for direct mappings and
<span class="p_header">diff --git a/arch/powerpc/include/asm/dma-mapping.h b/arch/powerpc/include/asm/dma-mapping.h</span>
<span class="p_header">index 2ec3eadf336f..59fbd4abcbf8 100644</span>
<span class="p_header">--- a/arch/powerpc/include/asm/dma-mapping.h</span>
<span class="p_header">+++ b/arch/powerpc/include/asm/dma-mapping.h</span>
<span class="p_chunk">@@ -88,12 +88,12 @@</span> <span class="p_context"> static inline const struct dma_map_ops *get_dma_ops(struct device *dev)</span>
 	if (unlikely(dev == NULL))
 		return NULL;
 
<span class="p_del">-	return dev-&gt;archdata.dma_ops;</span>
<span class="p_add">+	return dev-&gt;dma_ops;</span>
 }
 
 static inline void set_dma_ops(struct device *dev, const struct dma_map_ops *ops)
 {
<span class="p_del">-	dev-&gt;archdata.dma_ops = ops;</span>
<span class="p_add">+	dev-&gt;dma_ops = ops;</span>
 }
 
 /*
<span class="p_header">diff --git a/arch/powerpc/kernel/dma.c b/arch/powerpc/kernel/dma.c</span>
<span class="p_header">index 03b98f1f98ec..41c749586bd2 100644</span>
<span class="p_header">--- a/arch/powerpc/kernel/dma.c</span>
<span class="p_header">+++ b/arch/powerpc/kernel/dma.c</span>
<span class="p_chunk">@@ -33,7 +33,7 @@</span> <span class="p_context"> static u64 __maybe_unused get_pfn_limit(struct device *dev)</span>
 	struct dev_archdata __maybe_unused *sd = &amp;dev-&gt;archdata;
 
 #ifdef CONFIG_SWIOTLB
<span class="p_del">-	if (sd-&gt;max_direct_dma_addr &amp;&amp; sd-&gt;dma_ops == &amp;swiotlb_dma_ops)</span>
<span class="p_add">+	if (sd-&gt;max_direct_dma_addr &amp;&amp; dev-&gt;dma_ops == &amp;swiotlb_dma_ops)</span>
 		pfn = min_t(u64, pfn, sd-&gt;max_direct_dma_addr &gt;&gt; PAGE_SHIFT);
 #endif
 
<span class="p_header">diff --git a/arch/powerpc/platforms/cell/iommu.c b/arch/powerpc/platforms/cell/iommu.c</span>
<span class="p_header">index e1413e69e5fe..71b995bbcae0 100644</span>
<span class="p_header">--- a/arch/powerpc/platforms/cell/iommu.c</span>
<span class="p_header">+++ b/arch/powerpc/platforms/cell/iommu.c</span>
<span class="p_chunk">@@ -692,7 +692,7 @@</span> <span class="p_context"> static int cell_of_bus_notify(struct notifier_block *nb, unsigned long action,</span>
 		return 0;
 
 	/* We use the PCI DMA ops */
<span class="p_del">-	dev-&gt;archdata.dma_ops = get_pci_dma_ops();</span>
<span class="p_add">+	dev-&gt;dma_ops = get_pci_dma_ops();</span>
 
 	cell_dma_dev_setup(dev);
 
<span class="p_header">diff --git a/arch/powerpc/platforms/pasemi/iommu.c b/arch/powerpc/platforms/pasemi/iommu.c</span>
<span class="p_header">index e74adc4e7fd8..7fec04de27fc 100644</span>
<span class="p_header">--- a/arch/powerpc/platforms/pasemi/iommu.c</span>
<span class="p_header">+++ b/arch/powerpc/platforms/pasemi/iommu.c</span>
<span class="p_chunk">@@ -186,7 +186,7 @@</span> <span class="p_context"> static void pci_dma_dev_setup_pasemi(struct pci_dev *dev)</span>
 	 */
 	if (dev-&gt;vendor == 0x1959 &amp;&amp; dev-&gt;device == 0xa007 &amp;&amp;
 	    !firmware_has_feature(FW_FEATURE_LPAR)) {
<span class="p_del">-		dev-&gt;dev.archdata.dma_ops = &amp;dma_direct_ops;</span>
<span class="p_add">+		dev-&gt;dev.dma_ops = &amp;dma_direct_ops;</span>
 		/*
 		 * Set the coherent DMA mask to prevent the iommu
 		 * being used unnecessarily
<span class="p_header">diff --git a/arch/powerpc/platforms/pasemi/setup.c b/arch/powerpc/platforms/pasemi/setup.c</span>
<span class="p_header">index 3182400cf48f..c4a3e93dc324 100644</span>
<span class="p_header">--- a/arch/powerpc/platforms/pasemi/setup.c</span>
<span class="p_header">+++ b/arch/powerpc/platforms/pasemi/setup.c</span>
<span class="p_chunk">@@ -363,7 +363,7 @@</span> <span class="p_context"> static int pcmcia_notify(struct notifier_block *nb, unsigned long action,</span>
 		return 0;
 
 	/* We use the direct ops for localbus */
<span class="p_del">-	dev-&gt;archdata.dma_ops = &amp;dma_direct_ops;</span>
<span class="p_add">+	dev-&gt;dma_ops = &amp;dma_direct_ops;</span>
 
 	return 0;
 }
<span class="p_header">diff --git a/arch/powerpc/platforms/ps3/system-bus.c b/arch/powerpc/platforms/ps3/system-bus.c</span>
<span class="p_header">index c81450d98794..2d2e5f80a3d3 100644</span>
<span class="p_header">--- a/arch/powerpc/platforms/ps3/system-bus.c</span>
<span class="p_header">+++ b/arch/powerpc/platforms/ps3/system-bus.c</span>
<span class="p_chunk">@@ -756,11 +756,11 @@</span> <span class="p_context"> int ps3_system_bus_device_register(struct ps3_system_bus_device *dev)</span>
 
 	switch (dev-&gt;dev_type) {
 	case PS3_DEVICE_TYPE_IOC0:
<span class="p_del">-		dev-&gt;core.archdata.dma_ops = &amp;ps3_ioc0_dma_ops;</span>
<span class="p_add">+		dev-&gt;core.dma_ops = &amp;ps3_ioc0_dma_ops;</span>
 		dev_set_name(&amp;dev-&gt;core, &quot;ioc0_%02x&quot;, ++dev_ioc0_count);
 		break;
 	case PS3_DEVICE_TYPE_SB:
<span class="p_del">-		dev-&gt;core.archdata.dma_ops = &amp;ps3_sb_dma_ops;</span>
<span class="p_add">+		dev-&gt;core.dma_ops = &amp;ps3_sb_dma_ops;</span>
 		dev_set_name(&amp;dev-&gt;core, &quot;sb_%02x&quot;, ++dev_sb_count);
 
 		break;
<span class="p_header">diff --git a/arch/powerpc/platforms/pseries/ibmebus.c b/arch/powerpc/platforms/pseries/ibmebus.c</span>
<span class="p_header">index 2e36a0b8944a..99a6bf7f3bcf 100644</span>
<span class="p_header">--- a/arch/powerpc/platforms/pseries/ibmebus.c</span>
<span class="p_header">+++ b/arch/powerpc/platforms/pseries/ibmebus.c</span>
<span class="p_chunk">@@ -169,7 +169,7 @@</span> <span class="p_context"> static int ibmebus_create_device(struct device_node *dn)</span>
 		return -ENOMEM;
 
 	dev-&gt;dev.bus = &amp;ibmebus_bus_type;
<span class="p_del">-	dev-&gt;dev.archdata.dma_ops = &amp;ibmebus_dma_ops;</span>
<span class="p_add">+	dev-&gt;dev.dma_ops = &amp;ibmebus_dma_ops;</span>
 
 	ret = of_device_add(dev);
 	if (ret)
<span class="p_header">diff --git a/arch/s390/include/asm/device.h b/arch/s390/include/asm/device.h</span>
<span class="p_header">index 7955a9799466..5203fc87f080 100644</span>
<span class="p_header">--- a/arch/s390/include/asm/device.h</span>
<span class="p_header">+++ b/arch/s390/include/asm/device.h</span>
<span class="p_chunk">@@ -4,7 +4,6 @@</span> <span class="p_context"></span>
  * This file is released under the GPLv2
  */
 struct dev_archdata {
<span class="p_del">-	const struct dma_map_ops *dma_ops;</span>
 };
 
 struct pdev_archdata {
<span class="p_header">diff --git a/arch/s390/include/asm/dma-mapping.h b/arch/s390/include/asm/dma-mapping.h</span>
<span class="p_header">index 2776d205b1ff..a872027d0c1b 100644</span>
<span class="p_header">--- a/arch/s390/include/asm/dma-mapping.h</span>
<span class="p_header">+++ b/arch/s390/include/asm/dma-mapping.h</span>
<span class="p_chunk">@@ -14,8 +14,8 @@</span> <span class="p_context"> extern const struct dma_map_ops s390_pci_dma_ops;</span>
 
 static inline const struct dma_map_ops *get_dma_ops(struct device *dev)
 {
<span class="p_del">-	if (dev &amp;&amp; dev-&gt;archdata.dma_ops)</span>
<span class="p_del">-		return dev-&gt;archdata.dma_ops;</span>
<span class="p_add">+	if (dev &amp;&amp; dev-&gt;dma_ops)</span>
<span class="p_add">+		return dev-&gt;dma_ops;</span>
 	return &amp;dma_noop_ops;
 }
 
<span class="p_header">diff --git a/arch/s390/pci/pci.c b/arch/s390/pci/pci.c</span>
<span class="p_header">index 38e17d4d9884..82abef8b8574 100644</span>
<span class="p_header">--- a/arch/s390/pci/pci.c</span>
<span class="p_header">+++ b/arch/s390/pci/pci.c</span>
<span class="p_chunk">@@ -641,7 +641,7 @@</span> <span class="p_context"> int pcibios_add_device(struct pci_dev *pdev)</span>
 	int i;
 
 	pdev-&gt;dev.groups = zpci_attr_groups;
<span class="p_del">-	pdev-&gt;dev.archdata.dma_ops = &amp;s390_pci_dma_ops;</span>
<span class="p_add">+	pdev-&gt;dev.dma_ops = &amp;s390_pci_dma_ops;</span>
 	zpci_map_resources(pdev);
 
 	for (i = 0; i &lt; PCI_BAR_COUNT; i++) {
<span class="p_header">diff --git a/arch/tile/include/asm/device.h b/arch/tile/include/asm/device.h</span>
<span class="p_header">index 25f23ac7d361..1cf45422a0df 100644</span>
<span class="p_header">--- a/arch/tile/include/asm/device.h</span>
<span class="p_header">+++ b/arch/tile/include/asm/device.h</span>
<span class="p_chunk">@@ -17,9 +17,6 @@</span> <span class="p_context"></span>
 #define _ASM_TILE_DEVICE_H
 
 struct dev_archdata {
<span class="p_del">-	/* DMA operations on that device */</span>
<span class="p_del">-        const struct dma_map_ops	*dma_ops;</span>
<span class="p_del">-</span>
 	/* Offset of the DMA address from the PA. */
 	dma_addr_t		dma_offset;
 
<span class="p_header">diff --git a/arch/tile/include/asm/dma-mapping.h b/arch/tile/include/asm/dma-mapping.h</span>
<span class="p_header">index 4a06cc75b856..c0620697eaad 100644</span>
<span class="p_header">--- a/arch/tile/include/asm/dma-mapping.h</span>
<span class="p_header">+++ b/arch/tile/include/asm/dma-mapping.h</span>
<span class="p_chunk">@@ -31,8 +31,8 @@</span> <span class="p_context"> extern const struct dma_map_ops *gx_hybrid_pci_dma_map_ops;</span>
 
 static inline const struct dma_map_ops *get_dma_ops(struct device *dev)
 {
<span class="p_del">-	if (dev &amp;&amp; dev-&gt;archdata.dma_ops)</span>
<span class="p_del">-		return dev-&gt;archdata.dma_ops;</span>
<span class="p_add">+	if (dev &amp;&amp; dev-&gt;dma_ops)</span>
<span class="p_add">+		return dev-&gt;dma_ops;</span>
 	else
 		return tile_dma_map_ops;
 }
<span class="p_chunk">@@ -61,7 +61,7 @@</span> <span class="p_context"> static inline void dma_mark_clean(void *addr, size_t size) {}</span>
 
 static inline void set_dma_ops(struct device *dev, const struct dma_map_ops *ops)
 {
<span class="p_del">-	dev-&gt;archdata.dma_ops = ops;</span>
<span class="p_add">+	dev-&gt;dma_ops = ops;</span>
 }
 
 static inline bool dma_capable(struct device *dev, dma_addr_t addr, size_t size)
<span class="p_header">diff --git a/arch/x86/include/asm/device.h b/arch/x86/include/asm/device.h</span>
<span class="p_header">index b2d0b4ced7e3..1b3ef26e77df 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/device.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/device.h</span>
<span class="p_chunk">@@ -2,9 +2,6 @@</span> <span class="p_context"></span>
 #define _ASM_X86_DEVICE_H
 
 struct dev_archdata {
<span class="p_del">-#ifdef CONFIG_X86_DEV_DMA_OPS</span>
<span class="p_del">-	const struct dma_map_ops *dma_ops;</span>
<span class="p_del">-#endif</span>
 #if defined(CONFIG_INTEL_IOMMU) || defined(CONFIG_AMD_IOMMU)
 	void *iommu; /* hook for IOMMU specific extension */
 #endif
<span class="p_header">diff --git a/arch/x86/include/asm/dma-mapping.h b/arch/x86/include/asm/dma-mapping.h</span>
<span class="p_header">index 5e4772886a1e..94b5b96966cb 100644</span>
<span class="p_header">--- a/arch/x86/include/asm/dma-mapping.h</span>
<span class="p_header">+++ b/arch/x86/include/asm/dma-mapping.h</span>
<span class="p_chunk">@@ -32,10 +32,10 @@</span> <span class="p_context"> static inline const struct dma_map_ops *get_dma_ops(struct device *dev)</span>
 #ifndef CONFIG_X86_DEV_DMA_OPS
 	return dma_ops;
 #else
<span class="p_del">-	if (unlikely(!dev) || !dev-&gt;archdata.dma_ops)</span>
<span class="p_add">+	if (unlikely(!dev) || !dev-&gt;dma_ops)</span>
 		return dma_ops;
 	else
<span class="p_del">-		return dev-&gt;archdata.dma_ops;</span>
<span class="p_add">+		return dev-&gt;dma_ops;</span>
 #endif
 }
 
<span class="p_header">diff --git a/arch/x86/kernel/pci-calgary_64.c b/arch/x86/kernel/pci-calgary_64.c</span>
<span class="p_header">index 17f180148c80..5070320780c6 100644</span>
<span class="p_header">--- a/arch/x86/kernel/pci-calgary_64.c</span>
<span class="p_header">+++ b/arch/x86/kernel/pci-calgary_64.c</span>
<span class="p_chunk">@@ -1177,7 +1177,7 @@</span> <span class="p_context"> static int __init calgary_init(void)</span>
 		tbl = find_iommu_table(&amp;dev-&gt;dev);
 
 		if (translation_enabled(tbl))
<span class="p_del">-			dev-&gt;dev.archdata.dma_ops = &amp;calgary_dma_ops;</span>
<span class="p_add">+			dev-&gt;dev.dma_ops = &amp;calgary_dma_ops;</span>
 	}
 
 	return ret;
<span class="p_chunk">@@ -1201,7 +1201,7 @@</span> <span class="p_context"> static int __init calgary_init(void)</span>
 		calgary_disable_translation(dev);
 		calgary_free_bus(dev);
 		pci_dev_put(dev); /* Undo calgary_init_one()&#39;s pci_dev_get() */
<span class="p_del">-		dev-&gt;dev.archdata.dma_ops = NULL;</span>
<span class="p_add">+		dev-&gt;dev.dma_ops = NULL;</span>
 	} while (1);
 
 	return ret;
<span class="p_header">diff --git a/arch/x86/pci/common.c b/arch/x86/pci/common.c</span>
<span class="p_header">index a4fdfa7dcc1b..0cb52ae0a8f0 100644</span>
<span class="p_header">--- a/arch/x86/pci/common.c</span>
<span class="p_header">+++ b/arch/x86/pci/common.c</span>
<span class="p_chunk">@@ -667,7 +667,7 @@</span> <span class="p_context"> static void set_dma_domain_ops(struct pci_dev *pdev)</span>
 	spin_lock(&amp;dma_domain_list_lock);
 	list_for_each_entry(domain, &amp;dma_domain_list, node) {
 		if (pci_domain_nr(pdev-&gt;bus) == domain-&gt;domain_nr) {
<span class="p_del">-			pdev-&gt;dev.archdata.dma_ops = domain-&gt;dma_ops;</span>
<span class="p_add">+			pdev-&gt;dev.dma_ops = domain-&gt;dma_ops;</span>
 			break;
 		}
 	}
<span class="p_header">diff --git a/arch/x86/pci/sta2x11-fixup.c b/arch/x86/pci/sta2x11-fixup.c</span>
<span class="p_header">index aa3828823170..ec008e800b45 100644</span>
<span class="p_header">--- a/arch/x86/pci/sta2x11-fixup.c</span>
<span class="p_header">+++ b/arch/x86/pci/sta2x11-fixup.c</span>
<span class="p_chunk">@@ -203,7 +203,7 @@</span> <span class="p_context"> static void sta2x11_setup_pdev(struct pci_dev *pdev)</span>
 		return;
 	pci_set_consistent_dma_mask(pdev, STA2X11_AMBA_SIZE - 1);
 	pci_set_dma_mask(pdev, STA2X11_AMBA_SIZE - 1);
<span class="p_del">-	pdev-&gt;dev.archdata.dma_ops = &amp;sta2x11_dma_ops;</span>
<span class="p_add">+	pdev-&gt;dev.dma_ops = &amp;sta2x11_dma_ops;</span>
 
 	/* We must enable all devices as master, for audio DMA to work */
 	pci_set_master(pdev);
<span class="p_chunk">@@ -223,7 +223,7 @@</span> <span class="p_context"> bool dma_capable(struct device *dev, dma_addr_t addr, size_t size)</span>
 {
 	struct sta2x11_mapping *map;
 
<span class="p_del">-	if (dev-&gt;archdata.dma_ops != &amp;sta2x11_dma_ops) {</span>
<span class="p_add">+	if (dev-&gt;dma_ops != &amp;sta2x11_dma_ops) {</span>
 		if (!dev-&gt;dma_mask)
 			return false;
 		return addr + size - 1 &lt;= *dev-&gt;dma_mask;
<span class="p_chunk">@@ -247,7 +247,7 @@</span> <span class="p_context"> bool dma_capable(struct device *dev, dma_addr_t addr, size_t size)</span>
  */
 dma_addr_t phys_to_dma(struct device *dev, phys_addr_t paddr)
 {
<span class="p_del">-	if (dev-&gt;archdata.dma_ops != &amp;sta2x11_dma_ops)</span>
<span class="p_add">+	if (dev-&gt;dma_ops != &amp;sta2x11_dma_ops)</span>
 		return paddr;
 	return p2a(paddr, to_pci_dev(dev));
 }
<span class="p_chunk">@@ -259,7 +259,7 @@</span> <span class="p_context"> dma_addr_t phys_to_dma(struct device *dev, phys_addr_t paddr)</span>
  */
 phys_addr_t dma_to_phys(struct device *dev, dma_addr_t daddr)
 {
<span class="p_del">-	if (dev-&gt;archdata.dma_ops != &amp;sta2x11_dma_ops)</span>
<span class="p_add">+	if (dev-&gt;dma_ops != &amp;sta2x11_dma_ops)</span>
 		return daddr;
 	return a2p(daddr, to_pci_dev(dev));
 }
<span class="p_header">diff --git a/arch/xtensa/include/asm/device.h b/arch/xtensa/include/asm/device.h</span>
<span class="p_header">index a77d45d39f35..1deeb8ebbb1b 100644</span>
<span class="p_header">--- a/arch/xtensa/include/asm/device.h</span>
<span class="p_header">+++ b/arch/xtensa/include/asm/device.h</span>
<span class="p_chunk">@@ -6,11 +6,7 @@</span> <span class="p_context"></span>
 #ifndef _ASM_XTENSA_DEVICE_H
 #define _ASM_XTENSA_DEVICE_H
 
<span class="p_del">-struct dma_map_ops;</span>
<span class="p_del">-</span>
 struct dev_archdata {
<span class="p_del">-	/* DMA operations on that device */</span>
<span class="p_del">-	const struct dma_map_ops *dma_ops;</span>
 };
 
 struct pdev_archdata {
<span class="p_header">diff --git a/arch/xtensa/include/asm/dma-mapping.h b/arch/xtensa/include/asm/dma-mapping.h</span>
<span class="p_header">index 50d23106cce0..9eecfc3c5dc4 100644</span>
<span class="p_header">--- a/arch/xtensa/include/asm/dma-mapping.h</span>
<span class="p_header">+++ b/arch/xtensa/include/asm/dma-mapping.h</span>
<span class="p_chunk">@@ -22,8 +22,8 @@</span> <span class="p_context"> extern const struct dma_map_ops xtensa_dma_map_ops;</span>
 
 static inline const struct dma_map_ops *get_dma_ops(struct device *dev)
 {
<span class="p_del">-	if (dev &amp;&amp; dev-&gt;archdata.dma_ops)</span>
<span class="p_del">-		return dev-&gt;archdata.dma_ops;</span>
<span class="p_add">+	if (dev &amp;&amp; dev-&gt;dma_ops)</span>
<span class="p_add">+		return dev-&gt;dma_ops;</span>
 	else
 		return &amp;xtensa_dma_map_ops;
 }
<span class="p_header">diff --git a/drivers/infiniband/ulp/srpt/ib_srpt.c b/drivers/infiniband/ulp/srpt/ib_srpt.c</span>
<span class="p_header">index d21ba9d857c3..dfc24f19178b 100644</span>
<span class="p_header">--- a/drivers/infiniband/ulp/srpt/ib_srpt.c</span>
<span class="p_header">+++ b/drivers/infiniband/ulp/srpt/ib_srpt.c</span>
<span class="p_chunk">@@ -2465,7 +2465,7 @@</span> <span class="p_context"> static void srpt_add_one(struct ib_device *device)</span>
 	int i;
 
 	pr_debug(&quot;device = %p, device-&gt;dma_ops = %p\n&quot;, device,
<span class="p_del">-		 device-&gt;dma_ops);</span>
<span class="p_add">+		 device-&gt;dma_device-&gt;dma_ops);</span>
 
 	sdev = kzalloc(sizeof(*sdev), GFP_KERNEL);
 	if (!sdev)
<span class="p_header">diff --git a/drivers/iommu/amd_iommu.c b/drivers/iommu/amd_iommu.c</span>
<span class="p_header">index 3703fb9db419..f7b86679bafe 100644</span>
<span class="p_header">--- a/drivers/iommu/amd_iommu.c</span>
<span class="p_header">+++ b/drivers/iommu/amd_iommu.c</span>
<span class="p_chunk">@@ -515,7 +515,7 @@</span> <span class="p_context"> static void iommu_uninit_device(struct device *dev)</span>
 	iommu_group_remove_device(dev);
 
 	/* Remove dma-ops */
<span class="p_del">-	dev-&gt;archdata.dma_ops = NULL;</span>
<span class="p_add">+	dev-&gt;dma_ops = NULL;</span>
 
 	/*
 	 * We keep dev_data around for unplugged devices and reuse it when the
<span class="p_chunk">@@ -2164,7 +2164,7 @@</span> <span class="p_context"> static int amd_iommu_add_device(struct device *dev)</span>
 				dev_name(dev));
 
 		iommu_ignore_device(dev);
<span class="p_del">-		dev-&gt;archdata.dma_ops = &amp;nommu_dma_ops;</span>
<span class="p_add">+		dev-&gt;dma_ops = &amp;nommu_dma_ops;</span>
 		goto out;
 	}
 	init_iommu_group(dev);
<span class="p_chunk">@@ -2181,7 +2181,7 @@</span> <span class="p_context"> static int amd_iommu_add_device(struct device *dev)</span>
 	if (domain-&gt;type == IOMMU_DOMAIN_IDENTITY)
 		dev_data-&gt;passthrough = true;
 	else
<span class="p_del">-		dev-&gt;archdata.dma_ops = &amp;amd_iommu_dma_ops;</span>
<span class="p_add">+		dev-&gt;dma_ops = &amp;amd_iommu_dma_ops;</span>
 
 out:
 	iommu_completion_wait(iommu);
<span class="p_header">diff --git a/drivers/misc/mic/bus/mic_bus.c b/drivers/misc/mic/bus/mic_bus.c</span>
<span class="p_header">index c4b27a25662a..77b16ca66846 100644</span>
<span class="p_header">--- a/drivers/misc/mic/bus/mic_bus.c</span>
<span class="p_header">+++ b/drivers/misc/mic/bus/mic_bus.c</span>
<span class="p_chunk">@@ -158,7 +158,7 @@</span> <span class="p_context"> mbus_register_device(struct device *pdev, int id, const struct dma_map_ops *dma_</span>
 	mbdev-&gt;dev.parent = pdev;
 	mbdev-&gt;id.device = id;
 	mbdev-&gt;id.vendor = MBUS_DEV_ANY_ID;
<span class="p_del">-	mbdev-&gt;dev.archdata.dma_ops = dma_ops;</span>
<span class="p_add">+	mbdev-&gt;dev.dma_ops = dma_ops;</span>
 	mbdev-&gt;dev.dma_mask = &amp;mbdev-&gt;dev.coherent_dma_mask;
 	dma_set_mask(&amp;mbdev-&gt;dev, DMA_BIT_MASK(64));
 	mbdev-&gt;dev.release = mbus_release_dev;
<span class="p_header">diff --git a/drivers/misc/mic/bus/scif_bus.c b/drivers/misc/mic/bus/scif_bus.c</span>
<span class="p_header">index e5d377e97c86..a444db5f61fe 100644</span>
<span class="p_header">--- a/drivers/misc/mic/bus/scif_bus.c</span>
<span class="p_header">+++ b/drivers/misc/mic/bus/scif_bus.c</span>
<span class="p_chunk">@@ -154,7 +154,7 @@</span> <span class="p_context"> scif_register_device(struct device *pdev, int id, const struct dma_map_ops *dma_</span>
 	sdev-&gt;dev.parent = pdev;
 	sdev-&gt;id.device = id;
 	sdev-&gt;id.vendor = SCIF_DEV_ANY_ID;
<span class="p_del">-	sdev-&gt;dev.archdata.dma_ops = dma_ops;</span>
<span class="p_add">+	sdev-&gt;dev.dma_ops = dma_ops;</span>
 	sdev-&gt;dev.release = scif_release_dev;
 	sdev-&gt;hw_ops = hw_ops;
 	sdev-&gt;dnode = dnode;
<span class="p_header">diff --git a/drivers/misc/mic/bus/vop_bus.c b/drivers/misc/mic/bus/vop_bus.c</span>
<span class="p_header">index e3caa6c53922..fd7f2a6049f8 100644</span>
<span class="p_header">--- a/drivers/misc/mic/bus/vop_bus.c</span>
<span class="p_header">+++ b/drivers/misc/mic/bus/vop_bus.c</span>
<span class="p_chunk">@@ -154,7 +154,7 @@</span> <span class="p_context"> vop_register_device(struct device *pdev, int id,</span>
 	vdev-&gt;dev.parent = pdev;
 	vdev-&gt;id.device = id;
 	vdev-&gt;id.vendor = VOP_DEV_ANY_ID;
<span class="p_del">-	vdev-&gt;dev.archdata.dma_ops = dma_ops;</span>
<span class="p_add">+	vdev-&gt;dev.dma_ops = dma_ops;</span>
 	vdev-&gt;dev.dma_mask = &amp;vdev-&gt;dev.coherent_dma_mask;
 	dma_set_mask(&amp;vdev-&gt;dev, DMA_BIT_MASK(64));
 	vdev-&gt;dev.release = vop_release_dev;
<span class="p_header">diff --git a/include/linux/device.h b/include/linux/device.h</span>
<span class="p_header">index 491b4c0ca633..46a567261ccc 100644</span>
<span class="p_header">--- a/include/linux/device.h</span>
<span class="p_header">+++ b/include/linux/device.h</span>
<span class="p_chunk">@@ -921,6 +921,7 @@</span> <span class="p_context"> struct device {</span>
 #ifdef CONFIG_NUMA
 	int		numa_node;	/* NUMA node this device is close to */
 #endif
<span class="p_add">+	const struct dma_map_ops *dma_ops;</span>
 	u64		*dma_mask;	/* dma mask (if dma&#39;able device) */
 	u64		coherent_dma_mask;/* Like dma_mask, but for
 					     alloc_coherent mappings as

</pre>
</div>




  </div>
  <div id="footer">
   <a href="http://jk.ozlabs.org/projects/patchwork/">patchwork</a>
   patch tracking system
  </div>
 </body>
</html>



